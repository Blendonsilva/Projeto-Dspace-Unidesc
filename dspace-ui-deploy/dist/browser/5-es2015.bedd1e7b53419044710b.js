(window.webpackJsonp=window.webpackJsonp||[]).push([[5,14],{"0VLH":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("J3qs"),s=n("zZO8");class o extends s.a{constructor(e,...t){super(e,...t),this._rootElement=e,this._subRootElement=t.join("/")}get rootElement(){return this._rootElement}get subRootElement(){return this._subRootElement}getPath(e){Object(i.h)(e)&&Array.isArray(e)&&(e=e.join("/"));let t="/"+this.toString();return Object(i.h)(e)&&(t+="/"+e),{rootElement:this._rootElement,subRootElement:this._subRootElement,path:t}}}},"20cJ":function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n("fXoL"),s=n("/eM4"),o=n("5+tZ"),a=n("6c/T"),r=n("1kSV"),c=n("J/vq"),l=n("tyNb"),d=n("lI3o"),p=n("ofXK"),u=n("sYmb");function m(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",5),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"div",6),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"strong"),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementStart"](8,"p"),i["\u0275\u0275text"](9),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"item.preview."+e.key)),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](e.value.value)}}let b=(()=>{class e{constructor(e,t,n,i,s){this.activeModal=e,this.submissionService=t,this.modalService=n,this.router=i,this.notificationService=s}ngOnInit(){this.metadataList=[],Object.keys(this.externalSourceEntry.metadata).forEach(e=>{this.metadataList.push({key:e,value:s.a.first(this.externalSourceEntry.metadata,e)})})}closeMetadataModal(){this.activeModal.dismiss(!1)}import(){this.modalRef=this.modalService.open(a.a,{size:"lg"}),this.modalRef.componentInstance.entityType=this.labelPrefix,this.closeMetadataModal(),this.modalRef.componentInstance.selectedEvent.pipe(Object(o.a)(e=>this.submissionService.createSubmissionFromExternalSource(this.externalSourceEntry._links.self.href,e.collection.id))).subscribe(e=>{let t=!1;1===e.length&&null!==e[0]&&(t=!0,this.router.navigateByUrl("/workspaceitems/"+e[0].id+"/edit")),t||this.notificationService.error("submission.import-external.preview.error.import.title","submission.import-external.preview.error.import.body"),this.modalRef.close()})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.c),i["\u0275\u0275directiveInject"](c.a),i["\u0275\u0275directiveInject"](r.q),i["\u0275\u0275directiveInject"](l.h),i["\u0275\u0275directiveInject"](d.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-import-external-preview"]],inputs:{externalSourceEntry:"externalSourceEntry"},decls:59,vars:10,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-12"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-12","text-right"],["role","button",1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fa","fa-file-import"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"h2"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementStart"](6,"button",1),i["\u0275\u0275listener"]("click",(function(){return t.closeMetadataModal()})),i["\u0275\u0275text"](7,"\n      "),i["\u0275\u0275elementStart"](8,"span",2),i["\u0275\u0275text"](9,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n"),i["\u0275\u0275elementStart"](13,"div",3),i["\u0275\u0275text"](14,"\n  "),i["\u0275\u0275elementStart"](15,"div",4),i["\u0275\u0275text"](16,"\n    "),i["\u0275\u0275elementStart"](17,"div",5),i["\u0275\u0275text"](18,"\n      "),i["\u0275\u0275elementStart"](19,"div",6),i["\u0275\u0275text"](20,"\n        "),i["\u0275\u0275elementStart"](21,"p"),i["\u0275\u0275text"](22),i["\u0275\u0275pipe"](23,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](26,"\n    "),i["\u0275\u0275elementStart"](27,"div",5),i["\u0275\u0275text"](28,"\n      "),i["\u0275\u0275elementStart"](29,"div",6),i["\u0275\u0275text"](30,"\n        "),i["\u0275\u0275element"](31,"hr"),i["\u0275\u0275text"](32,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](33,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](34,"\n    "),i["\u0275\u0275template"](35,m,12,4,"div",7),i["\u0275\u0275text"](36,"\n    "),i["\u0275\u0275elementStart"](37,"div",5),i["\u0275\u0275text"](38,"\n      "),i["\u0275\u0275elementStart"](39,"div",6),i["\u0275\u0275text"](40,"\n        "),i["\u0275\u0275element"](41,"hr"),i["\u0275\u0275text"](42,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](43,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](44,"\n    "),i["\u0275\u0275elementStart"](45,"div",5),i["\u0275\u0275text"](46,"\n      "),i["\u0275\u0275elementStart"](47,"div",8),i["\u0275\u0275text"](48,"\n        "),i["\u0275\u0275elementStart"](49,"button",9),i["\u0275\u0275listener"]("click",(function(){return t.import()})),i["\u0275\u0275text"](50,"\n          "),i["\u0275\u0275element"](51,"i",10),i["\u0275\u0275text"](52),i["\u0275\u0275pipe"](53,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](54,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](55,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](56,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](57,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](58,"\n")),2&e&&(i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,4,"submission.import-external.preview.title."+t.labelPrefix)),i["\u0275\u0275advance"](19),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](23,6,"submission.import-external.preview.subtitle")),i["\u0275\u0275advance"](13),i["\u0275\u0275property"]("ngForOf",t.metadataList),i["\u0275\u0275advance"](17),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](53,8,"submission.import-external.preview.button.import"),"\n        "))},directives:[p.o],pipes:[u.d],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),e})()},"3aq+":function(e,t,n){var i={"./custom/app/submission/edit/submission-edit.component":["OutP",78]};function s(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((function(){return n(s)}))}s.keys=function(){return Object.keys(i)},s.id="3aq+",e.exports=s},"3cpT":function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var i=n("fXoL"),s=n("LRne"),o=n("JIr8"),a=n("vkgz"),r=n("Hl3I"),c=n("f+Ev"),l=n("oBfO"),d=n("GG8d"),p=n("B/au"),u=n("1QIV"),m=n("J3qs"),b=n("dHui"),h=n("14tD"),f=n("ofXK"),v=n("1kSV"),g=n("dlKe"),S=n("3Pt+"),x=n("sYmb");function I(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",10),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"input",11),i["\u0275\u0275listener"]("keyup.enter",(function(){i["\u0275\u0275restoreView"](e);const t=i["\u0275\u0275nextContext"]();return""===t.searchString?null:t.search()}))("ngModelChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().searchString=t})),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275propertyInterpolate"]("placeholder",i["\u0275\u0275pipeBind1"](3,2,"submission.import-external.search.placeholder")),i["\u0275\u0275property"]("ngModel",e.searchString)}}function O(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"input",11),i["\u0275\u0275listener"]("keyup.enter",(function(){i["\u0275\u0275restoreView"](e);const t=i["\u0275\u0275nextContext"]();return""===t.searchString?null:t.search()}))("ngModelChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().searchString=t})),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275propertyInterpolate"]("placeholder",i["\u0275\u0275pipeBind1"](1,2,"submission.import-external.search.placeholder")),i["\u0275\u0275property"]("ngModel",e.searchString)}}function y(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",12),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit;return i["\u0275\u0275nextContext"]().makeSourceSelection(n)})),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.import-external.source."+(null==e?null:e.name))),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](3,4,"submission.import-external.source."+(null==e?null:e.name)))}}function j(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",13),i["\u0275\u0275elementStart"](1,"p"),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](3,1,"submission.import-external.source.loading")))}const C=function(e){return{"input-group-append":e}};let E=(()=>{class e{constructor(e,t,n){this.externalService=e,this.cdr=t,this.windowService=n,this.sourceListLoading=!1,this.externalSourceData=new i.EventEmitter}ngOnInit(){this.selectedElement={id:"",name:"loading"},this.searchString="",this.sourceList=[],this.findListOptions=Object.assign({},new p.f,{elementsPerPage:5,currentPage:1,searchParams:[new r.a("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe(Object(o.a)(()=>{const e=new l.a,t=Object(c.b)(e,[]),n=Object(d.c)(t);return Object(s.a)(n)}),Object(u.j)()).subscribe(e=>{e.page.forEach(e=>{this.sourceList.push({id:e.id,name:e.name}),this.initExternalSourceData.sourceId===e.id&&(this.selectedElement={id:e.id,name:e.name},this.searchString=this.initExternalSourceData.query)}),""===this.selectedElement.id&&(this.selectedElement=this.sourceList[0]),this.pageInfo=e.pageInfo,this.cdr.detectChanges()}),this.isXsOrSm$=this.windowService.isXsOrSm()}makeSourceSelection(e){this.selectedElement=e}onScroll(){!this.sourceListLoading&&this.pageInfo.currentPage+1<=this.pageInfo.totalPages&&(this.sourceListLoading=!0,this.findListOptions=Object.assign({},new p.f,{elementsPerPage:5,currentPage:this.findListOptions.currentPage+1,searchParams:[new r.a("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe(Object(o.a)(()=>{const e=new l.a,t=Object(c.b)(e,[]),n=Object(d.c)(t);return Object(s.a)(n)}),Object(u.i)(),Object(a.a)(()=>this.sourceListLoading=!1)).subscribe(e=>{e.payload.page.forEach(e=>{this.sourceList.push({id:e.id,name:e.name})}),this.pageInfo=e.payload.pageInfo,this.cdr.detectChanges()}))}search(){this.externalSourceData.emit({entity:this.initExternalSourceData.entity,sourceId:this.selectedElement.id,query:this.searchString})}ngOnDestroy(){Object(m.b)(this.sub)&&this.sub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](h.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-import-external-searchbar"]],inputs:{initExternalSourceData:"initExternalSourceData"},outputs:{externalSourceData:"externalSourceData"},decls:34,vars:31,consts:[["class","input-group mb-2",4,"ngIf"],[1,"input-group","mb-5"],["type","text","class","form-control","aria-label","","aria-describedby","",3,"ngModel","placeholder","keyup.enter","ngModelChange",4,"ngIf"],["ngbDropdown","","role","group","aria-label","",3,"ngClass"],["ngbDropdownToggle","",1,"btn","btn-outline-secondary","w-fx",3,"title"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false","aria-labelledby","scrollableDropdownMenuButton",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["aria-labelledby","scrollableDropdownMenuButton","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow","scrolled"],["ngbDropdownItem","","class","dropdown-item text-truncate",3,"title","click",4,"ngFor","ngForOf"],["ngbDropdownItem","","class","scrollable-dropdown-loading text-center",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"title","disabled","click"],[1,"input-group","mb-2"],["type","text","aria-label","","aria-describedby","",1,"form-control",3,"ngModel","placeholder","keyup.enter","ngModelChange"],["ngbDropdownItem","",1,"dropdown-item","text-truncate",3,"title","click"],["ngbDropdownItem","",1,"scrollable-dropdown-loading","text-center"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,I,5,4,"div",0),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n"),i["\u0275\u0275elementStart"](3,"div",1),i["\u0275\u0275text"](4,"\n  "),i["\u0275\u0275template"](5,O,2,4,"input",2),i["\u0275\u0275pipe"](6,"async"),i["\u0275\u0275text"](7,"\n  "),i["\u0275\u0275elementStart"](8,"div",3),i["\u0275\u0275pipe"](9,"async"),i["\u0275\u0275text"](10,"\n    "),i["\u0275\u0275elementStart"](11,"button",4),i["\u0275\u0275pipe"](12,"translate"),i["\u0275\u0275text"](13),i["\u0275\u0275pipe"](14,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n    "),i["\u0275\u0275elementStart"](16,"div",5),i["\u0275\u0275text"](17,"\n      "),i["\u0275\u0275elementStart"](18,"div",6),i["\u0275\u0275listener"]("scrolled",(function(){return t.onScroll()})),i["\u0275\u0275text"](19,"\n        "),i["\u0275\u0275template"](20,y,4,6,"button",7),i["\u0275\u0275text"](21,"\n        "),i["\u0275\u0275template"](22,j,4,3,"div",8),i["\u0275\u0275text"](23,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n    "),i["\u0275\u0275elementStart"](26,"button",9),i["\u0275\u0275listener"]("click",(function(){return t.search()})),i["\u0275\u0275pipe"](27,"translate"),i["\u0275\u0275pipe"](28,"translate"),i["\u0275\u0275text"](29),i["\u0275\u0275pipe"](30,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](32,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](33,"\n")),2&e&&(i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](1,13,t.isXsOrSm$)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](6,15,t.isXsOrSm$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](29,C,!i["\u0275\u0275pipeBind1"](9,17,t.isXsOrSm$))),i["\u0275\u0275advance"](3),i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](12,19,"submission.import-external.search.source.hint")),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](14,21,"submission.import-external.source."+(null==t.selectedElement?null:t.selectedElement.name))),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",t.sourceList),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.sourceListLoading),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("title",""===t.searchString?i["\u0275\u0275pipeBind1"](27,23,"submission.import-external.search.button.hint"):i["\u0275\u0275pipeBind1"](28,25,"submission.import-external.search.button"))("disabled",""===t.searchString),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](30,27,"submission.import-external.search.button")))},directives:[f.p,v.j,f.m,v.o,v.m,g.a,f.o,S.DefaultValueAccessor,S.NgControlStatus,S.NgModel,v.l],pipes:[f.b,x.d],styles:[".input-group-append[_ngcontent-%COMP%]:last-child > .btn[_ngcontent-%COMP%]:not(:last-child):not(.dropdown-toggle){margin-left:-1px;border-radius:0 .25rem .25rem 0}.input-group-append[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{border-radius:0}.w-fx[_ngcontent-%COMP%]{min-width:200px}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:calc(var(--ds-dropdown-menu-max-height) / 2);overflow-x:hidden}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;height:calc(var(--bs-spacer) * 2)!important;line-height:calc(var(--bs-spacer) * 2);position:-webkit-sticky;position:sticky;bottom:0}"]}),e})()},"4GeW":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(e){return e.Relationships="relationships",e.SubmissionForm="submission-form",e.Upload="upload",e.License="license",e.CcLicense="cclicense",e.collection="collection",e.AccessesCondition="accessCondition",e}({})},"Ahb/":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("fXoL"),s=n("JTKQ");function o(e,t){}let a=(()=>{class e extends s.a{getComponentName(){return"SubmissionSubmitComponent"}importThemedComponent(e){return n("TkMu")(`./${e}/app/submission/submit/submission-submit.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(null,"THnG"))}}return e.\u0275fac=function(t){return r(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-themed-submission-submit"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:0,consts:[["vcr",""]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,o,0,0,"ng-template",null,0,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](2,"\n"))},encapsulation:2}),e})();const r=i["\u0275\u0275getInheritedFactory"](a)},JHLN:function(e,t,n){var i={"./custom/app/submission/import-external/submission-import-external.component":["mVFA",79]};function s(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((function(){return n(s)}))}s.keys=function(){return Object.keys(i)},s.id="JHLN",e.exports=s},RMpN:function(e,t,n){"use strict";n.r(t),n.d(t,"SubmissionImportExternalComponent",(function(){return N}));var i=n("fXoL"),s=n("2Vo4"),o=n("itXk"),a=n("IzEk"),r=n("pLZG"),c=n("eIep"),l=n("vkgz"),d=n("5+tZ"),p=n("f+Ev"),u=n("ynxc"),m=n("7DXY"),b=n("GG8d"),h=n("20cJ"),f=n("mEo1"),v=n("oBfO"),g=n("J3qs"),S=n("1QIV"),x=n("dnwH"),I=n("joI/"),O=n("dHui"),y=n("ppE2"),j=n("tyNb"),C=n("1kSV"),E=n("3cpT"),D=n("ofXK"),w=n("O/5o"),F=n("jLV+"),B=n("Frqi"),M=n("VYMa"),k=n("sYmb");function L(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"h3"),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,"submission.sections.describe.relationship-lookup.selection-tab.title")))}const T=function(e,t){return{repeatable:e,listId:t}};function V(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-viewable-collection",14),i["\u0275\u0275listener"]("importObject",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](4).import(t)})),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]().ngVar,t=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("@fadeIn",void 0)("objects",e)("selectionConfig",i["\u0275\u0275pureFunction2"](8,T,t.repeatable,t.listId))("config",t.initialPagination)("hideGear",!0)("context",t.context)("importable",!0)("importConfig",t.importConfig)}}function R(e,t){1&e&&(i["\u0275\u0275element"](0,"ds-loading",15),i["\u0275\u0275pipe"](1,"translate")),2&e&&i["\u0275\u0275propertyInterpolate"]("message",i["\u0275\u0275pipeBind1"](1,1,"loading.search-results"))}function P(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",16),i["\u0275\u0275text"](1,"\n          "),i["\u0275\u0275elementStart"](2,"ds-alert",17),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("type","alert-info"),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,2,"search.results.empty")))}function $(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,L,3,3,"h3",10),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,V,2,11,"ds-viewable-collection",11),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,R,2,3,"ds-loading",12),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275template"](10,P,6,4,"div",13),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275text"](12,"\n      "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.ngVar,n=i["\u0275\u0275nextContext"](3);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e&&0!==(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",(null==e?null:e.hasSucceeded)&&!i["\u0275\u0275pipeBind1"](5,4,n.isLoading$)&&(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)>0),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,6,n.isLoading$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](11,8,n.isLoading$)&&0===(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length))}}function A(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275template"](2,$,13,10,"ng-container",9),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngVar",i["\u0275\u0275pipeBind1"](3,1,e.entriesRD$))}}function _(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"ds-alert",17),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"p",18),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("type","alert-info"),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"submission.import-external.page.hint")))}function q(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",1),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,A,5,3,"div",8),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275template"](4,_,9,4,"div",8),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""!==e.reload$.value.sourceId),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""===e.reload$.value.sourceId)}}const U=function(){return["/mydspace"]};let N=(()=>{class e{constructor(e,t,n,i,o){this.searchConfigService=e,this.externalService=t,this.routeService=n,this.router=i,this.modalService=o,this.entriesRD$=new s.a(null),this.isLoading$=new s.a(!1),this.reload$=new s.a({entity:"",query:"",sourceId:""}),this.initialPagination=Object.assign(new m.a,{id:"spc",pageSize:10}),this.subs=[]}ngOnInit(){this.listId="list-submission-external-sources",this.context=u.a.EntitySearchModalWithNameVariants,this.repeatable=!1,this.routeData={entity:"",sourceId:"",query:""},this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label},this.entriesRD$=new s.a(Object(b.c)(Object(p.b)(new v.a,[]))),this.isLoading$=new s.a(!1),this.subs.push(Object(o.a)([this.routeService.getQueryParameterValue("entity"),this.routeService.getQueryParameterValue("sourceId"),this.routeService.getQueryParameterValue("query")]).pipe(Object(a.a)(1)).subscribe(([e,t,n])=>{this.reload$.next({entity:e||x.b,query:n,sourceId:t}),this.selectLabel(e),this.retrieveExternalSources()}))}getExternalSourceData(e){this.router.navigate([],{queryParams:e,replaceUrl:!0}).then(()=>{this.reload$.next(e),this.retrieveExternalSources()})}import(e){this.modalRef=this.modalService.open(h.a,{size:"lg"});const t=this.modalRef.componentInstance;t.externalSourceEntry=e,t.labelPrefix=this.label}ngOnDestroy(){this.subs.filter(e=>Object(g.b)(e)).forEach(e=>e.unsubscribe()),Object(g.b)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe()}retrieveExternalSources(){Object(g.b)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe(),this.retrieveExternalSourcesSub=this.reload$.pipe(Object(r.a)(e=>Object(g.e)(e.sourceId)&&Object(g.e)(e.query)),Object(c.a)(e=>{const t=e.query;return this.routeData=e,this.searchConfigService.paginatedSearchOptions.pipe(Object(l.a)(()=>this.isLoading$.next(!0)),Object(r.a)(e=>e.query===t),Object(d.a)(e=>this.externalService.getExternalSourceEntries(this.routeData.sourceId,e).pipe(Object(S.f)())))})).subscribe(e=>{this.entriesRD$.next(e),this.isLoading$.next(!1)})}selectLabel(e){this.label=e,this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label}}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](I.a),i["\u0275\u0275directiveInject"](O.a),i["\u0275\u0275directiveInject"](y.a),i["\u0275\u0275directiveInject"](j.h),i["\u0275\u0275directiveInject"](C.q))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-import-external"]],decls:32,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],["id","header",1,"pb-2"],[3,"initExternalSourceData","externalSourceData"],["class","row",4,"ngIf"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-chevron-left"],["class","col-md-12",4,"ngIf"],[4,"ngVar"],[4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject",4,"ngIf"],[3,"message",4,"ngIf"],["id","empty-external-entry-list",4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject"],[3,"message"],["id","empty-external-entry-list"],[3,"type"],[1,"lead","mb-0"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",1),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementStart"](4,"div",2),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementStart"](6,"h2",3),i["\u0275\u0275text"](7),i["\u0275\u0275pipe"](8,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275elementStart"](10,"ds-submission-import-external-searchbar",4),i["\u0275\u0275listener"]("externalSourceData",(function(e){return t.getExternalSourceData(e)})),i["\u0275\u0275text"](11,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n  "),i["\u0275\u0275template"](15,q,6,2,"div",5),i["\u0275\u0275text"](16,"\n\n  "),i["\u0275\u0275elementStart"](17,"div",1),i["\u0275\u0275text"](18,"\n    "),i["\u0275\u0275elementStart"](19,"div",2),i["\u0275\u0275text"](20,"\n      "),i["\u0275\u0275element"](21,"hr"),i["\u0275\u0275text"](22,"\n      "),i["\u0275\u0275elementStart"](23,"a",6),i["\u0275\u0275text"](24,"\n        "),i["\u0275\u0275element"](25,"i",7),i["\u0275\u0275text"](26),i["\u0275\u0275pipe"](27,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](28,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](29,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](30,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n")),2&e&&(i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](8,5,"submission.import-external.title"+(t.label?"."+t.label:""))),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("initExternalSourceData",t.reload$.value),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",t.reload$.value.entity),i["\u0275\u0275advance"](8),i["\u0275\u0275property"]("routerLink",i["\u0275\u0275pureFunction0"](9,U)),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](27,7,"submission.import-external.back-to-my-dspace"),"\n      "))},directives:[E.a,D.p,j.k,w.a,F.a,B.a,M.a],pipes:[k.d,D.b],styles:[""],data:{animation:[f.a]}}),e})()},SCNa:function(e,t,n){"use strict";n.r(t),n.d(t,"SubmissionEditComponent",(function(){return g}));var i=n("fXoL"),s=n("2Vo4"),o=n("eIep"),a=n("pLZG"),r=n("Kj3r"),c=n("J3qs"),l=n("1QIV"),d=n("fBXw"),p=n("lI3o"),u=n("tyNb"),m=n("iqTE"),b=n("J/vq"),h=n("sYmb"),f=n("QjZv"),v=n("m4Gq");let g=(()=>{class e{constructor(e,t,n,i,o,a,r,c){this.changeDetectorRef=e,this.notificationsService=t,this.route=n,this.router=i,this.itemDataService=o,this.submissionService=a,this.translate=r,this.submissionJsonPatchOperationsService=c,this.subs=[],this.itemLink$=new s.a(void 0)}ngOnInit(){this.subs.push(this.route.paramMap.pipe(Object(o.a)(e=>this.submissionService.retrieveSubmission(e.get("id"))),Object(a.a)(e=>Object(c.g)(e))).subscribe(e=>{if(e.hasSucceeded)if(Object(c.d)(e.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:t}=e.payload;this.submissionErrors=Object(d.a)(t),this.submissionId=e.payload.id.toString(),this.collectionId=e.payload.collection.id,this.selfUrl=e.payload._links.self.href,this.sections=e.payload.sections,this.itemLink$.next(e.payload._links.item.href),this.item=e.payload.item,this.submissionDefinition=e.payload.submissionDefinition}else 404===e.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe(Object(c.f)(),Object(o.a)(e=>this.itemDataService.findByHref(e)),Object(l.c)(),Object(r.a)(300)).subscribe(e=>{this.item=e.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(e=>Object(c.b)(e)).forEach(e=>e.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](p.a),i["\u0275\u0275directiveInject"](u.a),i["\u0275\u0275directiveInject"](u.h),i["\u0275\u0275directiveInject"](m.a),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](h.e),i["\u0275\u0275directiveInject"](f.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-edit"]],decls:5,vars:7,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","submissionId"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275element"](2,"ds-submission-form",1),i["\u0275\u0275text"](3,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("collectionId",t.collectionId)("sections",t.sections)("selfUrl",t.selfUrl)("submissionDefinition",t.submissionDefinition)("submissionErrors",t.submissionErrors)("item",t.item)("submissionId",t.submissionId))},directives:[v.a],styles:[""]}),e})()},"T/iP":function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var i=n("fXoL"),s=n("LRne"),o=n("SxV6"),a=n("IzEk"),r=n("J3qs"),c=n("oOMw"),l=n("fBXw"),d=n("4GeW"),p=n("lI3o"),u=n("QjZv"),m=n("YJD6"),b=n("J/vq"),h=n("sYmb"),f=n("ofXK"),v=n("4zj/");function g(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-uploader",1),i["\u0275\u0275listener"]("onCompleteItem",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onCompleteItem(t)}))("onUploadError",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onUploadError()})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("dropMsg",e.dropMsg)("dropOverDocumentMsg",e.dropOverDocumentMsg)("enableDragOverDocument",e.enableDragOverDocument)("onBeforeUpload",e.onBeforeUpload)("uploadFilesOptions",e.uploadFilesOptions)}}let S=(()=>{class e{constructor(e,t,n,i,o){this.notificationsService=e,this.operationsService=t,this.sectionService=n,this.submissionService=i,this.translate=o,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=Object(s.a)(!1),this.onBeforeUpload=()=>{const e=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(e),e}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,d.a.Upload)}onCompleteItem(e){this.subs.push(this.uploadEnabled.pipe(Object(o.a)()).subscribe(t=>{if(t){const{sections:t}=e,{errors:n}=e,i=Object(l.a)(n);t&&Object(r.e)(t)&&Object.keys(t).forEach(e=>{const n=Object(c.b)(t[e]),s=i[e];this.sectionService.isSectionType(this.submissionId,e,d.a.Upload).pipe(Object(a.a)(1)).subscribe(e=>{e&&(Object(r.d)(s)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,e,n,s,s)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(e=>Object(r.b)(e)).forEach(e=>e.unsubscribe())}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](p.a),i["\u0275\u0275directiveInject"](u.a),i["\u0275\u0275directiveInject"](m.a),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](h.e))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:2,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,g,1,5,"ds-uploader",0),i["\u0275\u0275text"](1,"\n")),2&e&&i["\u0275\u0275property"]("ngIf",t.uploadFilesOptions.url)},directives:[f.p,v.a],encapsulation:2}),e})()},THnG:function(e,t,n){"use strict";n.r(t),n.d(t,"SubmissionSubmitComponent",(function(){return b}));var i=n("fXoL"),s=n("2Vo4"),o=n("eIep"),a=n("Kj3r"),r=n("J3qs"),c=n("1QIV"),l=n("lI3o"),d=n("tyNb"),p=n("iqTE"),u=n("J/vq"),m=n("sYmb");let b=(()=>{class e{constructor(e,t,n,i,o,a,r,c){this.changeDetectorRef=e,this.notificationsService=t,this.router=n,this.itemDataService=i,this.submissionService=o,this.translate=a,this.viewContainerRef=r,this.route=c,this.itemLink$=new s.a(void 0),this.subs=[],this.route.queryParams.subscribe(e=>{this.collectionParam=e.collection})}ngOnInit(){this.subs.push(this.submissionService.createSubmission(this.collectionParam).subscribe(e=>{Object(r.g)(e)&&(Object(r.d)(e)?(this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"])):this.router.navigate(["/workspaceitems",e.id,"edit"],{replaceUrl:!0}))}),this.itemLink$.pipe(Object(r.f)(),Object(o.a)(e=>this.itemDataService.findByHref(e)),Object(c.c)(),Object(a.a)(300)).subscribe(e=>{this.item=e.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(e=>Object(r.b)(e)).forEach(e=>e.unsubscribe()),this.viewContainerRef.clear(),this.changeDetectorRef.markForCheck()}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](l.a),i["\u0275\u0275directiveInject"](d.h),i["\u0275\u0275directiveInject"](p.a),i["\u0275\u0275directiveInject"](u.a),i["\u0275\u0275directiveInject"](m.e),i["\u0275\u0275directiveInject"](i.ViewContainerRef),i["\u0275\u0275directiveInject"](d.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-submit"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),e})()},TTdl:function(e,t,n){"use strict";var i=n("J3qs");const s=/([^\/]+)/g,o=/\/sections\/(.*)/;t.a=e=>("string"==typeof e?[e]:e).map(e=>e.match(s)&&e.match(s).length>2?{sectionId:e.match(s)[1],fieldId:e.match(s)[2],fieldIndex:Object(i.b)(e.match(s)[3])?+e.match(s)[3]:0,originalPath:e}:{sectionId:e.match(o)[1],originalPath:e})},TkMu:function(e,t,n){var i={"./custom/app/submission/submit/submission-submit.component":["cSSl",80]};function s(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((function(){return n(s)}))}s.keys=function(){return Object.keys(i)},s.id="TkMu",e.exports=s},"Uql/":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}));const i=new Map;function s(e){return function(t){t&&i.set(e,t)}}function o(e){return i.get(e)}},YJD6:function(e,t,n){"use strict";n.d(t,"a",(function(){return D}));var i=n("fXoL"),s=n("itXk"),o=n("lJxs"),a=n("/uUt"),r=n("5+tZ"),c=n("pLZG"),l=n("IzEk"),d=n("LvDl"),p=n("J3qs"),u=n("4jMI"),m=n("LP5c"),b=n("drGc"),h=n("TTdl"),f=n("xvwT"),v=n("4GeW"),g=n("oOMw"),S=n("e+Av"),x=n("0VLH"),I=n("NFsL"),O=n("lI3o"),y=n("KZTq"),j=n("J/vq"),C=n("l7P3"),E=n("sYmb");let D=(()=>{class e{constructor(e,t,n,i,s,o){this.formService=e,this.notificationsService=t,this.scrollToService=n,this.submissionService=i,this.store=s,this.translate=o}checkSectionErrors(e,t,n,i,s=[]){if(Object(p.d)(i))this.store.dispatch(new u.r(e,t)),this.store.dispatch(new f.e(n));else if(!Object(d.isEqual)(i,s)){const e=[];i.forEach(t=>{Object(h.a)(t.path).forEach(i=>{i.fieldId&&(this.formService.addError(n,i.fieldId,i.fieldIndex,t.message),e.push(i.fieldId))})}),s.forEach(t=>{Object(h.a)(t.path).forEach(t=>{t.fieldId&&(e.includes(t.fieldId)||this.formService.removeError(n,t.fieldId,t.fieldIndex))})})}}dispatchRemoveSectionErrors(e,t){this.store.dispatch(new u.r(e,t))}dispatchSetSectionFormId(e,t,n){this.store.dispatch(new u.E(e,t,n))}getSectionData(e,t,n){return this.store.select(Object(m.d)(e,t)).pipe(Object(o.a)(e=>n===v.a.SubmissionForm?Object(g.b)(e):e),Object(a.a)())}getShownSectionErrors(e,t,n){let i;return i=n!==v.a.SubmissionForm?this.getSectionErrors(e,t):this.getSectionState(e,t,n).pipe(Object(r.a)(e=>this.formService.getFormErrors(e.formId).pipe(Object(o.a)(n=>{const i=new x.a("sections",t),s=n.map(e=>({path:i.getPath(e.fieldId.replace(/\_/g,".")).path,message:e.message})).filter(t=>-1===Object(d.findIndex)(e.errorsToShow,{path:t.path}));return[...e.errorsToShow,...s]})))),i}getSectionErrors(e,t){return this.store.select(Object(m.e)(e,t)).pipe(Object(a.a)())}getSectionServerErrors(e,t){return this.store.select(Object(m.g)(e,t)).pipe(Object(a.a)())}getSectionState(e,t,n){return this.store.select(Object(m.f)(e,t)).pipe(Object(c.a)(e=>Object(p.b)(e)),Object(o.a)(e=>e),Object(o.a)(e=>Object(p.b)(e.data)&&n===v.a.SubmissionForm?Object.assign({},e,{data:Object(g.b)(e.data)}):e),Object(a.a)())}isSectionValid(e,t){return this.store.select(Object(m.f)(e,t)).pipe(Object(c.a)(e=>Object(p.b)(e)),Object(o.a)(e=>e.isValid),Object(a.a)())}isSectionActive(e,t){return this.submissionService.getActiveSectionId(e).pipe(Object(o.a)(e=>t===e),Object(a.a)())}isSectionEnabled(e,t){return this.store.select(Object(m.f)(e,t)).pipe(Object(c.a)(e=>Object(p.b)(e)),Object(o.a)(e=>e.enabled),Object(a.a)())}isSectionReadOnly(e,t,n){return this.store.select(Object(m.f)(e,t)).pipe(Object(c.a)(e=>Object(p.b)(e)),Object(o.a)(e=>Object(p.e)(e.visibility)&&"READONLY"===e.visibility.other&&n!==b.a.WorkspaceItem),Object(a.a)())}isSectionAvailable(e,t){return this.store.select(Object(m.c)(e)).pipe(Object(c.a)(e=>Object(p.h)(e)),Object(o.a)(e=>Object(p.h)(e.sections)&&Object(p.h)(e.sections[t])),Object(a.a)())}isSectionTypeAvailable(e,t){return this.store.select(Object(m.c)(e)).pipe(Object(c.a)(e=>Object(p.h)(e)),Object(o.a)(e=>Object(p.h)(e.sections)&&Object(p.h)(Object(d.findKey)(e.sections,{sectionType:t}))),Object(a.a)())}isSectionType(e,t,n){return this.store.select(Object(m.c)(e)).pipe(Object(c.a)(e=>Object(p.h)(e)),Object(o.a)(e=>Object(p.h)(e.sections)&&Object(p.h)(e.sections[t])&&e.sections[t].sectionType===n),Object(a.a)())}addSection(e,t){this.store.dispatch(new u.m(e,t)),this.scrollToService.scrollTo({target:t,offset:-70})}removeSection(e,t){this.store.dispatch(new u.h(e,t))}updateSectionData(e,t,n,i=[],o=[],a){if(Object(p.e)(n)){const r=this.isSectionAvailable(e,t),d=this.isSectionEnabled(e,t);Object(s.a)(r,d).pipe(Object(l.a)(1),Object(c.a)(([e,t])=>e)).subscribe(([s,r])=>{this.store.dispatch(new u.G(e,t,n,i,o,a))})}}setSectionError(e,t,n){this.store.dispatch(new u.n(e,t,n))}setSectionStatus(e,t,n){this.store.dispatch(new u.C(e,t,n))}computeSectionConfiguredMetadata(e){const t=[],n="string"==typeof e?JSON.parse(e,S.T):e;return n.rows&&!Object(p.d)(n.rows)&&n.rows.forEach(e=>{e.fields&&!Object(p.d)(e.fields)&&e.fields.forEach(e=>{e.selectableMetadata&&!Object(p.d)(e.selectableMetadata)&&e.selectableMetadata.forEach(e=>{t.includes(e.metadata)||t.push(e.metadata)})})}),t}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](I.a),i["\u0275\u0275inject"](O.a),i["\u0275\u0275inject"](y.b),i["\u0275\u0275inject"](j.a),i["\u0275\u0275inject"](C.i),i["\u0275\u0275inject"](E.e))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})()},Yfyx:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var i=n("fXoL"),s=n("Uql/"),o=n("ac5F"),a=n("b8BE"),r=n("ofXK"),c=n("1kSV"),l=n("VYMa"),d=n("sYmb");const p=["sectionRef"];function u(e,t){1&e&&(i["\u0275\u0275element"](0,"i",17),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275pipe"](2,"translate")),2&e&&(i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.sections.status.warnings.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](2,4,"submission.sections.status.warnings.aria")))}function m(e,t){1&e&&(i["\u0275\u0275element"](0,"i",18),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275pipe"](2,"translate")),2&e&&(i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.sections.status.errors.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](2,4,"submission.sections.status.errors.aria")))}function b(e,t){1&e&&(i["\u0275\u0275element"](0,"i",19),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275pipe"](2,"translate")),2&e&&(i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.sections.status.valid.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](2,4,"submission.sections.status.valid.aria")))}function h(e,t){1&e&&i["\u0275\u0275element"](0,"span",20)}function f(e,t){1&e&&i["\u0275\u0275element"](0,"span",21)}function v(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"a",22),i["\u0275\u0275listener"]("click",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](3).removeSection(t)})),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"i",23),i["\u0275\u0275text"](3,"\n          "),i["\u0275\u0275elementEnd"]()}}const g=function(e){return{sectionHeader:e}};function S(e,t){if(1&e&&(i["\u0275\u0275text"](0,"\n        "),i["\u0275\u0275elementStart"](1,"span",8),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n        "),i["\u0275\u0275elementStart"](5,"div",9),i["\u0275\u0275text"](6,"\n          "),i["\u0275\u0275template"](7,u,3,6,"i",10),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n          "),i["\u0275\u0275template"](10,m,3,6,"i",11),i["\u0275\u0275text"](11,"\n          "),i["\u0275\u0275template"](12,b,3,6,"i",12),i["\u0275\u0275pipe"](13,"async"),i["\u0275\u0275text"](14,"\n          "),i["\u0275\u0275elementStart"](15,"a",13),i["\u0275\u0275pipe"](16,"translate"),i["\u0275\u0275pipe"](17,"translate"),i["\u0275\u0275pipe"](18,"translate"),i["\u0275\u0275text"](19,"\n            "),i["\u0275\u0275template"](20,h,1,0,"span",14),i["\u0275\u0275text"](21,"\n            "),i["\u0275\u0275template"](22,f,1,0,"span",15),i["\u0275\u0275text"](23,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n          "),i["\u0275\u0275template"](25,v,4,0,"a",16),i["\u0275\u0275text"](26,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](27,"\n      ")),2&e){const e=i["\u0275\u0275nextContext"](2),t=i["\u0275\u0275reference"](1);i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](3,9,"submission.sections."+e.sectionData.header)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](8,11,t.isValid())&&!t.hasErrors()),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",t.hasErrors()),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](13,13,t.isValid())&&!t.hasErrors()),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("title",i["\u0275\u0275pipeBind1"](18,20,t.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind2"](16,15,t.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",i["\u0275\u0275pureFunction1"](22,g,i["\u0275\u0275pipeBind1"](17,18,"submission.sections."+e.sectionData.header)))),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",t.isOpen()),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!t.isOpen()),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!t.isMandatory())}}function x(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-alert",28),i["\u0275\u0275listener"]("close",(function(){i["\u0275\u0275restoreView"](e);const n=t.index;return i["\u0275\u0275nextContext"](4),i["\u0275\u0275reference"](1).removeError(n)})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"](4);i["\u0275\u0275property"]("content",e)("dismissible",!0)("type",n.AlertTypeEnum.Error)}}function I(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",5),i["\u0275\u0275text"](1,"\n          "),i["\u0275\u0275template"](2,x,1,3,"ds-alert",27),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](3),t=i["\u0275\u0275reference"](1);i["\u0275\u0275propertyInterpolate1"]("id","sectionGenericError_",e.sectionData.id,""),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",t.getErrors())}}function O(e,t){1&e&&i["\u0275\u0275elementContainer"](0)}function y(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275text"](0,"\n        "),i["\u0275\u0275template"](1,I,4,2,"div",24),i["\u0275\u0275text"](2,"\n        "),i["\u0275\u0275elementStart"](3,"div",25),i["\u0275\u0275listener"]("click",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2),i["\u0275\u0275reference"](1).setFocus(t)})),i["\u0275\u0275text"](4,"\n          "),i["\u0275\u0275template"](5,O,1,0,"ng-container",26),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n      ")}if(2&e){const e=i["\u0275\u0275nextContext"](2),t=i["\u0275\u0275reference"](1);i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.hasGenericErrors()),i["\u0275\u0275advance"](2),i["\u0275\u0275propertyInterpolate1"]("id","sectionContent_",e.sectionData.id,""),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngComponentOutlet",e.getSectionContent())("ngComponentOutletInjector",e.objectInjector)}}function j(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ngb-accordion",3,4),i["\u0275\u0275listener"]("panelChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](),i["\u0275\u0275reference"](1).sectionChange(t)})),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"ngb-panel",5),i["\u0275\u0275text"](4,"\n      "),i["\u0275\u0275template"](5,S,28,24,"ng-template",6),i["\u0275\u0275text"](6,"\n      "),i["\u0275\u0275template"](7,y,8,4,"ng-template",7),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n  "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275propertyInterpolate"]("activeIds",e.sectionData.id),i["\u0275\u0275property"]("destroyOnHide",!1),i["\u0275\u0275advance"](3),i["\u0275\u0275propertyInterpolate"]("id",e.sectionData.id)}}const C=function(e){return{"section-focus":e}};let E=(()=>{class e{constructor(e){this.injector=e,this.AlertTypeEnum=o.a}ngOnInit(){this.objectInjector=i.Injector.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(e){e.preventDefault(),e.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return Object(s.b)(this.sectionData.sectionType)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.Injector))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-container"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](p,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.sectionRef=e.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},decls:7,vars:11,consts:[["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],["sectionRef","sectionRef"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"activeIds","destroyOnHide","panelChange"],["acc","ngbAccordion"],[3,"id"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],[1,"fas","fa-chevron-up","fa-fw"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"id","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"content","dismissible","type","close"]],template:function(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",0,1),i["\u0275\u0275text"](2,"\n  "),i["\u0275\u0275template"](3,j,10,3,"ngb-accordion",2),i["\u0275\u0275pipe"](4,"async"),i["\u0275\u0275text"](5,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n")),2&e){const e=i["\u0275\u0275reference"](1);i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](9,C,e.isSectionActive()))("mandatory",t.sectionData.mandatory)("submissionId",t.submissionId)("sectionType",t.sectionData.sectionType)("sectionId",t.sectionData.id),i["\u0275\u0275attribute"]("id","section_"+t.sectionData.id),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](4,7,e.isEnabled()))}},directives:[a.a,r.m,r.p,c.a,c.D,c.F,c.E,r.n,r.o,l.a],pipes:[r.b,d.d],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);-webkit-box-shadow:var(--bs-btn-focus-box-shadow);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{-webkit-box-shadow:none!important;box-shadow:none!important;width:100%}"]}),e})()},YoQ9:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("fXoL"),s=n("JTKQ");function o(e,t){}let a=(()=>{class e extends s.a{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(e){return n("3aq+")(`./${e}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(null,"SCNa"))}}return e.\u0275fac=function(t){return r(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-themed-submission-edit"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:0,consts:[["vcr",""]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,o,0,0,"ng-template",null,0,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](2,"\n"))},encapsulation:2}),e})();const r=i["\u0275\u0275getInheritedFactory"](a)},b8BE:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("fXoL"),s=n("lJxs"),o=n("LvDl"),a=n("J3qs"),r=n("TTdl"),c=n("J/vq"),l=n("YJD6");let d=(()=>{class e{constructor(e,t,n){this.changeDetectorRef=e,this.submissionService=t,this.sectionService=n,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe(Object(s.a)(e=>(e&&this.resetErrors(),e))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(e=>{Object(a.e)(e)?e.forEach(e=>{Object(r.a)(e.path).forEach(t=>{t.fieldId?this.allSectionErrors.push(e.message):this.genericSectionErrors=Object(o.uniq)(this.genericSectionErrors.concat(e.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(e=>{const t=this.active;this.active=e===this.sectionId,t!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&Object(a.g)(e)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(e=>Object(a.b)(e)).forEach(e=>e.unsubscribe())}sectionChange(e){this.sectionState=e.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(e,t){this.sectionService.removeSection(e,t)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(e){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}removeError(e){this.genericSectionErrors.splice(e)}resetErrors(){Object(a.e)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](c.a),i["\u0275\u0275directiveInject"](l.a))},e.\u0275dir=i["\u0275\u0275defineDirective"]({type:e,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"]}),e})()},c3nT:function(e,t,n){"use strict";n.d(t,"a",(function(){return yn}));var i=n("fXoL"),s=n("pKmL"),o=n("PCNd"),a=n("mrSG"),r=n("itXk"),c=n("lJxs"),l=n("vkgz"),d=n("5+tZ"),p=n("IzEk"),u=n("cBqT"),m=n("/uUt"),b=n("pLZG"),h=n("LvDl"),f=n("Q5/L"),v=n("NFsL"),g=n("JX91"),S=n("J3qs");let x=(()=>{class e{constructor(e,t,n){this.injectedCollectionId=e,this.injectedSectionData=t,this.injectedSubmissionId=n,this.collectionId=e,this.sectionData=t,this.submissionId=n}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe(Object(b.a)(e=>Object(S.h)(e)),Object(g.a)(!0)).subscribe(e=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,e)})}ngOnDestroy(){Object(S.b)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"]("collectionIdProvider"),i["\u0275\u0275directiveInject"]("sectionDataProvider"),i["\u0275\u0275directiveInject"]("submissionIdProvider"))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})();var I=n("+ZI/"),O=n("0VLH");class y{constructor(e=null,t=null){this._path=e,this._value=t}get path(){return this._path}set path(e){this._path=e}get value(){return this._value}set value(e){this._value=e}delete(){this._value=null,this._path=null}isPathEqual(e){return this._path&&Object(h.isEqual)(this._path,e)}}var j=n("Uql/"),C=n("4GeW"),E=n("J/vq"),D=n("ITak"),w=n("lI3o"),F=n("YJD6"),B=n("Gx58"),M=n("1QIV"),k=n("fHtB"),L=n("mycY"),T=n("X/78"),V=n("84Zn"),R=n("AytR"),P=n("sYmb"),$=n("ofXK"),A=n("Frqi"),_=n("hqmO");const q=["formRef"];function U(e,t){1&e&&i["\u0275\u0275element"](0,"ds-loading",2)}function N(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-form",3,4),i["\u0275\u0275listener"]("dfChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onChange(t)}))("dfFocus",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onFocus(t)}))("remove",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onRemove(t)}))("ngbEvent",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onCustomEvent(t)}))("removeArrayItem",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onRemove(t)})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",e.formId)("formModel",e.formModel)("displaySubmit",!1)("displayCancel",!1)}}let G=(()=>{let e=class extends x{constructor(e,t,n,i,s,o,a,r,c,l,d,p,u,m,b){super(u,m,b),this.cdr=e,this.formBuilderService=t,this.formOperationsService=n,this.formService=i,this.formConfigService=s,this.notificationsService=o,this.sectionService=a,this.submissionService=r,this.translate=c,this.submissionObjectService=l,this.objectCache=d,this.requestService=p,this.injectedCollectionId=u,this.injectedSectionData=m,this.injectedSubmissionId=b,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new y,this.subs=[]}onSectionInit(){this.pathCombiner=new O.a("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe(Object(c.a)(e=>e.payload),Object(l.a)(e=>this.formConfig=e),Object(d.a)(()=>Object(r.a)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,Object(V.a)("item")).pipe(Object(M.i)(),Object(M.o)())])),Object(p.a)(1)).subscribe(([e,t])=>{Object(S.j)(this.formModel)&&(this.workspaceItem=t,this.initForm(e),this.sectionData.data=e,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(e=>Object(S.b)(e)).forEach(e=>e.unsubscribe())}getSectionStatus(){const e=this.formService.isValid(this.formId),t=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe(Object(c.a)(e=>Object(S.d)(e)));return Object(r.a)([e,t]).pipe(Object(c.a)(([e,t])=>e&&t))}hasMetadataEnrichment(e){const t={};Object.keys(e).forEach(n=>{this.sectionMetadata&&this.sectionMetadata.includes(n)&&(t[n]=e[n])});const n=[],i=Object(B.a)(t,this.formData);return Object.keys(i).forEach(e=>{i[e].forEach(t=>{t.hasOwnProperty("value")&&Object(h.findIndex)(this.formData[e],{value:t.value})<0&&n.push(t)})}),Object(S.e)(n)}initForm(e){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,e,this.submissionService.getSubmissionScope());const t=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,e,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors,t)}catch(t){const e={message:this.translate.instant("error.submission.sections.init-form-error")+t.toString(),path:"/sections/"+this.sectionData.id};console.error(t.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,e)}}updateForm(e,t){Object(S.e)(e)&&!Object(h.isEqual)(e,this.sectionData.data)?(this.sectionData.data=e,this.hasMetadataEnrichment(e)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(e),this.checksForErrors(t),this.isUpdating=!1,this.cdr.detectChanges()):(Object(S.e)(t)||Object(S.e)(this.sectionData.errorsToShow))&&this.checksForErrors(t)):(Object(S.e)(t)||Object(S.e)(this.sectionData.errorsToShow))&&this.checksForErrors(t)}checksForErrors(e){this.formService.isFormInitialized(this.formId).pipe(Object(u.a)(e=>!0===e&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,e,this.sectionData.errorsToShow),this.sectionData.errorsToShow=e,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe(Object(m.a)()).subscribe(e=>{this.formData=e}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe(Object(b.a)(e=>Object(S.e)(e)&&(Object(S.e)(e.data)||Object(S.e)(e.errorsToShow))),Object(m.a)()).subscribe(e=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=e.metadata,this.updateForm(e.data,e.errorsToShow)}))}onChange(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(e.model),this.formOperationsService.getArrayIndexFromEvent(e)));const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),n=this.formOperationsService.getFieldValueFromChangeEvent(e);(-1!==R.a.submission.autosave.metadata.indexOf(t)&&Object(S.e)(n)||this.hasRelatedCustomError(t))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(e){const t=Object(h.findIndex)(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(e).path});if(-1!==t){const e=this.sectionData.errorsToShow[t].message.replace("error.validation.","");return!R.a.form.validatorMap.hasOwnProperty(e)}return!1}onFocus(e){const t=this.formOperationsService.getFieldValueFromChangeEvent(e),n=this.formBuilderService.getPath(e.model);this.formBuilderService.hasMappedGroupValue(e.model)?(this.previousValue.path=n,this.previousValue.value=this.formOperationsService.getQualdropValueMap(e)):Object(S.e)(t)&&("object"==typeof t&&Object(S.e)(t.value)||"string"==typeof t)&&(this.previousValue.path=n,this.previousValue.value=t)}onRemove(e){const t=this.formBuilderService.getId(e.model),n=this.formOperationsService.getArrayIndexFromEvent(e);if(this.fieldsOnTheirWayToBeRemoved.has(t)){const e=this.fieldsOnTheirWayToBeRemoved.get(t);e.push(n),this.fieldsOnTheirWayToBeRemoved.set(t,e)}else this.fieldsOnTheirWayToBeRemoved.set(t,[n]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(t,n))}hasStoredValue(e,t){return!!Object(S.e)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(e)&&Object(S.e)(this.sectionData.data[e][t])&&!this.isFieldToRemove(e,t)}isFieldToRemove(e,t){return this.fieldsOnTheirWayToBeRemoved.has(e)&&this.fieldsOnTheirWayToBeRemoved.get(e).includes(t)}onCustomEvent(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,null)}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](D.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](I.a),i["\u0275\u0275directiveInject"](w.a),i["\u0275\u0275directiveInject"](F.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](P.e),i["\u0275\u0275directiveInject"](k.a),i["\u0275\u0275directiveInject"](L.a),i["\u0275\u0275directiveInject"](T.a),i["\u0275\u0275directiveInject"]("collectionIdProvider"),i["\u0275\u0275directiveInject"]("sectionDataProvider"),i["\u0275\u0275directiveInject"]("submissionIdProvider"))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-form"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](q,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.formRef=e.first)}},features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:4,vars:2,consts:[["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem"],["formRef","formComponent"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,U,1,0,"ds-loading",0),i["\u0275\u0275text"](1,"\n"),i["\u0275\u0275template"](2,N,2,4,"ds-form",1),i["\u0275\u0275text"](3,"\n")),2&e&&(i["\u0275\u0275property"]("ngIf",t.isLoading),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!t.isLoading&&t.formModel))},directives:[$.p,A.a,_.a],styles:[""]}),e=Object(a.b)([Object(j.a)(C.a.SubmissionForm)],e),e})();n("b8BE"),n("wQzj"),n("yAsG"),n("m4Gq"),n("ph1m"),n("Yfyx");var Q=n("l7P3"),J=n("9jGm"),X=n("33F9"),H=n("Cfvw"),Y=n("LRne"),K=n("eIep"),z=n("JIr8"),Z=n("zp1y"),W=n("fBXw"),ee=n("4jMI"),te=n("TTdl"),ne=n("QjZv");function ie(e,t,n){return e?e[t.sections[n].formId]:null}function se(e,t,n,i){if(i||n!==C.a.SubmissionForm)return t;if(!e||!e.touched)return[];const s=[];return t.forEach(t=>{Object(te.a)(t.path).forEach(n=>{n.fieldId&&e.touched[n.fieldId]&&s.push(t)})}),s}const oe=[(()=>{class e{constructor(e,t,n,i,s,o,a,r){this.actions$=e,this.notificationsService=t,this.operationsService=n,this.sectionService=i,this.store$=s,this.submissionService=o,this.submissionObjectService=a,this.translate=r,this.loadForm$=this.actions$.pipe(Object(J.f)(ee.F.INIT_SUBMISSION_FORM),Object(c.a)(e=>{const t=e.payload.submissionDefinition,n=[];return t.sections.page.forEach(t=>{const i=t._links.self.href||t._links.self,s=i.substr(i.lastIndexOf("/")+1),o=t._links.config?t._links.config.href||t._links.config:"",a=t.mandatory||Object(S.e)(e.payload.sections)&&e.payload.sections.hasOwnProperty(s);let r;r=t.sectionType!==C.a.SubmissionForm?Object(S.h)(e.payload.sections)&&Object(S.h)(e.payload.sections[s])?e.payload.sections[s]:Object.create(null):e.payload.item.metadata;const c=Object(S.e)(e.payload.errors)&&e.payload.errors[s]||null;n.push(new ee.o(e.payload.submissionId,s,t.header,o,t.mandatory,t.sectionType,t.visibility,a,r,c))}),{action:e,definition:t,mappedActions:n}}),Object(d.a)(e=>Object(H.a)(e.mappedActions.concat(new ee.c(e.action.payload.submissionId))))),this.resetForm$=this.actions$.pipe(Object(J.f)(ee.F.RESET_SUBMISSION_FORM),Object(c.a)(e=>new ee.p(e.payload.collectionId,e.payload.submissionId,e.payload.selfUrl,e.payload.submissionDefinition,e.payload.sections,e.payload.item,null))),this.saveSubmission$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_SUBMISSION_FORM),Object(K.a)(e=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections").pipe(Object(c.a)(t=>new ee.y(e.payload.submissionId,t,e.payload.isManual)),Object(z.a)(()=>Object(Y.a)(new ee.x(e.payload.submissionId)))))),this.saveForLaterSubmission$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_FOR_LATER_SUBMISSION_FORM),Object(K.a)(e=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections").pipe(Object(c.a)(t=>new ee.v(e.payload.submissionId,t)),Object(z.a)(()=>Object(Y.a)(new ee.x(e.payload.submissionId)))))),this.saveSubmissionSuccess$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_SUBMISSION_FORM_SUCCESS),Object(Z.a)(this.store$),Object(c.a)(([e,t])=>this.parseSaveResponse(t.submission.objects[e.payload.submissionId],e.payload.submissionObject,e.payload.submissionId,t.forms,e.payload.notify)),Object(d.a)(e=>Object(H.a)(e))),this.saveSubmissionSectionSuccess$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_SUBMISSION_SECTION_FORM_SUCCESS),Object(Z.a)(this.store$),Object(c.a)(([e,t])=>this.parseSaveResponse(t.submission.objects[e.payload.submissionId],e.payload.submissionObject,e.payload.submissionId,t.forms,!1)),Object(d.a)(e=>Object(H.a)(e))),this.saveSection$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_SUBMISSION_SECTION_FORM),Object(K.a)(e=>this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections",e.payload.sectionId).pipe(Object(c.a)(t=>new ee.B(e.payload.submissionId,t)),Object(z.a)(()=>Object(Y.a)(new ee.A(e.payload.submissionId)))))),this.saveError$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_SUBMISSION_FORM_ERROR,ee.F.SAVE_SUBMISSION_SECTION_FORM_ERROR),Object(Z.a)(this.store$),Object(l.a)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.save_error_notice")))),this.saveAndDeposit$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_AND_DEPOSIT_SUBMISSION),Object(Z.a)(this.submissionService.hasUnsavedModification()),Object(K.a)(([e,t])=>{let n;return n=t?this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections"):this.submissionObjectService.findById(e.payload.submissionId,!1,!0).pipe(Object(M.j)(),Object(c.a)(e=>[e])),n.pipe(Object(c.a)(t=>this.canDeposit(t)?new ee.e(e.payload.submissionId):new ee.y(e.payload.submissionId,t)),Object(z.a)(()=>Object(Y.a)(new ee.x(e.payload.submissionId))))})),this.depositSubmission$=this.actions$.pipe(Object(J.f)(ee.F.DEPOSIT_SUBMISSION),Object(Z.a)(this.store$),Object(K.a)(([e,t])=>this.submissionService.depositSubmission(t.submission.objects[e.payload.submissionId].selfUrl).pipe(Object(c.a)(()=>new ee.g(e.payload.submissionId)),Object(z.a)(t=>Object(Y.a)(new ee.f(e.payload.submissionId)))))),this.saveForLaterSubmissionSuccess$=this.actions$.pipe(Object(J.f)(ee.F.SAVE_FOR_LATER_SUBMISSION_FORM_SUCCESS),Object(l.a)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice"))),Object(l.a)(()=>this.submissionService.redirectToMyDSpace())),this.depositSubmissionSuccess$=this.actions$.pipe(Object(J.f)(ee.F.DEPOSIT_SUBMISSION_SUCCESS),Object(l.a)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.deposit_success_notice"))),Object(l.a)(()=>this.submissionService.redirectToMyDSpace())),this.depositSubmissionError$=this.actions$.pipe(Object(J.f)(ee.F.DEPOSIT_SUBMISSION_ERROR),Object(l.a)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.deposit_error_notice")))),this.discardSubmission$=this.actions$.pipe(Object(J.f)(ee.F.DISCARD_SUBMISSION),Object(K.a)(e=>this.submissionService.discardSubmission(e.payload.submissionId).pipe(Object(c.a)(()=>new ee.k(e.payload.submissionId)),Object(z.a)(()=>Object(Y.a)(new ee.j(e.payload.submissionId)))))),this.addAllMetadataToSectionData=this.actions$.pipe(Object(J.f)(ee.F.UPDATE_SECTION_DATA),Object(K.a)(e=>this.sectionService.getSectionState(e.payload.submissionId,e.payload.sectionId,C.a.Upload).pipe(Object(c.a)(t=>[e,t]),Object(p.a)(1))),Object(b.a)(([e,t])=>t.sectionType===C.a.SubmissionForm),Object(K.a)(([e,t])=>t.sectionType===C.a.SubmissionForm?this.submissionObjectService.findById(e.payload.submissionId,!0,!1,Object(V.a)("item")).pipe(Object(M.j)()).pipe(Object(K.a)(e=>e.item.pipe(Object(M.j)()))).pipe(Object(c.a)(e=>e.metadata),Object(b.a)(t=>!Object(h.isEqual)(e.payload.data,t)),Object(c.a)(t=>new ee.G(e.payload.submissionId,e.payload.sectionId,t,e.payload.errorsToShow,e.payload.serverValidationErrors,e.payload.metadata))):Object(Y.a)(new ee.H))),this.discardSubmissionSuccess$=this.actions$.pipe(Object(J.f)(ee.F.DISCARD_SUBMISSION_SUCCESS),Object(l.a)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.discard_success_notice"))),Object(l.a)(()=>this.submissionService.redirectToMyDSpace())),this.discardSubmissionError$=this.actions$.pipe(Object(J.f)(ee.F.DISCARD_SUBMISSION_ERROR),Object(l.a)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.discard_error_notice"))))}canDeposit(e){let t=!0;return Object(S.e)(e)&&e.forEach(e=>{const{errors:n}=e;n&&!Object(S.d)(n)&&(t=!1)}),t}parseSaveResponse(e,t,n,i,s=!0){const o=[];return Object(S.e)(t)&&(s&&this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice")),t.forEach(t=>{let a=Object.create({});const{errors:r}=t;r&&!Object(S.d)(r)&&(a=Object(W.a)(r),s&&this.notificationsService.warning(null,this.translate.get("submission.sections.general.sections_not_valid")));const c=t.sections&&Object(S.e)(t.sections)?t.sections:{},l=Object(h.union)(Object.keys(c),Object.keys(a));for(const d of l){const t=a[d]||[],r=c[d]||{};if(e.sections[d].sectionType===C.a.Upload&&Object(S.d)(r.files)&&!e.sections[d].enabled)continue;s&&!e.sections[d].enabled&&this.submissionService.notifyNewSection(n,d,e.sections[d].sectionType);const l=se(ie(i,e,d),t,e.sections[d].sectionType,s);o.push(new ee.G(n,d,r,l,t))}})),o}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](J.a),i["\u0275\u0275inject"](w.a),i["\u0275\u0275inject"](ne.a),i["\u0275\u0275inject"](F.a),i["\u0275\u0275inject"](Q.i),i["\u0275\u0275inject"](E.a),i["\u0275\u0275inject"](k.a),i["\u0275\u0275inject"](P.e))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"loadForm$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"resetForm$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"saveSubmission$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"saveForLaterSubmission$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"saveSubmissionSuccess$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"saveSubmissionSectionSuccess$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"saveSection$",void 0),Object(a.b)([Object(J.b)({dispatch:!1}),Object(a.c)("design:type",Object)],e.prototype,"saveError$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"saveAndDeposit$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"depositSubmission$",void 0),Object(a.b)([Object(J.b)({dispatch:!1}),Object(a.c)("design:type",Object)],e.prototype,"saveForLaterSubmissionSuccess$",void 0),Object(a.b)([Object(J.b)({dispatch:!1}),Object(a.c)("design:type",Object)],e.prototype,"depositSubmissionSuccess$",void 0),Object(a.b)([Object(J.b)({dispatch:!1}),Object(a.c)("design:type",Object)],e.prototype,"depositSubmissionError$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"discardSubmission$",void 0),Object(a.b)([Object(J.b)(),Object(a.c)("design:type",Object)],e.prototype,"addAllMetadataToSectionData",void 0),Object(a.b)([Object(J.b)({dispatch:!1}),Object(a.c)("design:type",Object)],e.prototype,"discardSubmissionSuccess$",void 0),Object(a.b)([Object(J.b)({dispatch:!1}),Object(a.c)("design:type",Object)],e.prototype,"discardSubmissionError$",void 0),e})()];var ae=n("2Vo4"),re=n("LP5c");let ce=(()=>{class e{constructor(e){this.store=e}getUploadedFileList(e,t){return this.store.select(Object(re.i)(e,t)).pipe(Object(c.a)(e=>e),Object(m.a)())}getFileData(e,t,n){return this.store.select(Object(re.i)(e,t)).pipe(Object(b.a)(e=>!Object(S.j)(e)),Object(c.a)(e=>{let t;return Object.keys(e).filter(t=>e[t].uuid===n).forEach(n=>t=e[n]),t}),Object(m.a)())}getDefaultPolicies(e,t,n){return this.store.select(Object(re.h)(e,t,n)).pipe(Object(c.a)(e=>e),Object(m.a)())}addUploadedFile(e,t,n,i){this.store.dispatch(new ee.q(e,t,n,i))}updateFileData(e,t,n,i){this.store.dispatch(new ee.l(e,t,n,i))}removeUploadedFile(e,t,n){this.store.dispatch(new ee.d(e,t,n))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](Q.i))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var le=n("DNva"),de=n("YIpg"),pe=n("8a3C"),ue=n("EdIQ"),me=n("uLZQ"),be=n("zQ+x"),he=n("5HAD"),fe=n("7vy/"),ve=n("VOnO"),ge=n("tk/3");let Se=(()=>{let e=class extends ue.a{constructor(e,t,n,i,s,o,a,r){super(e,t,null,i,s,o,a,r,"submissionuploads"),this.requestService=e,this.rdbService=t,this.store=n,this.objectCache=i,this.halService=s,this.notificationsService=o,this.http=a,this.comparator=r}findByHref(e,t=!0,n=!0,...i){return super.findByHref(e,t,n,...i)}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](T.a),i["\u0275\u0275inject"](fe.a),i["\u0275\u0275inject"](Q.i),i["\u0275\u0275inject"](L.a),i["\u0275\u0275inject"](me.a),i["\u0275\u0275inject"](w.a),i["\u0275\u0275inject"](ge.b),i["\u0275\u0275inject"](ve.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e=Object(a.b)([Object(be.d)(he.g)],e),e})();var xe=n("ac5F");function Ie(e,t){1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",2),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementStart"](4,"div",3),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementStart"](6,"h3",4),i["\u0275\u0275elementStart"](7,"span",5),i["\u0275\u0275text"](8),i["\u0275\u0275pipe"](9,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n"),i["\u0275\u0275elementContainerEnd"]()),2&e&&(i["\u0275\u0275advance"](8),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](9,1,"submission.sections.upload.no-file-uploaded")))}const Oe=function(e){return{collectionName:e}};function ye(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind2"](2,1,"submission.sections.upload.header.policy.default.nolist",i["\u0275\u0275pureFunction1"](4,Oe,e.collectionName)),"\n        ")}}function je(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind2"](2,1,"submission.sections.upload.header.policy.default.withlist",i["\u0275\u0275pureFunction1"](4,Oe,e.collectionName)),"\n        ")}}function Ce(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275elementStart"](2,"div",8),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementStart"](4,"ds-alert",9),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275template"](6,ye,3,6,"ng-container",1),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275template"](8,je,3,6,"ng-container",1),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275element"](10,"span",10),i["\u0275\u0275text"](11,"\n        "),i["\u0275\u0275element"](12,"ds-submission-section-upload-access-conditions",11),i["\u0275\u0275text"](13,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n  "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("type",e.AlertTypeEnum.Warning),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",1===e.collectionPolicyType),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",2===e.collectionPolicyType),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("accessConditions",e.collectionDefaultAccessConditions)}}function Ee(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275element"](2,"ds-submission-upload-section-file",12),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n    "),i["\u0275\u0275elementStart"](5,"div",2),i["\u0275\u0275text"](6,"\n      "),i["\u0275\u0275elementStart"](7,"div",3),i["\u0275\u0275text"](8,"\n        "),i["\u0275\u0275element"](9,"hr"),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n  "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("availableAccessConditionOptions",n.availableAccessConditionOptions)("collectionId",n.collectionId)("collectionPolicyType",n.collectionPolicyType)("configMetadataForm",i["\u0275\u0275pipeBind1"](3,9,n.configMetadataForm$))("fileId",n.fileIndexes[n.fileList.indexOf(e)])("fileIndex",n.fileList.indexOf(e))("fileName",n.fileNames[n.fileList.indexOf(e)])("sectionId",n.sectionData.id)("submissionId",n.submissionId)}}function De(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n\n  "),i["\u0275\u0275template"](2,Ce,16,4,"div",6),i["\u0275\u0275text"](3,"\n\n  "),i["\u0275\u0275template"](4,Ee,13,11,"ng-container",7),i["\u0275\u0275text"](5,"\n"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e.collectionDefaultAccessConditions.length>0),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",e.fileList)}}let we=(()=>{let e=class extends x{constructor(e,t,n,i,s,o,a,r,c,l){super(void 0,c,l),this.bitstreamService=e,this.changeDetectorRef=t,this.collectionDataService=n,this.groupService=i,this.resourcePolicyService=s,this.sectionService=o,this.submissionService=a,this.uploadsConfigService=r,this.injectedSectionData=c,this.injectedSubmissionId=l,this.AlertTypeEnum=xe.a,this.fileIndexes=[],this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new ae.a(!0),this.subs=[]}onSectionInit(){const e=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,Object(V.a)("metadata")).pipe(Object(M.i)(),Object(c.a)(e=>e.payload));this.configMetadataForm$=e.pipe(Object(K.a)(e=>e.metadata.pipe(Object(M.i)(),Object(c.a)(e=>e.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe(Object(b.a)(e=>Object(S.h)(e)&&!e.isLoading),Object(b.a)(e=>Object(S.j)(this.collectionId)||this.collectionId!==e.collection),Object(l.a)(e=>this.collectionId=e.collection),Object(d.a)(e=>this.collectionDataService.findById(e.collection)),Object(b.a)(e=>Object(S.h)(e.payload)),Object(l.a)(e=>this.collectionName=e.payload.name),Object(d.a)(()=>e)).subscribe(e=>{this.required$.next(e.required),this.availableAccessConditionOptions=Object(S.e)(e.accessConditionOptions)?e.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),Object(r.a)(this.configMetadataForm$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id)).pipe(Object(b.a)(([e,t])=>Object(S.e)(e)&&Object(S.h)(t)),Object(m.a)()).subscribe(([e,t])=>{this.fileList=[],this.fileIndexes=[],this.fileNames=[],this.changeDetectorRef.detectChanges(),Object(S.h)(t)&&t.length>0&&t.forEach(t=>{this.fileList.push(t),this.fileIndexes.push(t.uuid),this.fileNames.push(this.getFileName(e,t))}),this.changeDetectorRef.detectChanges()}))}getFileName(e,t){const n=e.rows[0].fields[0].selectableMetadata[0].metadata;let i;return i=Object(S.e)(t.metadata)&&Object(S.e)(t.metadata[n])?t.metadata[n][0].display:t.uuid,i}getSectionStatus(){return Object(r.a)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(e,t)=>!e||Object(S.h)(t)&&t.length>0)}onSectionDestroy(){this.subs.filter(e=>Object(S.b)(e)).forEach(e=>e.unsubscribe())}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](ce),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](le.a),i["\u0275\u0275directiveInject"](de.a),i["\u0275\u0275directiveInject"](pe.a),i["\u0275\u0275directiveInject"](F.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](Se),i["\u0275\u0275directiveInject"]("sectionDataProvider"),i["\u0275\u0275directiveInject"]("submissionIdProvider"))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-upload"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:6,vars:5,consts:[[3,"content","dismissible","type"],[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"text-center"],[1,"text-muted"],["class","row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]],template:function(e,t){1&e&&(i["\u0275\u0275element"](0,"ds-alert",0),i["\u0275\u0275text"](1,"\n\n"),i["\u0275\u0275template"](2,Ie,13,3,"ng-container",1),i["\u0275\u0275text"](3,"\n\n"),i["\u0275\u0275template"](4,De,6,2,"ng-container",1),i["\u0275\u0275text"](5,"\n")),2&e&&(i["\u0275\u0275property"]("content","submission.sections.upload.info")("dismissible",!0)("type",t.AlertTypeEnum.Info),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",0==t.fileList.length),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.fileList.length>0))},styles:[""]}),e=Object(a.b)([Object(j.a)(C.a.Upload)],e),e})();n("T/iP");var Fe=n("BVmw");const Be={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},Me=[{id:"granted",label:"I confirm the license above",required:!0,value:!1,validators:{required:null},errorMessages:{required:"You must accept the license",notgranted:"You must accept the license"},type:"CHECKBOX"}],ke=["formRef"];function Le(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-form",2,3),i["\u0275\u0275listener"]("dfChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onChange(t)})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",e.formId)("formModel",e.formModel)("formLayout",e.formLayout)("displaySubmit",e.displaySubmit)("displayCancel",!1)}}let Te=(()=>{let e=class extends x{constructor(e,t,n,i,s,o,a,r,c,l,d){super(c,l,d),this.changeDetectorRef=e,this.collectionDataService=t,this.formBuilderService=n,this.formOperationsService=i,this.formService=s,this.operationsBuilder=o,this.sectionService=a,this.submissionService=r,this.injectedCollectionId=c,this.injectedSectionData=l,this.injectedSubmissionId=d,this.formLayout=Be,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new O.a("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(Me);const e=this.formBuilderService.findById("granted",this.formModel);e.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,Object(V.a)("license")).pipe(Object(b.a)(e=>Object(S.h)(e.payload)),Object(d.a)(e=>e.payload.license),Object(u.a)(e=>Object(S.h)(e.payload)),Object(c.a)(e=>e.payload.text),Object(g.a)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe(Object(p.a)(1),Object(b.a)(e=>e)).subscribe(()=>{e.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe(Object(b.a)(e=>Object(S.e)(e)),Object(m.a)()).subscribe(t=>{const n=t.map(t=>"/sections/license"===t.path?e.checked?null:Object.assign({},t,{path:"/sections/license/granted"}):t).filter(e=>Object(S.g)(e));Object(S.e)(n)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,n),this.sectionData.errors=t):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.changeDetectorRef.detectChanges()}))}getSectionStatus(){const e=this.formBuilderService.findById("granted",this.formModel);return e.valueChanges.pipe(Object(c.a)(e=>!0===e),Object(g.a)(e.value))}onChange(e){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),n=this.formOperationsService.getFieldValueFromChangeEvent(e);n?(this.operationsBuilder.add(this.pathCombiner.getPath(t),n.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(t))}onSectionDestroy(){this.subs.filter(e=>Object(S.b)(e)).forEach(e=>e.unsubscribe())}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](le.a),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](D.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](Fe.a),i["\u0275\u0275directiveInject"](F.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"]("collectionIdProvider"),i["\u0275\u0275directiveInject"]("sectionDataProvider"),i["\u0275\u0275directiveInject"]("submissionIdProvider"))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-license"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](ke,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.formRef=e.first)}},features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:9,vars:4,consts:[[1,"mb-5",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange"],["formRef","formComponent"]],template:function(e,t){1&e&&(i["\u0275\u0275element"](0,"span",0),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n"),i["\u0275\u0275element"](3,"br"),i["\u0275\u0275text"](4," "),i["\u0275\u0275element"](5,"br"),i["\u0275\u0275text"](6,"\n"),i["\u0275\u0275template"](7,Le,2,5,"ds-form",1),i["\u0275\u0275text"](8,"\n")),2&e&&(i["\u0275\u0275property"]("innerHTML",i["\u0275\u0275pipeBind1"](1,2,t.licenseText$),i["\u0275\u0275sanitizeHtml"]),i["\u0275\u0275advance"](7),i["\u0275\u0275property"]("ngIf",t.formModel))},directives:[$.p,_.a],pipes:[$.b],styles:[""]}),e=Object(a.b)([Object(j.a)(C.a.License)],e),e})();n("SCNa");var Ve=n("e+Av");const Re={id:"metadata",group:[]},Pe={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},$e={id:"accessConditionGroup",group:[]},Ae={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},_e={id:"accessConditions",groupFactory:null},qe={grid:{group:"form-row pt-4"}},Ue={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},Ne={element:{host:"col-12",label:"col-form-label name-label"}},Ge={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ve.Q,operator:Ve.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},Qe={element:{label:"col-form-label"},grid:{host:"col-6"}},Je={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ve.Q,operator:Ve.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},Xe={element:{label:"col-form-label"},grid:{host:"col-6"}};var He=n("fM99"),Ye=n("1kSV");const Ke=["formRef"];function ze(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-form",6,7),i["\u0275\u0275listener"]("submitForm",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onSubmit()}))("cancel",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onModalClose()}))("dfChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onChange(t)})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",e.formId)("formModel",e.formModel)("displaySubmit",!e.isSaving)("displayCancel",!e.isSaving)}}let Ze=(()=>{class e{constructor(e,t,n,i,s,o,a,r){this.activeModal=e,this.cdr=t,this.formBuilderService=n,this.formService=i,this.submissionService=s,this.operationsBuilder=o,this.operationsService=a,this.uploadService=r,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(e){this.fileData.accessConditions.forEach((t,n)=>{Array.of("name","startDate","endDate").filter(e=>t.hasOwnProperty(e)&&Object(S.e)(t[e])).forEach(i=>{const s=this.formBuilderService.findById(i,e,n);if(s)if(s.type===Ve.g){const e=new Date(t[i]);s.value={year:e.getUTCFullYear(),month:e.getUTCMonth()+1,day:e.getUTCDate()}}else s.value=t[i]})})}onChange(e){"name"===e.model.id&&this.setOptions(e.model,e.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(e,t){let n=null;if(this.availableAccessConditionOptions.filter(e=>e.name===t.value).forEach(e=>n=e),Object(S.e)(n)){const i=!0===n.hasStartDate||!0===n.hasEndDate,s=t.parent.get("startDate"),o=t.parent.get("endDate");if(null==s||s.markAsUntouched(),null==o||o.markAsUntouched(),null==s||s.setValue(null),t.parent.markAsDirty(),null==o||o.setValue(null),i){if(n.hasStartDate){const t=this.formBuilderService.findById("startDate",e.parent.group),i=new Date(n.maxStartDate);t.max={year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate()}}if(n.hasEndDate){const t=this.formBuilderService.findById("endDate",e.parent.group),i=new Date(n.maxEndDate);t.max={year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate()}}}}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(e){const t=Array.isArray(e)?e[0]:e;return t?t.value:void 0}buildFileEditForm(){const e=Object.assign({},this.configMetadataForm.rows[0].fields[0]);e.repeatable=!1;const t=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],e])}),n=[],i=Object.assign({},Re);i.group=this.formBuilderService.modelFromConfiguration(this.submissionId,t,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),n.push(new Ve.D(i,Pe));const s=Object.assign({},Ue),o=Object.assign({},_e),a=[];if(2===this.collectionPolicyType){for(const n of this.availableAccessConditionOptions)a.push({label:n.name,value:n.name});s.options=a;const e=[],t=[],i=[];this.availableAccessConditionOptions.forEach(n=>{const s=!0===n.hasStartDate,o=!0===n.hasEndDate,a=s||o;s&&e.push({id:"name",value:n.name}),o&&t.push({id:"name",value:n.name}),a&&i.push({id:"name",value:n.name})});const r={relations:[{match:Ve.Q,operator:Ve.R,when:e}]},c={relations:[{match:Ve.Q,operator:Ve.R,when:t}]};o.groupFactory=()=>{const n=new Ve.N(s,Ne),i=Object.assign({},Ge,r),o=Object.assign({},Je,c),a=new Ve.t(i,Qe),l=new Ve.t(o,Xe),d=Object.assign({},$e);return d.group=[n],e.length>0&&d.group.push(a),t.length>0&&d.group.push(l),[new Ve.D(d,Ae)]},o.initialCount=Object(S.e)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,n.push(new Ve.w(o,qe))}return this.initModelData(n),n}saveBitstreamData(){this.formService.validateAllFormFields(this.formRef.formGroup);const e=this.formService.isValid(this.formId).pipe(Object(p.a)(1),Object(b.a)(e=>e),Object(d.a)(()=>this.formService.getFormData(this.formId)),Object(p.a)(1),Object(d.a)(e=>{Object.keys(e.metadata).filter(t=>Object(S.e)(e.metadata[t])).forEach(t=>{const n=t.replace(/_/g,".");this.operationsBuilder.add(this.pathCombiner.getPath(`metadata/${n}`),e.metadata[t],!0)}),Object.keys(this.fileData.metadata).filter(e=>Object(S.e)(this.fileData.metadata[e])).filter(t=>Object(S.a)(e.metadata[t])).filter(e=>this.formMetadata.includes(e)).forEach(e=>{const t=e.replace(/_/g,".");this.operationsBuilder.remove(this.pathCombiner.getPath(`metadata/${t}`))});const t=[];return e.accessConditions.map(e=>e.accessConditionGroup).filter(e=>Object(S.e)(e)).forEach(e=>{let n;if(this.availableAccessConditionOptions.filter(t=>Object(S.g)(e.name)&&t.name===e.name[0].value).forEach(e=>n=e),n){const i=Object.assign({},e);if(i.name=this.retrieveValueFromField(e.name),n.hasStartDate){if(e.startDate){const t=this.retrieveValueFromField(e.startDate);i.startDate=Object(He.a)(t)}}else delete i.startDate;if(n.hasEndDate){if(e.endDate){const t=this.retrieveValueFromField(e.endDate);i.endDate=Object(He.a)(t)}}else delete i.endDate;t.push(i)}}),Object(S.e)(t)&&this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),t,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(e=>{if(e[0].sections[this.sectionId]){const t=e[0].sections[this.sectionId];Object.keys(t.files).filter(e=>t.files[e].uuid===this.fileId).forEach(e=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,t.files[e]))}this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(e)}unsubscribeAll(){this.subscriptions.filter(e=>Object(S.b)(e)).forEach(e=>e.unsubscribe())}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](Ye.c),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](Fe.a),i["\u0275\u0275directiveInject"](ne.a),i["\u0275\u0275directiveInject"](ce))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](Ke,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.formRef=e.first)}},decls:21,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"disabled","click"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange"],["formRef","formComponent"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",0),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementStart"](4,"h4",1),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementStart"](8,"button",2),i["\u0275\u0275listener"]("click",(function(){return t.onModalClose()})),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275elementStart"](10,"span",3),i["\u0275\u0275text"](11,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n  "),i["\u0275\u0275elementStart"](15,"div",4),i["\u0275\u0275text"](16,"\n\n    "),i["\u0275\u0275template"](17,ze,2,4,"ds-form",5),i["\u0275\u0275text"](18,"\n\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n")),2&e&&(i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,3,"submission.sections.upload.edit.title")),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("disabled",t.isSaving),i["\u0275\u0275advance"](9),i["\u0275\u0275property"]("ngIf",t.formModel))},directives:[$.p,_.a],pipes:[P.d],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),e})();var We=n("PJyI"),et=n("/lGE"),tt=n("OXP5"),nt=n("/eM4");function it(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span",3),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate3"]("\n    ",e.name," ",e.startDate," ",e.endDate,"\n  ")}}function st(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span",3),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate2"]("",e.name," from ",e.endDate,"")}}function ot(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span",4),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate2"]("",e.name," until ",e.startDate,"")}}function at(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275template"](2,it,2,3,"span",1),i["\u0275\u0275text"](3,"\n  "),i["\u0275\u0275template"](4,st,2,2,"span",1),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275template"](6,ot,2,2,"span",2),i["\u0275\u0275text"](7,"\n  "),i["\u0275\u0275element"](8,"br"),i["\u0275\u0275text"](9,"\n"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf","DEFAULT_BITSTREAM_READ"==e.action),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf","lease"==e.name),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf","embargo"==e.name)}}let rt=(()=>{class e{constructor(e){this.groupService=e,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(e=>{Object(S.d)(e.name)?this.groupService.findByHref(e._links.group.href).pipe(Object(u.a)(e=>!e.isResponsePending&&e.hasSucceeded)).subscribe(t=>{const n=t.payload,i=Object.assign({},e);i.name=n.name,this.accessConditionsList.push(i)}):this.accessConditionsList.push(e)})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](de.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,at,10,3,"ng-container",0),i["\u0275\u0275text"](1,"\n")),2&e&&i["\u0275\u0275property"]("ngForOf",t.accessConditionsList)},directives:[$.o,$.p],encapsulation:2}),e})();var ct=n("BCqK");function lt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275elementStart"](2,"h5"),i["\u0275\u0275text"](3),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n      "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"]("\n          ",e.value,"\n        ")}}function dt(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"h5"),i["\u0275\u0275text"](1,"\n          "),i["\u0275\u0275elementStart"](2,"span",4),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](4);i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate2"]("",i["\u0275\u0275pipeBind1"](4,2,"submission.sections.upload.no-entry")," ",e.fileTitleKey,"")}}function pt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,dt,6,4,"h5",0),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit,t=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",0===t.metadata[t.fileTitleKey].indexOf(e))}}function ut(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275template"](2,lt,5,1,"ng-container",0),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275template"](4,pt,4,1,"ng-container",0),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275element"](6,"span",1),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""!==e.value),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""===e.value)}}const mt=function(){return["150"]};function bt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"dsTruncate"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind2"](2,1,e.value,i["\u0275\u0275pureFunction0"](4,mt)),"\n      ")}}function ht(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span",4),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](4);i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate2"]("",i["\u0275\u0275pipeBind1"](2,2,"submission.sections.upload.no-entry")," ",e.fileDescrKey,"")}}function ft(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,ht,3,4,"span",5),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit,t=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",0===t.metadata[t.fileDescrKey].indexOf(e))}}function vt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275template"](2,bt,3,5,"ng-container",0),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275template"](4,ft,4,1,"ng-container",0),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275element"](6,"span",1),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""!==e.value),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""===e.value)}}function gt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,ut,8,2,"ng-container",3),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275template"](4,vt,8,2,"ng-container",3),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",e.getAllMetadataValue(e.fileTitleKey)),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",e.getAllMetadataValue(e.fileDescrKey))}}let St=(()=>{class e{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){Object(S.e)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=nt.a.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=nt.a.all(this.fileData.metadata,"dc.description"))}getAllMetadataValue(e){return nt.a.all(this.metadata,e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},decls:9,vars:2,consts:[[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275template"](2,gt,6,2,"ng-container",0),i["\u0275\u0275text"](3,"\n\n  "),i["\u0275\u0275element"](4,"span",1),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275element"](6,"ds-submission-section-upload-access-conditions",2),i["\u0275\u0275text"](7,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.metadata),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("accessConditions",t.fileData.accessConditions))},directives:[$.p,rt,$.o],pipes:[P.d,ct.a],encapsulation:2}),e})();var xt=n("t8/W");function It(e,t){1&e&&i["\u0275\u0275element"](0,"i",18)}function Ot(e,t){1&e&&i["\u0275\u0275element"](0,"i",19)}function yt(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",2),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementStart"](4,"div",3),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275text"](6,"\n      "),i["\u0275\u0275element"](7,"ds-thumbnail",4),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n    "),i["\u0275\u0275elementStart"](10,"div",5),i["\u0275\u0275text"](11,"\n      "),i["\u0275\u0275elementStart"](12,"div",6),i["\u0275\u0275text"](13,"\n        "),i["\u0275\u0275elementStart"](14,"h3"),i["\u0275\u0275text"](15),i["\u0275\u0275elementStart"](16,"span",7),i["\u0275\u0275text"](17),i["\u0275\u0275pipe"](18,"dsFileSize"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n      "),i["\u0275\u0275elementStart"](21,"div",8),i["\u0275\u0275text"](22,"\n        "),i["\u0275\u0275elementContainerStart"](23),i["\u0275\u0275text"](24,"\n          "),i["\u0275\u0275elementStart"](25,"ds-file-download-link",9),i["\u0275\u0275text"](26,"\n            "),i["\u0275\u0275element"](27,"i",10),i["\u0275\u0275text"](28,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](29,"\n          "),i["\u0275\u0275elementStart"](30,"button",11),i["\u0275\u0275listener"]("click",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"]();return t.preventDefault(),n.editBitstreamData()})),i["\u0275\u0275pipe"](31,"translate"),i["\u0275\u0275pipe"](32,"translate"),i["\u0275\u0275text"](33,"\n            "),i["\u0275\u0275element"](34,"i",12),i["\u0275\u0275text"](35,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](36,"\n          "),i["\u0275\u0275elementStart"](37,"button",13),i["\u0275\u0275listener"]("click",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"](),s=i["\u0275\u0275reference"](3);return t.preventDefault(),n.confirmDelete(s)})),i["\u0275\u0275pipe"](38,"translate"),i["\u0275\u0275pipe"](39,"translate"),i["\u0275\u0275pipe"](40,"async"),i["\u0275\u0275text"](41,"\n            "),i["\u0275\u0275template"](42,It,1,0,"i",14),i["\u0275\u0275pipe"](43,"async"),i["\u0275\u0275text"](44,"\n            "),i["\u0275\u0275template"](45,Ot,1,0,"i",15),i["\u0275\u0275pipe"](46,"async"),i["\u0275\u0275text"](47,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](48,"\n        "),i["\u0275\u0275elementContainerEnd"](),i["\u0275\u0275text"](49,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](50,"\n      "),i["\u0275\u0275element"](51,"div",16),i["\u0275\u0275text"](52,"\n      "),i["\u0275\u0275element"](53,"ds-submission-section-upload-file-view",17),i["\u0275\u0275text"](54,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](55,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](56,"\n"),i["\u0275\u0275elementContainerEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](7),i["\u0275\u0275property"]("thumbnail",null==e.fileData?null:e.fileData.thumbnail),i["\u0275\u0275advance"](8),i["\u0275\u0275textInterpolate1"]("",e.fileName," "),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate1"]("(",i["\u0275\u0275pipeBind1"](18,15,null==e.fileData?null:e.fileData.sizeBytes),")"),i["\u0275\u0275advance"](8),i["\u0275\u0275property"]("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",e.getBitstream())("enableRequestACopy",!1),i["\u0275\u0275advance"](5),i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](32,19,"submission.sections.upload.edit.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](31,17,"submission.sections.upload.edit.title")),i["\u0275\u0275advance"](7),i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](39,23,"submission.sections.upload.delete.confirm.title")),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](40,25,e.processingDelete$)),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](38,21,"submission.sections.upload.delete.confirm.title")),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](43,27,e.processingDelete$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](46,29,e.processingDelete$)),i["\u0275\u0275advance"](8),i["\u0275\u0275property"]("fileData",e.fileData)}}function jt(e,t){1&e&&(i["\u0275\u0275text"](0,"\n  "),i["\u0275\u0275elementStart"](1,"div",20),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"h4",21),i["\u0275\u0275text"](4),i["\u0275\u0275pipe"](5,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n    "),i["\u0275\u0275elementStart"](7,"button",22),i["\u0275\u0275listener"]("click",(function(){return(0,t.dismiss)("cancel")})),i["\u0275\u0275text"](8,"\n      "),i["\u0275\u0275elementStart"](9,"span",23),i["\u0275\u0275text"](10,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementStart"](14,"div",24),i["\u0275\u0275text"](15,"\n    "),i["\u0275\u0275elementStart"](16,"p"),i["\u0275\u0275text"](17),i["\u0275\u0275pipe"](18,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n  "),i["\u0275\u0275elementStart"](21,"div",25),i["\u0275\u0275text"](22,"\n    "),i["\u0275\u0275elementStart"](23,"button",26),i["\u0275\u0275listener"]("click",(function(){return(0,t.close)("cancel")})),i["\u0275\u0275text"](24),i["\u0275\u0275pipe"](25,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](26,"\n    "),i["\u0275\u0275elementStart"](27,"button",27),i["\u0275\u0275listener"]("click",(function(){return(0,t.close)("ok")})),i["\u0275\u0275text"](28),i["\u0275\u0275pipe"](29,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](30,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n")),2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](5,4,"submission.sections.upload.delete.confirm.title")),i["\u0275\u0275advance"](13),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](18,6,"submission.sections.upload.delete.confirm.info")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](25,8,"submission.sections.upload.delete.confirm.cancel")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](29,10,"submission.sections.upload.delete.confirm.submit")))}let Ct=(()=>{class e{constructor(e,t,n,i,s,o,a,r){this.cdr=e,this.formService=t,this.halService=n,this.modalService=i,this.operationsBuilder=s,this.operationsService=o,this.submissionService=a,this.uploadService=r,this.processingDelete$=new ae.a(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe(Object(b.a)(e=>Object(S.h)(e))).subscribe(e=>{this.fileData=e}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.pathCombiner=new O.a("sections",this.sectionId,"files",this.fileIndex),this.loadFormMetadata()}confirmDelete(e){this.modalService.open(e).result.then(e=>{"ok"===e&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new We.a,{uuid:this.fileData.uuid})}editBitstreamData(){const e=this.modalService.open(Ze,{size:"xl",backdrop:"static"});e.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,e.componentInstance.collectionId=this.collectionId,e.componentInstance.collectionPolicyType=this.collectionPolicyType,e.componentInstance.configMetadataForm=this.configMetadataForm,e.componentInstance.fileData=this.fileData,e.componentInstance.fileId=this.fileId,e.componentInstance.fileIndex=this.fileIndex,e.componentInstance.formId=this.formId,e.componentInstance.sectionId=this.sectionId,e.componentInstance.formMetadata=this.formMetadata,e.componentInstance.pathCombiner=this.pathCombiner,e.componentInstance.submissionId=this.submissionId}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(e=>Object(S.b)(e)).forEach(e=>e.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(e=>{e.fields.forEach(e=>{e.selectableMetadata.forEach(e=>{this.formMetadata.push(e.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath()),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](me.a),i["\u0275\u0275directiveInject"](Ye.q),i["\u0275\u0275directiveInject"](Fe.a),i["\u0275\u0275directiveInject"](ne.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](ce))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-upload-section-file"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](Ze,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.fileEditComp=e.first)}},inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:5,vars:1,consts:[[4,"ngIf"],["content",""],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","click"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","disabled","click"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,yt,57,31,"ng-container",0),i["\u0275\u0275text"](1,"\n\n"),i["\u0275\u0275template"](2,jt,32,12,"ng-template",null,1,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](4,"\n")),2&e&&i["\u0275\u0275property"]("ngIf",t.fileData)},directives:[$.p,et.a,tt.a,St],pipes:[xt.a,P.d,$.b],styles:[""]}),e})();n("THnG");var Et=n("a318"),Dt=(n("RMpN"),n("3cpT"),n("20cJ"),n("6c/T"),n("8U9A")),wt=n("UXhX"),Ft=n("8aB6"),Bt=n("O/5o");function Mt(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275element"](2,"ds-loading"),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementEnd"]())}function kt(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n        ",e.getSelectedCcLicense().name,"\n      ")}}function Lt(e,t){1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementContainerEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.change"),"\n        "))}function Tt(e,t){1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementContainerEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.select"),"\n        "))}function Vt(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,Lt,3,3,"ng-container",3),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,Tt,3,3,"ng-container",3),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e.storedCcLicenseLink),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!e.storedCcLicenseLink)}}function Rt(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"button",7),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n        ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.none"),"\n      "))}function Pt(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",8),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit;return i["\u0275\u0275nextContext"]().selectCcLicense(n)})),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n        ",e.name,"\n      ")}}function $t(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",10),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275elementStart"](2,"h5"),i["\u0275\u0275text"](3),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n            "),i["\u0275\u0275element"](5,"div",20),i["\u0275\u0275text"](6,"\n          "),i["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"]("\n              ",e.label,"\n            "),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("innerHTML",e.description,i["\u0275\u0275sanitizeHtml"])}}function At(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275text"](0,"\n\n      "),i["\u0275\u0275elementStart"](1,"div"),i["\u0275\u0275text"](2,"\n\n        "),i["\u0275\u0275elementStart"](3,"div",15),i["\u0275\u0275text"](4,"\n          "),i["\u0275\u0275elementStart"](5,"div"),i["\u0275\u0275text"](6,"\n            "),i["\u0275\u0275elementStart"](7,"h4"),i["\u0275\u0275text"](8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n            "),i["\u0275\u0275element"](10,"div",16),i["\u0275\u0275text"](11,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n          "),i["\u0275\u0275elementStart"](13,"button",17),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](3).closeInfoModal()})),i["\u0275\u0275text"](14,"\n            "),i["\u0275\u0275elementStart"](15,"span",18),i["\u0275\u0275text"](16,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](17,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](18,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n\n        "),i["\u0275\u0275elementStart"](20,"div",19),i["\u0275\u0275text"](21,"\n          "),i["\u0275\u0275template"](22,$t,7,2,"div",9),i["\u0275\u0275text"](23,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n\n    ")}if(2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](8),i["\u0275\u0275textInterpolate1"]("\n              ",e.label,"\n            "),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("innerHTML",e.description,i["\u0275\u0275sanitizeHtml"]),i["\u0275\u0275advance"](12),i["\u0275\u0275property"]("ngForOf",e.enums)}}function _t(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().ngVar;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",e.label,"\n        ")}}function qt(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.option.select"),"\n        "))}function Ut(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0,2),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,_t,2,1,"span",3),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,qt,3,3,"span",3),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.ngVar;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!e)}}function Nt(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",8),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit,s=i["\u0275\u0275nextContext"](2).$implicit,o=i["\u0275\u0275nextContext"](2);return o.selectOption(o.getSelectedCcLicense(),s,n)})),i["\u0275\u0275text"](1),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n            ",e.label,"\n          ")}}function Gt(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"ds-select"),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275template"](2,Ut,6,2,"ng-container",21),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementContainerStart"](4,4),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementStart"](6,"div",22),i["\u0275\u0275text"](7,"\n          "),i["\u0275\u0275template"](8,Nt,2,1,"button",6),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementContainerEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit,t=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngVar",t.getSelectedOption(t.getSelectedCcLicense(),e)),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("ngForOf",e.enums)}}function Qt(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",24),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275elementStart"](2,"div",25),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit,s=i["\u0275\u0275nextContext"](2).$implicit,o=i["\u0275\u0275nextContext"](2);return o.selectOption(o.getSelectedCcLicense(),s,n)})),i["\u0275\u0275text"](3,"\n          "),i["\u0275\u0275element"](4,"input",26),i["\u0275\u0275text"](5,"\n          "),i["\u0275\u0275elementStart"](6,"span"),i["\u0275\u0275text"](7),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"](2).$implicit,s=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](4),i["\u0275\u0275propertyInterpolate"]("title",e.label),i["\u0275\u0275property"]("checked",s.isSelectedOption(s.getSelectedCcLicense(),n,e)),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](e.label)}}function Jt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275template"](2,Qt,10,3,"div",23),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().$implicit;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",e.enums)}}function Xt(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",10),i["\u0275\u0275text"](1,"\n\n    "),i["\u0275\u0275elementStart"](2,"div",11),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementStart"](4,"div"),i["\u0275\u0275text"](5),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n      "),i["\u0275\u0275elementStart"](7,"button",12),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const t=i["\u0275\u0275reference"](14);return i["\u0275\u0275nextContext"](2).openInfoModal(t)})),i["\u0275\u0275text"](8,"\n        "),i["\u0275\u0275element"](9,"i",13),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n\n    "),i["\u0275\u0275template"](13,At,26,3,"ng-template",null,14,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](15,"\n\n    "),i["\u0275\u0275template"](16,Gt,12,2,"ds-select",3),i["\u0275\u0275text"](17,"\n\n    "),i["\u0275\u0275template"](18,Jt,4,1,"ng-container",3),i["\u0275\u0275text"](19,"\n\n  "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;i["\u0275\u0275advance"](4),i["\u0275\u0275classMapInterpolate1"]("font-weight-bold ",e.id,""),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n        ",e.label,"\n      "),i["\u0275\u0275advance"](11),i["\u0275\u0275property"]("ngIf",(null==e.enums?null:e.enums.length)>5),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",(null==e.enums?null:e.enums.length)<=5)}}function Ht(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n\n  "),i["\u0275\u0275template"](2,Xt,20,6,"div",9),i["\u0275\u0275text"](3,"\n\n"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",e.getSelectedCcLicense().fields)}}function Yt(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"ds-loading"),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementEnd"]())}function Kt(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",29),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"div"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementStart"](6,"a",30),i["\u0275\u0275text"](7),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n      "),i["\u0275\u0275elementStart"](9,"div",31),i["\u0275\u0275text"](10,"\n        "),i["\u0275\u0275elementStart"](11,"div",25),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const t=i["\u0275\u0275nextContext"](3);return t.setAccepted(!t.accepted)})),i["\u0275\u0275text"](12,"\n          "),i["\u0275\u0275element"](13,"input",32),i["\u0275\u0275text"](14,"\n          "),i["\u0275\u0275elementStart"](15,"span"),i["\u0275\u0275text"](16),i["\u0275\u0275pipe"](17,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](18,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n    "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]().ngVar,t=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"]("\n        ",i["\u0275\u0275pipeBind1"](4,5,"submission.sections.ccLicense.link"),"\n      "),i["\u0275\u0275advance"](3),i["\u0275\u0275propertyInterpolate"]("href",e,i["\u0275\u0275sanitizeUrl"]),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n        ",e,"\n      "),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("checked",t.accepted),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](17,7,"submission.sections.ccLicense.confirmation"))}}function zt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,Yt,4,0,"div",3),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275template"](4,Kt,21,9,"div",28),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.ngVar;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!e),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e)}}function Zt(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275template"](2,zt,6,2,"ng-container",27),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n"),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngVar",i["\u0275\u0275pipeBind1"](3,1,e.getCcLicenseLink$()))}}let Wt=(()=>{let e=class extends x{constructor(e,t,n,i,s,o,a,r){super(o,a,r),this.modalService=e,this.sectionService=t,this.submissionCcLicensesDataService=n,this.submissionCcLicenseUrlDataService=i,this.operationsBuilder=s,this.injectedCollectionId=o,this.injectedSectionData=a,this.injectedSubmissionId=r,this.isLoading=!0,this.subscriptions=[]}get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}get data(){return this.sectionData.data}selectCcLicense(e){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===e.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:e.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(e=>e.id===this.data.ccLicense.id)[0]:null}selectOption(e,t,n){this.isSelectedOption(e,t,n)||this.updateSectionData({ccLicense:{id:e.id,fields:Object.assign({},this.data.ccLicense.fields,{[t.id]:n})},accepted:!1})}getSelectedOption(e,t){return this.data.ccLicense.fields[t.id]}isSelectedOption(e,t,n){return this.getSelectedOption(e,t)&&this.getSelectedOption(e,t).id===n.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return Object(Y.a)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(e=>!this.getSelectedOption(this.getSelectedCcLicense(),e)))return;const e=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(e,new Map(e.fields.map(t=>[t,this.getSelectedOption(e,t)])))}openInfoModal(e){this.modalRef=this.modalService.open(e)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return Object(Y.a)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new O.a("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,C.a.CcLicense).pipe(Object(b.a)(e=>Object(S.e)(e)&&(Object(S.e)(e.data)||Object(S.e)(e.errorsToShow))),Object(m.a)(),Object(c.a)(e=>e.data)).subscribe(e=>{if(this.data.accepted!==e.accepted){const t=this.pathCombiner.getPath("uri");e.accepted?this.getCcLicenseLink$().pipe(Object(p.a)(1)).subscribe(e=>{this.operationsBuilder.add(t,e.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(t)}this.sectionData.data=e}),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe(Object(M.i)(),Object(M.o)(),Object(c.a)(e=>e.page)).subscribe(e=>this.submissionCcLicenses=e))}setAccepted(e){this.updateSectionData({accepted:e}),this.updateSectionStatus()}updateSectionData(e){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,e))}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](Ye.q),i["\u0275\u0275directiveInject"](F.a),i["\u0275\u0275directiveInject"](Dt.a),i["\u0275\u0275directiveInject"](wt.a),i["\u0275\u0275directiveInject"](Fe.a),i["\u0275\u0275directiveInject"]("collectionIdProvider"),i["\u0275\u0275directiveInject"]("sectionDataProvider"),i["\u0275\u0275directiveInject"]("submissionIdProvider"))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-cc-licenses"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:26,vars:8,consts:[[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],["infoModal",""],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",3,"checked"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"ds-select",1),i["\u0275\u0275text"](3,"\n\n    "),i["\u0275\u0275elementContainerStart"](4,2),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275template"](6,Mt,4,0,"span",3),i["\u0275\u0275text"](7,"\n      "),i["\u0275\u0275template"](8,kt,2,1,"span",3),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275template"](10,Vt,6,2,"span",3),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementContainerEnd"](),i["\u0275\u0275text"](12,"\n\n    "),i["\u0275\u0275elementContainerStart"](13,4),i["\u0275\u0275text"](14,"\n      "),i["\u0275\u0275template"](15,Rt,3,3,"button",5),i["\u0275\u0275text"](16,"\n      "),i["\u0275\u0275template"](17,Pt,2,1,"button",6),i["\u0275\u0275text"](18,"\n    "),i["\u0275\u0275elementContainerEnd"](),i["\u0275\u0275text"](19,"\n\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](21,"\n\n"),i["\u0275\u0275template"](22,Ht,4,1,"ng-container",3),i["\u0275\u0275text"](23,"\n\n"),i["\u0275\u0275template"](24,Zt,5,3,"ng-container",3),i["\u0275\u0275text"](25,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("disabled",!t.submissionCcLicenses),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",!t.submissionCcLicenses),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.getSelectedCcLicense()),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.submissionCcLicenses&&!t.getSelectedCcLicense()),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",0==(null==t.submissionCcLicenses?null:t.submissionCcLicenses.length)),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",t.submissionCcLicenses),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",t.getSelectedCcLicense()),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.getCcLicenseLink$()))},directives:[Ft.a,$.p,$.o,A.a,Bt.a],pipes:[P.d,$.b],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]}),e=Object(a.b)([Object(j.a)(C.a.CcLicense)],e),e})();var en=n("N0eT"),tn=n("udvk"),nn=(n("YoQ9"),n("Ahb/"),n("qK5G"),n("kcqd"));let sn=(()=>{class e{constructor(e){this.store=e}getAccessesData(e,t){return this.store.select(Object(re.d)(e,t)).pipe(Object(b.a)(e=>Object(S.h)(e)),Object(m.a)())}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](Q.i))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();const on={id:"discoverable",name:"discoverable"},an={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},rn={id:"accessConditionGroup",group:[]},cn={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},ln={id:"accessCondition",groupFactory:null},dn={grid:{group:"form-row pt-4"}},pn={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},un={element:{host:"col-12",label:"col-form-label name-label"}},mn={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ve.Q,operator:Ve.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},bn={element:{label:"col-form-label"},grid:{host:"col-6"}},hn={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ve.Q,operator:Ve.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},fn={element:{label:"col-form-label"},grid:{host:"col-6"}};let vn=(()=>{let e=class extends ue.a{constructor(e,t,n,i,s,o,a,r){super(e,t,null,i,s,o,a,r,"submissionaccessoptions"),this.requestService=e,this.rdbService=t,this.store=n,this.objectCache=i,this.halService=s,this.notificationsService=o,this.http=a,this.comparator=r}findByHref(e,t=!0,n=!0,...i){return super.findByHref(e,t,n,...i)}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](T.a),i["\u0275\u0275inject"](fe.a),i["\u0275\u0275inject"](Q.i),i["\u0275\u0275inject"](L.a),i["\u0275\u0275inject"](me.a),i["\u0275\u0275inject"](w.a),i["\u0275\u0275inject"](ge.b),i["\u0275\u0275inject"](ve.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e=Object(a.b)([Object(be.d)(he.a)],e),e})();const gn=["formRef"];function Sn(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-form",1,2),i["\u0275\u0275listener"]("dfChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onChange(t)}))("removeArrayItem",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onRemove(t)})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",e.formId)("formModel",e.formModel)("displaySubmit",!1)("displayCancel",!1)}}let xn=(()=>{let e=class extends x{constructor(e,t,n,i,s,o,a,r,c,l,d){super(void 0,l,d),this.sectionService=e,this.formBuilderService=t,this.accessesConfigService=n,this.accessesService=i,this.formOperationsService=s,this.operationsBuilder=o,this.formService=a,this.translate=r,this.operationsService=c,this.injectedSectionData=l,this.injectedSubmissionId=d,this.subs=[]}initModelData(e){this.accessesData.accessConditions.forEach((t,n)=>{Array.of("name","startDate","endDate").filter(e=>t.hasOwnProperty(e)&&Object(S.e)(t[e])).forEach(i=>{const s=this.formBuilderService.findById(i,e,n);if(s)if(s.type===Ve.g){const e=new Date(t[i]);s.value={year:e.getUTCFullYear(),month:e.getUTCMonth()+1,day:e.getUTCDate()}}else s.value=t[i]})})}onChange(e){if(e.model.type===Ve.e){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),n=this.formOperationsService.getFieldValueFromChangeEvent(e);this.operationsBuilder.replace(this.pathCombiner.getPath(t),n.value,!0)}else{if(e.model.id===pn.id){const t=e.control.parent.get("startDate"),n=e.control.parent.get("endDate");null==t||t.markAsUntouched(),null==n||n.markAsUntouched(),null==t||t.setValue(null),null==n||n.setValue(null),e.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe(Object(p.a)(1),Object(b.a)(e=>e),Object(d.a)(()=>this.formService.getFormData(this.formId)),Object(p.a)(1)).subscribe(e=>{const t=[];e.accessCondition.map(e=>e.accessConditionGroup).filter(e=>Object(S.e)(e)).forEach(e=>{let n;if(this.availableAccessConditionOptions.filter(t=>Object(S.g)(e.name)&&t.name===e.name[0].value).forEach(e=>n=e),n){const i=Object.assign({},e);if(i.name=this.retrieveValueFromField(e.name),n.hasStartDate){if(e.startDate){const t=this.retrieveValueFromField(e.startDate);i.startDate=Object(He.a)(t)}}else delete i.startDate;if(n.hasEndDate){if(e.endDate){const t=this.retrieveValueFromField(e.endDate);i.endDate=Object(He.a)(t)}}else delete i.endDate;t.push(i)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),t,!0)})}}onRemove(e){const t=this.formOperationsService.getArrayIndexFromEvent(e);this.operationsBuilder.remove(this.pathCombiner.getPath("accessConditions/"+t))}onSectionDestroy(){this.subs.filter(e=>Object(S.b)(e)).forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new O.a("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const e=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe(Object(M.i)(),Object(c.a)(e=>e.payload)),t=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);Object(r.a)([e,t]).subscribe(([e,t])=>{this.availableAccessConditionOptions=Object(S.e)(e.accessConditionOptions)?e.accessConditionOptions:[],this.canChangeDiscoverable=!!e.canChangeDiscoverable,this.accessesData=t,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return Object(Y.a)(!0)}buildFileEditForm(){const e=[];if(this.canChangeDiscoverable){const t=Object.assign({},on,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});e.push(new Ve.r(t,an))}const t=Object.assign({},pn),n=Object.assign({},ln),i=[];for(const l of this.availableAccessConditionOptions)i.push({label:l.name,value:l.name});t.options=i;const s=[],o=[],a=[];this.availableAccessConditionOptions.forEach(e=>{const t=!0===e.hasStartDate,n=!0===e.hasEndDate,i=t||n;t&&s.push({id:"name",value:e.name}),n&&o.push({id:"name",value:e.name}),i&&a.push({id:"name",value:e.name})});const r={relations:[{match:Ve.Q,operator:Ve.R,when:s}]},c={relations:[{match:Ve.Q,operator:Ve.R,when:o}]};return n.groupFactory=()=>{const e=new Ve.N(t,un),n=Object.assign({},mn,r),i=Object.assign({},hn,c),a=new Ve.t(n,bn),l=new Ve.t(i,fn),d=Object.assign({},rn);return d.group=[e],s.length>0&&d.group.push(a),o.length>0&&d.group.push(l),[new Ve.D(d,cn)]},n.initialCount=Object(S.e)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,e.push(new Ve.w(n,dn)),this.initModelData(e),e}retrieveValueFromField(e){const t=Array.isArray(e)?e[0]:e;return t?t.value:void 0}};return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](F.a),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](vn),i["\u0275\u0275directiveInject"](sn),i["\u0275\u0275directiveInject"](D.a),i["\u0275\u0275directiveInject"](Fe.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](P.e),i["\u0275\u0275directiveInject"](ne.a),i["\u0275\u0275directiveInject"]("sectionDataProvider"),i["\u0275\u0275directiveInject"]("submissionIdProvider"))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-section-accesses"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](gn,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.formRef=e.first)}},features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:2,vars:1,consts:[[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem"],["formRef","formComponent"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,Sn,2,4,"ds-form",0),i["\u0275\u0275text"](1,"\n")),2&e&&i["\u0275\u0275property"]("ngIf",!!t.formModel)},directives:[$.p,_.a],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),e=Object(a.b)([Object(j.a)(C.a.AccessesCondition)],e),e})();var In=n("VYMa");const On=[we,G,Te,Wt,xn,Ze];let yn=(()=>{class e{static withEntryComponents(){return{ngModule:e,providers:On.map(e=>({provide:e}))}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({providers:[ce,F.a,Se,vn,sn],imports:[[$.c,s.a.forRoot(),o.a,Q.k.forFeature("submission",X.a,Et.d),J.c.forFeature(oe),en.a.withEntryComponents(),tn.a.withEntryComponents(),nn.a,Ye.b,Ye.r]]}),e})();i["\u0275\u0275setComponentScope"](we,[In.a,$.p,rt,$.o,Ct],[P.d,$.b])},fBXw:function(e,t,n){"use strict";var i=n("TTdl");t.a=(e=[])=>{const t=Object.create({});return e.forEach(e=>{Object(i.a)(e.paths).forEach(n=>{const i={path:n.originalPath,message:e.message};t[n.sectionId]||(t[n.sectionId]=[]),t[n.sectionId].push(i)})}),t}},kcqd:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n("fXoL"),s=n("ofXK"),o=n("hqmO"),a=n("e+Av"),r=n("NvTF");function c(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-dynamic-form-control-container",1),i["\u0275\u0275listener"]("dfBlur",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"]();return n.onCustomEvent(t,n.blur)}))("dfChange",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"]();return n.onCustomEvent(t,n.change)}))("dfFocus",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"]();return n.onCustomEvent(t,n.focus)}))("ngbEvent",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"]();return n.onCustomEvent(t,n.ngbEvent)})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",n.formId)("group",n.formGroup)("hasErrorMessaging",e.hasErrorMessages)("hidden",e.hidden)("layout",n.formLayout)("model",e)("templates",n.templates)("asBootstrapFormGroup",!0)}}let l=(()=>{class e extends a.x{constructor(e,t){super(e,t),this.blur=new i.EventEmitter,this.change=new i.EventEmitter,this.focus=new i.EventEmitter,this.ngbEvent=new i.EventEmitter}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](a.y))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-dynamic-form"]],contentQueries:function(e,t,n){if(1&e&&i["\u0275\u0275contentQuery"](n,a.O,0),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.templates=e)}},viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](r.a,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.components=e)}},inputs:{formId:"formId",formGroup:"formGroup",formModel:"formModel",formLayout:"formLayout"},outputs:{blur:"dfBlur",change:"dfChange",focus:"dfFocus",ngbEvent:"ngbEvent"},features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:2,vars:2,consts:[[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,c,1,8,"ds-dynamic-form-control-container",0),i["\u0275\u0275text"](1,"\n")),2&e&&i["\u0275\u0275property"]("ngForOf",t.formModel)("ngForTrackBy",t.trackByFn)},directives:[s.o,r.a],encapsulation:2}),e})();n("ZO65"),n("0pnk"),n("sw+l"),n("1Pbu"),n("bPV6"),n("Gu/b"),n("A/iK"),n("KKO+"),n("Ysrn");var d=n("tqJZ"),p=n("ZTun"),u=(n("uyTL"),n("Ui2r"),n("8HnP"),n("zVKZ"),n("PCNd")),m=n("sYmb"),b=n("kMeL"),h=(n("yXJd"),n("/Vzl"),n("zGzN"),n("xjoE"),n("n7Wa")),f=n("3Pt+"),v=n("5+WD");let g=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({providers:[{provide:a.c,useValue:r.b}],imports:[[s.c,a.I,h.a,b.a,u.a,m.c]]}),e})();i["\u0275\u0275setComponentScope"](d.a,[f.NgControlStatusGroup,f.FormGroupDirective,f.FormGroupName,s.m,s.o,r.a],[]),i["\u0275\u0275setComponentScope"](p.a,[f.NgControlStatusGroup,f.FormGroupDirective,f.FormArrayName,s.m,v.c,s.o,v.a,v.b,f.FormGroupName,s.t,r.a],[]),i["\u0275\u0275setComponentScope"](o.a,[f["\u0275angular_packages_forms_forms_ba"],f.NgControlStatusGroup,f.FormGroupDirective,l,a.O,s.p],[m.d,s.b])},m4Gq:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n("fXoL"),s=n("LRne"),o=n("pLZG"),a=n("lJxs"),r=n("/uUt"),c=n("eIep"),l=n("J3qs"),d=n("ao5O"),p=n("4GeW"),u=n("Vurf"),m=n("uLZQ"),b=n("J/vq"),h=n("YJD6"),f=n("ofXK"),v=n("wQzj"),g=n("ph1m"),S=n("T/iP"),x=n("Frqi"),I=n("Yfyx"),O=n("yAsG");function y(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",12),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"ds-submission-upload-files",13),i["\u0275\u0275text"](3,"\n            "),i["\u0275\u0275element"](4,"div",14),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("submissionId",e.submissionId)("collectionId",e.collectionId)("uploadFilesOptions",e.uploadFilesOptions)}}function j(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",6),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,y,6,3,"div",7),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n\n        "),i["\u0275\u0275elementStart"](5,"div",8),i["\u0275\u0275text"](6,"\n            "),i["\u0275\u0275elementStart"](7,"ds-submission-form-collection",9),i["\u0275\u0275listener"]("collectionChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onCollectionChange(t)})),i["\u0275\u0275text"](8,"\n            "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n        "),i["\u0275\u0275elementStart"](11,"div",10),i["\u0275\u0275text"](12,"\n            "),i["\u0275\u0275elementStart"](13,"ds-submission-form-section-add",11),i["\u0275\u0275text"](14,"\n            "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](16,"\n    "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](3,6,e.uploadEnabled$)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("currentCollectionId",e.collectionId)("currentDefinition",e.definitionId)("submissionId",e.submissionId),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("collectionId",e.collectionId)("submissionId",e.submissionId)}}function C(e,t){1&e&&i["\u0275\u0275element"](0,"ds-loading",15)}function E(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"ds-submission-section-container",16),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("collectionId",n.collectionId)("submissionId",n.submissionId)("sectionData",e)}}function D(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",17),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275element"](2,"ds-submission-form-footer",18),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("submissionId",e.submissionId)}}let w=(()=>{class e{constructor(e,t,n,i,o){this.authService=e,this.changeDetectorRef=t,this.halService=n,this.submissionService=i,this.sectionsService=o,this.loading=Object(s.a)(!0),this.uploadFilesOptions=new d.a,this.subs=[],this.isActive=!0}ngOnChanges(e){e.collectionId&&this.collectionId&&e.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe(Object(o.a)(()=>this.isActive),Object(a.a)(e=>e.isLoading),Object(a.a)(e=>e),Object(r.a)(),Object(c.a)(e=>e?Object(s.a)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,p.a.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe(Object(o.a)(()=>this.isActive),Object(a.a)(e=>e.isLoading),Object(a.a)(e=>e),Object(r.a)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe(Object(o.a)(e=>Object(l.e)(e)),Object(r.a)()).subscribe(e=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=e.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(e=>Object(l.b)(e)).forEach(e=>e.unsubscribe())}onCollectionChange(e){this.collectionId=e.collection.id,this.definitionId!==e.submissionDefinition.name?(this.sections=e.sections,this.submissionDefinition=e.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,e._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe(Object(o.a)(e=>Object(l.e)(e)),Object(a.a)(e=>e))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](u.a),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](m.a),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](h.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:18,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[3,"currentCollectionId","currentDefinition","submissionId","collectionChange"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,j,17,8,"div",1),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n\n    "),i["\u0275\u0275elementStart"](5,"div",2),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,C,1,0,"ds-loading",3),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275template"](10,E,4,3,"ng-container",4),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275text"](12,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n    "),i["\u0275\u0275template"](14,D,4,1,"div",5),i["\u0275\u0275pipe"](15,"async"),i["\u0275\u0275text"](16,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](17,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](3,4,t.isLoading())),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,6,t.isLoading())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngForOf",i["\u0275\u0275pipeBind1"](11,8,t.submissionSections)),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](15,10,t.isLoading())))},directives:[f.p,f.o,v.a,g.a,S.a,x.a,I.a,O.a],pipes:[f.b],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:hsla(0,0%,100%,.97);padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus.disabled[_ngcontent-%COMP%], .btn-link-focus[_ngcontent-%COMP%]:disabled{color:#6c757d;pointer-events:none}.btn-link-focus.focus[_ngcontent-%COMP%], .btn-link-focus[_ngcontent-%COMP%]:focus{text-decoration:underline}"]}),e})()},ph1m:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n("fXoL"),s=n("lJxs"),o=n("YJD6"),a=n("J/vq"),r=n("14tD"),c=n("1kSV"),l=n("ofXK"),d=n("sYmb");function p(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"button",7),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n      ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections.general.no-sections"),"\n    "))}function u(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",8),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const n=t.$implicit;return i["\u0275\u0275nextContext"]().addSection(n.id)})),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n      ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections."+e.header),"\n    ")}}const m=function(e){return{"w-100":e}};let b=(()=>{class e{constructor(e,t,n){this.sectionService=e,this.submissionService=t,this.windowService=n}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe(Object(s.a)(e=>e.length>0))}addSection(e){this.sectionService.addSection(this.submissionId,e)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](o.a),i["\u0275\u0275directiveInject"](a.a),i["\u0275\u0275directiveInject"](r.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},decls:22,vars:25,consts:[["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["sectionAdd","ngbDropdown"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"disabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0,1),i["\u0275\u0275text"](2,"\n  "),i["\u0275\u0275elementStart"](3,"button",2),i["\u0275\u0275pipe"](4,"async"),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275element"](8,"i",3),i["\u0275\u0275text"](9,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n  "),i["\u0275\u0275elementStart"](11,"div",4),i["\u0275\u0275pipe"](12,"async"),i["\u0275\u0275text"](13,"\n    "),i["\u0275\u0275template"](14,p,3,3,"button",5),i["\u0275\u0275pipe"](15,"async"),i["\u0275\u0275text"](16,"\n    "),i["\u0275\u0275template"](17,u,3,3,"button",6),i["\u0275\u0275pipe"](18,"async"),i["\u0275\u0275text"](19,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](21,"\n")),2&e&&(i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](19,m,t.windowService.isXs())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("disabled",!i["\u0275\u0275pipeBind1"](4,7,t.hasSections$))("ngClass",i["\u0275\u0275pureFunction1"](21,m,i["\u0275\u0275pipeBind1"](5,9,t.windowService.isXs()))),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind1"](7,11,"submission.sections.general.add-more")," "),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](23,m,i["\u0275\u0275pipeBind1"](12,13,t.windowService.isXs()))),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](15,15,t.hasSections$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngForOf",i["\u0275\u0275pipeBind1"](18,17,t.sectionList$)))},directives:[c.j,l.m,c.o,c.m,l.p,l.o],pipes:[l.b,d.d],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]}),e})()},qK5G:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("fXoL"),s=n("JTKQ");function o(e,t){}let a=(()=>{class e extends s.a{getComponentName(){return"SubmissionImportExternalComponent"}importThemedComponent(e){return n("JHLN")(`./${e}/app/submission/import-external/submission-import-external.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(null,"RMpN"))}}return e.\u0275fac=function(t){return r(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-themed-submission-import-external"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:0,consts:[["vcr",""]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,o,0,0,"ng-template",null,0,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](2,"\n"))},encapsulation:2}),e})();const r=i["\u0275\u0275getInheritedFactory"](a)},wQzj:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var i=n("fXoL"),s=n("2Vo4"),o=n("LRne"),a=n("cBqT"),r=n("lJxs"),c=n("5+tZ"),l=n("J3qs"),d=n("0VLH"),p=n("Oqsf"),u=n("1QIV"),m=n("4GeW"),b=n("DNva"),h=n("BVmw"),f=n("QjZv"),v=n("J/vq"),g=n("YJD6"),S=n("ofXK"),x=n("1kSV"),I=n("sYmb");function O(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275elementStart"](2,"div",3),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementStart"](4,"span",4),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementStart"](9,"div",5),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementStart"](11,"span",4),i["\u0275\u0275text"](12),i["\u0275\u0275pipe"](13,"async"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n  "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"submission.sections.general.collection")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](13,4,e.selectedCollectionName$))}}function y(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275element"](1,"i",13),i["\u0275\u0275elementEnd"]())}function j(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,e.selectedCollectionName$))}}function C(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",6,7),i["\u0275\u0275listener"]("openChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().toggled(t)})),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"div",3),i["\u0275\u0275text"](4,"\n      "),i["\u0275\u0275elementStart"](5,"span",8),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n    "),i["\u0275\u0275elementStart"](10,"button",9),i["\u0275\u0275listener"]("blur",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onClose()}))("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onClose()})),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275text"](12,"\n      "),i["\u0275\u0275template"](13,y,2,0,"span",10),i["\u0275\u0275pipe"](14,"async"),i["\u0275\u0275text"](15,"\n      "),i["\u0275\u0275template"](16,j,3,3,"span",10),i["\u0275\u0275pipe"](17,"async"),i["\u0275\u0275text"](18,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n\n    "),i["\u0275\u0275elementStart"](20,"div",11),i["\u0275\u0275text"](21,"\n      "),i["\u0275\u0275elementStart"](22,"ds-collection-dropdown",12),i["\u0275\u0275listener"]("selectionChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onSelect(t)})),i["\u0275\u0275text"](23,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n  "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"]("\n        ",i["\u0275\u0275pipeBind1"](7,4,"submission.sections.general.collection"),"\n      "),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](11,6,e.processingChange$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](14,8,e.processingChange$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](17,10,e.processingChange$))}}let E=(()=>{class e{constructor(e,t,n,o,a,r){this.cdr=e,this.collectionDataService=t,this.operationsBuilder=n,this.operationsService=o,this.submissionService=a,this.sectionsService=r,this.collectionChange=new i.EventEmitter,this.processingChange$=new s.a(!1),this.subs=[]}ngOnChanges(e){Object(l.b)(e.currentCollectionId)&&Object(l.b)(e.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe(Object(a.a)(e=>Object(l.e)(e.payload)),Object(r.a)(e=>e.payload.name)))}ngOnInit(){this.pathCombiner=new d.a("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,m.a.collection)}ngOnDestroy(){this.subs.filter(e=>Object(l.b)(e)).forEach(e=>e.unsubscribe())}onSelect(e){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),e.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe(Object(c.a)(e=>this.submissionService.retrieveSubmission(e[0].id).pipe(Object(u.j)()))).subscribe(t=>{this.selectedCollectionId=e.collection.id,this.selectedCollectionName$=Object(o.a)(e.collection.name),this.collectionChange.emit(t),this.submissionService.changeSubmissionCollection(this.submissionId,e.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown.reset()}toggled(e){e||this.collectionDropdown.reset()}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](h.a),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](g.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form-collection"]],viewQuery:function(e,t){if(1&e&&i["\u0275\u0275viewQuery"](p.a,1),2&e){let e;i["\u0275\u0275queryRefresh"](e=i["\u0275\u0275loadQuery"]())&&(t.collectionDropdown=e.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",submissionId:"submissionId"},outputs:{collectionChange:"collectionChange"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:9,vars:6,consts:[["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["collectionControls","ngbDropdown"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"disabled","blur","click"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275template"](2,O,16,6,"div",0),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n  "),i["\u0275\u0275template"](5,C,26,12,"div",1),i["\u0275\u0275pipe"](6,"async"),i["\u0275\u0275text"](7,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](3,2,t.available$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](6,4,t.available$)))},directives:[S.p,x.j,x.o,x.m,p.a],pipes:[S.b,I.d],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;left:0!important;-webkit-box-shadow:var(--bs-btn-focus-box-shadow);box-shadow:var(--bs-btn-focus-box-shadow)}"]}),e})()},yAsG:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n("fXoL"),s=n("LRne"),o=n("lJxs"),a=n("drGc"),r=n("J3qs"),c=n("1kSV"),l=n("8nsN"),d=n("J/vq"),p=n("ofXK"),u=n("sYmb");function m(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",13),i["\u0275\u0275listener"]("click",(function(t){i["\u0275\u0275restoreView"](e);const n=i["\u0275\u0275nextContext"](2),s=i["\u0275\u0275reference"](3);return t.preventDefault(),n.confirmDiscard(s)})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275element"](4,"i",14),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](1,2,e.processingSaveStatus)||i["\u0275\u0275pipeBind1"](2,4,e.processingDepositStatus)),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](6,6,"submission.general.discard.submit"),"\n    ")}}function b(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"i",15),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](4,1,"submission.general.info.saved"),"\n    "))}function h(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"i",16),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](4,1,"submission.general.info.pending-changes"),"\n    "))}function f(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",20),i["\u0275\u0275text"](1,"Saving..."),i["\u0275\u0275elementEnd"]()),2&e&&i["\u0275\u0275styleProp"]("width","100%")}function v(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",20),i["\u0275\u0275text"](1,"Depositing..."),i["\u0275\u0275elementEnd"]()),2&e&&i["\u0275\u0275styleProp"]("width","100%")}function g(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",17),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"div",18),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,f,2,2,"div",19),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,v,2,2,"div",19),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](5,2,e.processingSaveStatus)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,4,e.processingDepositStatus))}}function S(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",21),i["\u0275\u0275listener"]("click",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).deposit(t)})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"span"),i["\u0275\u0275element"](5,"i",22),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n      "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](1,2,e.processingSaveStatus)||i["\u0275\u0275pipeBind1"](2,4,e.processingDepositStatus)),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](7,6,"submission.general.deposit"),"")}}function x(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",3),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275template"](4,m,7,8,"button",4),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n  "),i["\u0275\u0275elementStart"](8,"div",5),i["\u0275\u0275text"](9,"\n    "),i["\u0275\u0275template"](10,b,5,3,"span",6),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275pipe"](12,"async"),i["\u0275\u0275pipe"](13,"async"),i["\u0275\u0275text"](14,"\n    "),i["\u0275\u0275template"](15,h,5,3,"span",6),i["\u0275\u0275pipe"](16,"async"),i["\u0275\u0275pipe"](17,"async"),i["\u0275\u0275pipe"](18,"async"),i["\u0275\u0275text"](19,"\n    "),i["\u0275\u0275template"](20,g,11,6,"div",7),i["\u0275\u0275pipe"](21,"async"),i["\u0275\u0275pipe"](22,"async"),i["\u0275\u0275text"](23,"\n    "),i["\u0275\u0275elementStart"](24,"div",8),i["\u0275\u0275text"](25,"\n      "),i["\u0275\u0275elementStart"](26,"button",9),i["\u0275\u0275listener"]("click",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().save(t)})),i["\u0275\u0275pipe"](27,"async"),i["\u0275\u0275pipe"](28,"async"),i["\u0275\u0275text"](29,"\n        "),i["\u0275\u0275elementStart"](30,"span"),i["\u0275\u0275element"](31,"i",10),i["\u0275\u0275text"](32),i["\u0275\u0275pipe"](33,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](34,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](35,"\n      "),i["\u0275\u0275elementStart"](36,"button",11),i["\u0275\u0275listener"]("click",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().saveLater(t)})),i["\u0275\u0275pipe"](37,"async"),i["\u0275\u0275pipe"](38,"async"),i["\u0275\u0275pipe"](39,"async"),i["\u0275\u0275pipe"](40,"async"),i["\u0275\u0275text"](41,"\n        "),i["\u0275\u0275elementStart"](42,"span"),i["\u0275\u0275element"](43,"i",10),i["\u0275\u0275text"](44),i["\u0275\u0275pipe"](45,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](46,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](47,"\n      "),i["\u0275\u0275template"](48,S,9,8,"button",12),i["\u0275\u0275pipe"](49,"async"),i["\u0275\u0275text"](50,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](51,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](52,"\n"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](5,13,e.showDepositAndDiscard)),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](11,15,e.hasUnsavedModification)&&!i["\u0275\u0275pipeBind1"](12,17,e.processingSaveStatus)&&!i["\u0275\u0275pipeBind1"](13,19,e.processingDepositStatus)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](16,21,e.hasUnsavedModification)&&!i["\u0275\u0275pipeBind1"](17,23,e.processingSaveStatus)&&!i["\u0275\u0275pipeBind1"](18,25,e.processingDepositStatus)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](21,27,e.processingSaveStatus)||i["\u0275\u0275pipeBind1"](22,29,e.processingDepositStatus)),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](27,31,e.processingSaveStatus)||!i["\u0275\u0275pipeBind1"](28,33,e.hasUnsavedModification)),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](33,35,"submission.general.save"),""),i["\u0275\u0275advance"](4),i["\u0275\u0275classProp"]("btn-primary",!i["\u0275\u0275pipeBind1"](37,37,e.showDepositAndDiscard))("btn-secondary",i["\u0275\u0275pipeBind1"](38,39,e.showDepositAndDiscard)),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](39,41,e.processingSaveStatus)||i["\u0275\u0275pipeBind1"](40,43,e.processingDepositStatus)),i["\u0275\u0275advance"](8),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](45,45,"submission.general.save-later"),""),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](49,47,e.showDepositAndDiscard))}}function I(e,t){1&e&&(i["\u0275\u0275text"](0,"\n  "),i["\u0275\u0275elementStart"](1,"div",23),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"h4",24),i["\u0275\u0275text"](4),i["\u0275\u0275pipe"](5,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n    "),i["\u0275\u0275elementStart"](7,"button",25),i["\u0275\u0275listener"]("click",(function(){return(0,t.dismiss)("cancel")})),i["\u0275\u0275text"](8,"\n      "),i["\u0275\u0275elementStart"](9,"span",26),i["\u0275\u0275text"](10,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementStart"](14,"div",27),i["\u0275\u0275text"](15,"\n    "),i["\u0275\u0275elementStart"](16,"p"),i["\u0275\u0275text"](17),i["\u0275\u0275pipe"](18,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n  "),i["\u0275\u0275elementStart"](21,"div",28),i["\u0275\u0275text"](22,"\n    "),i["\u0275\u0275elementStart"](23,"button",29),i["\u0275\u0275listener"]("click",(function(){return(0,t.close)("cancel")})),i["\u0275\u0275text"](24),i["\u0275\u0275pipe"](25,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](26,"\n    "),i["\u0275\u0275elementStart"](27,"button",30),i["\u0275\u0275listener"]("click",(function(){return(0,t.close)("ok")})),i["\u0275\u0275text"](28),i["\u0275\u0275pipe"](29,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](30,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n")),2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](5,4,"submission.general.discard.confirm.title")),i["\u0275\u0275advance"](13),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](18,6,"submission.general.discard.confirm.info")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](25,8,"submission.general.discard.confirm.cancel")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](29,10,"submission.general.discard.confirm.submit")))}let O=(()=>{class e{constructor(e,t,n){this.modalService=e,this.restService=t,this.submissionService=n,this.submissionIsInvalid=Object(s.a)(!0)}ngOnChanges(e){Object(r.e)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe(Object(o.a)(e=>!1===e)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=Object(s.a)(this.submissionService.getSubmissionScope()===a.a.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(e){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(e){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(e){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(e){this.modalService.open(e).result.then(e=>{"ok"===e&&this.submissionService.dispatchDiscard(this.submissionId)})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](c.q),i["\u0275\u0275directiveInject"](l.a),i["\u0275\u0275directiveInject"](d.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:5,vars:1,consts:[["class","row",4,"ngIf"],["content",""],[1,"row"],[1,"col"],["type","button","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2"],["type","button","id","save",1,"btn","btn-secondary",3,"disabled","click"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"disabled","click"],["type","button","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,x,53,49,"div",0),i["\u0275\u0275text"](1,"\n\n"),i["\u0275\u0275template"](2,I,32,12,"ng-template",null,1,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](4,"\n")),2&e&&i["\u0275\u0275property"]("ngIf",!!t.submissionId)},directives:[p.p],pipes:[p.b,u.d],styles:[""]}),e})()}}]);
//# sourceMappingURL=5-es2015.bedd1e7b53419044710b.js.map