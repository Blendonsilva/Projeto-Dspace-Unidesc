!function(){function e(){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,i){var o=t(e,n);if(o){var r=Object.getOwnPropertyDescriptor(o,n);return r.get?r.get.call(arguments.length<3?e:i):r.value}}).apply(this,arguments)}function t(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw s}}}}function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,o,r=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(c){a=!0,o=c}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return m(this,n)}}function m(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[5,14],{"0VLH":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("J3qs"),o=function(e){u(n,e);var t=p(n);function n(e){var i;a(this,n);for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];return(i=t.call.apply(t,[this,e].concat(r)))._rootElement=e,i._subRootElement=r.join("/"),i}return l(n,[{key:"rootElement",get:function(){return this._rootElement}},{key:"subRootElement",get:function(){return this._subRootElement}},{key:"getPath",value:function(e){Object(i.h)(e)&&Array.isArray(e)&&(e=e.join("/"));var t="/"+this.toString();return Object(i.h)(e)&&(t+="/"+e),{rootElement:this._rootElement,subRootElement:this._subRootElement,path:t}}}]),n}(n("zZO8").a)},"20cJ":function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n("fXoL"),o=n("/eM4"),r=n("5+tZ"),s=n("6c/T"),c=n("1kSV"),u=n("J/vq"),d=n("tyNb"),p=n("lI3o"),m=n("ofXK"),f=n("sYmb");function b(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",5),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"div",6),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"strong"),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementStart"](8,"p"),i["\u0275\u0275text"](9),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"item.preview."+n.key)),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](n.value.value)}}var v=function(){var e=function(){function e(t,n,i,o,r){a(this,e),this.activeModal=t,this.submissionService=n,this.modalService=i,this.router=o,this.notificationService=r}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.metadataList=[],Object.keys(this.externalSourceEntry.metadata).forEach((function(t){e.metadataList.push({key:t,value:o.a.first(e.externalSourceEntry.metadata,t)})}))}},{key:"closeMetadataModal",value:function(){this.activeModal.dismiss(!1)}},{key:"import",value:function(){var e=this;this.modalRef=this.modalService.open(s.a,{size:"lg"}),this.modalRef.componentInstance.entityType=this.labelPrefix,this.closeMetadataModal(),this.modalRef.componentInstance.selectedEvent.pipe(Object(r.a)((function(t){return e.submissionService.createSubmissionFromExternalSource(e.externalSourceEntry._links.self.href,t.collection.id)}))).subscribe((function(t){var n=!1;1===t.length&&null!==t[0]&&(n=!0,e.router.navigateByUrl("/workspaceitems/"+t[0].id+"/edit")),n||e.notificationService.error("submission.import-external.preview.error.import.title","submission.import-external.preview.error.import.body"),e.modalRef.close()}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](c.c),i["\u0275\u0275directiveInject"](u.a),i["\u0275\u0275directiveInject"](c.q),i["\u0275\u0275directiveInject"](d.h),i["\u0275\u0275directiveInject"](p.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-import-external-preview"]],inputs:{externalSourceEntry:"externalSourceEntry"},decls:59,vars:10,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-12"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-12","text-right"],["role","button",1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fa","fa-file-import"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"h2"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementStart"](6,"button",1),i["\u0275\u0275listener"]("click",(function(){return t.closeMetadataModal()})),i["\u0275\u0275text"](7,"\n      "),i["\u0275\u0275elementStart"](8,"span",2),i["\u0275\u0275text"](9,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n"),i["\u0275\u0275elementStart"](13,"div",3),i["\u0275\u0275text"](14,"\n  "),i["\u0275\u0275elementStart"](15,"div",4),i["\u0275\u0275text"](16,"\n    "),i["\u0275\u0275elementStart"](17,"div",5),i["\u0275\u0275text"](18,"\n      "),i["\u0275\u0275elementStart"](19,"div",6),i["\u0275\u0275text"](20,"\n        "),i["\u0275\u0275elementStart"](21,"p"),i["\u0275\u0275text"](22),i["\u0275\u0275pipe"](23,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](26,"\n    "),i["\u0275\u0275elementStart"](27,"div",5),i["\u0275\u0275text"](28,"\n      "),i["\u0275\u0275elementStart"](29,"div",6),i["\u0275\u0275text"](30,"\n        "),i["\u0275\u0275element"](31,"hr"),i["\u0275\u0275text"](32,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](33,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](34,"\n    "),i["\u0275\u0275template"](35,b,12,4,"div",7),i["\u0275\u0275text"](36,"\n    "),i["\u0275\u0275elementStart"](37,"div",5),i["\u0275\u0275text"](38,"\n      "),i["\u0275\u0275elementStart"](39,"div",6),i["\u0275\u0275text"](40,"\n        "),i["\u0275\u0275element"](41,"hr"),i["\u0275\u0275text"](42,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](43,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](44,"\n    "),i["\u0275\u0275elementStart"](45,"div",5),i["\u0275\u0275text"](46,"\n      "),i["\u0275\u0275elementStart"](47,"div",8),i["\u0275\u0275text"](48,"\n        "),i["\u0275\u0275elementStart"](49,"button",9),i["\u0275\u0275listener"]("click",(function(){return t.import()})),i["\u0275\u0275text"](50,"\n          "),i["\u0275\u0275element"](51,"i",10),i["\u0275\u0275text"](52),i["\u0275\u0275pipe"](53,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](54,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](55,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](56,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](57,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](58,"\n")),2&e&&(i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,4,"submission.import-external.preview.title."+t.labelPrefix)),i["\u0275\u0275advance"](19),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](23,6,"submission.import-external.preview.subtitle")),i["\u0275\u0275advance"](13),i["\u0275\u0275property"]("ngForOf",t.metadataList),i["\u0275\u0275advance"](17),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](53,8,"submission.import-external.preview.button.import"),"\n        "))},directives:[m.o],pipes:[f.d],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),e}()},"3aq+":function(e,t,n){var i={"./custom/app/submission/edit/submission-edit.component":["OutP",78]};function o(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(i)},o.id="3aq+",e.exports=o},"3cpT":function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n("fXoL"),o=n("LRne"),r=n("JIr8"),s=n("vkgz"),c=n("Hl3I"),u=n("f+Ev"),d=n("oBfO"),p=n("GG8d"),m=n("B/au"),f=n("1QIV"),b=n("J3qs"),v=n("dHui"),h=n("14tD"),g=n("ofXK"),y=n("1kSV"),S=n("dlKe"),x=n("3Pt+"),I=n("sYmb");function O(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",10),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"input",11),i["\u0275\u0275listener"]("keyup.enter",(function(){i["\u0275\u0275restoreView"](n);var e=i["\u0275\u0275nextContext"]();return""===e.searchString?null:e.search()}))("ngModelChange",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().searchString=e})),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n"),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275propertyInterpolate"]("placeholder",i["\u0275\u0275pipeBind1"](3,2,"submission.import-external.search.placeholder")),i["\u0275\u0275property"]("ngModel",o.searchString)}}function j(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"input",11),i["\u0275\u0275listener"]("keyup.enter",(function(){i["\u0275\u0275restoreView"](n);var e=i["\u0275\u0275nextContext"]();return""===e.searchString?null:e.search()}))("ngModelChange",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().searchString=e})),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275propertyInterpolate"]("placeholder",i["\u0275\u0275pipeBind1"](1,2,"submission.import-external.search.placeholder")),i["\u0275\u0275property"]("ngModel",o.searchString)}}function C(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",12),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](n);var e=t.$implicit;return i["\u0275\u0275nextContext"]().makeSourceSelection(e)})),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){var o=t.$implicit;i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.import-external.source."+(null==o?null:o.name))),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](3,4,"submission.import-external.source."+(null==o?null:o.name)))}}function E(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",13),i["\u0275\u0275elementStart"](1,"p"),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](3,1,"submission.import-external.source.loading")))}var D=function(e){return{"input-group-append":e}},w=function(){var e=function(){function e(t,n,o){a(this,e),this.externalService=t,this.cdr=n,this.windowService=o,this.sourceListLoading=!1,this.externalSourceData=new i.EventEmitter}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedElement={id:"",name:"loading"},this.searchString="",this.sourceList=[],this.findListOptions=Object.assign({},new m.f,{elementsPerPage:5,currentPage:1,searchParams:[new c.a("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe(Object(r.a)((function(){var e=new d.a,t=Object(u.b)(e,[]),n=Object(p.c)(t);return Object(o.a)(n)})),Object(f.j)()).subscribe((function(t){t.page.forEach((function(t){e.sourceList.push({id:t.id,name:t.name}),e.initExternalSourceData.sourceId===t.id&&(e.selectedElement={id:t.id,name:t.name},e.searchString=e.initExternalSourceData.query)})),""===e.selectedElement.id&&(e.selectedElement=e.sourceList[0]),e.pageInfo=t.pageInfo,e.cdr.detectChanges()})),this.isXsOrSm$=this.windowService.isXsOrSm()}},{key:"makeSourceSelection",value:function(e){this.selectedElement=e}},{key:"onScroll",value:function(){var e=this;!this.sourceListLoading&&this.pageInfo.currentPage+1<=this.pageInfo.totalPages&&(this.sourceListLoading=!0,this.findListOptions=Object.assign({},new m.f,{elementsPerPage:5,currentPage:this.findListOptions.currentPage+1,searchParams:[new c.a("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe(Object(r.a)((function(){var e=new d.a,t=Object(u.b)(e,[]),n=Object(p.c)(t);return Object(o.a)(n)})),Object(f.i)(),Object(s.a)((function(){return e.sourceListLoading=!1}))).subscribe((function(t){t.payload.page.forEach((function(t){e.sourceList.push({id:t.id,name:t.name})})),e.pageInfo=t.payload.pageInfo,e.cdr.detectChanges()})))}},{key:"search",value:function(){this.externalSourceData.emit({entity:this.initExternalSourceData.entity,sourceId:this.selectedElement.id,query:this.searchString})}},{key:"ngOnDestroy",value:function(){Object(b.b)(this.sub)&&this.sub.unsubscribe()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](h.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-import-external-searchbar"]],inputs:{initExternalSourceData:"initExternalSourceData"},outputs:{externalSourceData:"externalSourceData"},decls:34,vars:31,consts:[["class","input-group mb-2",4,"ngIf"],[1,"input-group","mb-5"],["type","text","class","form-control","aria-label","","aria-describedby","",3,"ngModel","placeholder","keyup.enter","ngModelChange",4,"ngIf"],["ngbDropdown","","role","group","aria-label","",3,"ngClass"],["ngbDropdownToggle","",1,"btn","btn-outline-secondary","w-fx",3,"title"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false","aria-labelledby","scrollableDropdownMenuButton",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["aria-labelledby","scrollableDropdownMenuButton","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow","scrolled"],["ngbDropdownItem","","class","dropdown-item text-truncate",3,"title","click",4,"ngFor","ngForOf"],["ngbDropdownItem","","class","scrollable-dropdown-loading text-center",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"title","disabled","click"],[1,"input-group","mb-2"],["type","text","aria-label","","aria-describedby","",1,"form-control",3,"ngModel","placeholder","keyup.enter","ngModelChange"],["ngbDropdownItem","",1,"dropdown-item","text-truncate",3,"title","click"],["ngbDropdownItem","",1,"scrollable-dropdown-loading","text-center"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,O,5,4,"div",0),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n"),i["\u0275\u0275elementStart"](3,"div",1),i["\u0275\u0275text"](4,"\n  "),i["\u0275\u0275template"](5,j,2,4,"input",2),i["\u0275\u0275pipe"](6,"async"),i["\u0275\u0275text"](7,"\n  "),i["\u0275\u0275elementStart"](8,"div",3),i["\u0275\u0275pipe"](9,"async"),i["\u0275\u0275text"](10,"\n    "),i["\u0275\u0275elementStart"](11,"button",4),i["\u0275\u0275pipe"](12,"translate"),i["\u0275\u0275text"](13),i["\u0275\u0275pipe"](14,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n    "),i["\u0275\u0275elementStart"](16,"div",5),i["\u0275\u0275text"](17,"\n      "),i["\u0275\u0275elementStart"](18,"div",6),i["\u0275\u0275listener"]("scrolled",(function(){return t.onScroll()})),i["\u0275\u0275text"](19,"\n        "),i["\u0275\u0275template"](20,C,4,6,"button",7),i["\u0275\u0275text"](21,"\n        "),i["\u0275\u0275template"](22,E,4,3,"div",8),i["\u0275\u0275text"](23,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n    "),i["\u0275\u0275elementStart"](26,"button",9),i["\u0275\u0275listener"]("click",(function(){return t.search()})),i["\u0275\u0275pipe"](27,"translate"),i["\u0275\u0275pipe"](28,"translate"),i["\u0275\u0275text"](29),i["\u0275\u0275pipe"](30,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](32,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](33,"\n")),2&e&&(i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](1,13,t.isXsOrSm$)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](6,15,t.isXsOrSm$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](29,D,!i["\u0275\u0275pipeBind1"](9,17,t.isXsOrSm$))),i["\u0275\u0275advance"](3),i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](12,19,"submission.import-external.search.source.hint")),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](14,21,"submission.import-external.source."+(null==t.selectedElement?null:t.selectedElement.name))),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",t.sourceList),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.sourceListLoading),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("title",""===t.searchString?i["\u0275\u0275pipeBind1"](27,23,"submission.import-external.search.button.hint"):i["\u0275\u0275pipeBind1"](28,25,"submission.import-external.search.button"))("disabled",""===t.searchString),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](30,27,"submission.import-external.search.button")))},directives:[g.p,y.j,g.m,y.o,y.m,S.a,g.o,x.DefaultValueAccessor,x.NgControlStatus,x.NgModel,y.l],pipes:[g.b,I.d],styles:[".input-group-append[_ngcontent-%COMP%]:last-child > .btn[_ngcontent-%COMP%]:not(:last-child):not(.dropdown-toggle){margin-left:-1px;border-radius:0 .25rem .25rem 0}.input-group-append[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{border-radius:0}.w-fx[_ngcontent-%COMP%]{min-width:200px}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:calc(var(--ds-dropdown-menu-max-height) / 2);overflow-x:hidden}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;height:calc(var(--bs-spacer) * 2)!important;line-height:calc(var(--bs-spacer) * 2);position:-webkit-sticky;position:sticky;bottom:0}"]}),e}()},"4GeW":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(e){return e.Relationships="relationships",e.SubmissionForm="submission-form",e.Upload="upload",e.License="license",e.CcLicense="cclicense",e.collection="collection",e.AccessesCondition="accessCondition",e}({})},"Ahb/":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("fXoL"),o=n("JTKQ");function r(e,t){}var s=function(){var e=function(e){u(i,e);var t=p(i);function i(){return a(this,i),t.apply(this,arguments)}return l(i,[{key:"getComponentName",value:function(){return"SubmissionSubmitComponent"}},{key:"importThemedComponent",value:function(e){return n("TkMu")("./".concat(e,"/app/submission/submit/submission-submit.component"))}},{key:"importUnthemedComponent",value:function(){return Promise.resolve().then(n.bind(null,"THnG"))}}]),i}(o.a);return e.\u0275fac=function(t){return c(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-themed-submission-submit"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:0,consts:[["vcr",""]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,r,0,0,"ng-template",null,0,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](2,"\n"))},encapsulation:2}),e}(),c=i["\u0275\u0275getInheritedFactory"](s)},JHLN:function(e,t,n){var i={"./custom/app/submission/import-external/submission-import-external.component":["mVFA",79]};function o(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(i)},o.id="JHLN",e.exports=o},RMpN:function(e,t,n){"use strict";n.r(t),n.d(t,"SubmissionImportExternalComponent",(function(){return J}));var i=n("fXoL"),r=n("2Vo4"),s=n("itXk"),c=n("IzEk"),u=n("pLZG"),d=n("eIep"),p=n("vkgz"),m=n("5+tZ"),f=n("f+Ev"),b=n("ynxc"),v=n("7DXY"),h=n("GG8d"),g=n("20cJ"),y=n("mEo1"),S=n("oBfO"),x=n("J3qs"),I=n("1QIV"),O=n("dnwH"),j=n("joI/"),C=n("dHui"),E=n("ppE2"),D=n("tyNb"),w=n("1kSV"),k=n("3cpT"),F=n("ofXK"),B=n("O/5o"),M=n("jLV+"),L=n("Frqi"),T=n("VYMa"),R=n("sYmb");function V(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"h3"),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,"submission.sections.describe.relationship-lookup.selection-tab.title")))}var P=function(e,t){return{repeatable:e,listId:t}};function $(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-viewable-collection",14),i["\u0275\u0275listener"]("importObject",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"](4).import(e)})),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]().ngVar,r=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("@fadeIn",void 0)("objects",o)("selectionConfig",i["\u0275\u0275pureFunction2"](8,P,r.repeatable,r.listId))("config",r.initialPagination)("hideGear",!0)("context",r.context)("importable",!0)("importConfig",r.importConfig)}}function A(e,t){1&e&&(i["\u0275\u0275element"](0,"ds-loading",15),i["\u0275\u0275pipe"](1,"translate")),2&e&&i["\u0275\u0275propertyInterpolate"]("message",i["\u0275\u0275pipeBind1"](1,1,"loading.search-results"))}function _(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",16),i["\u0275\u0275text"](1,"\n          "),i["\u0275\u0275elementStart"](2,"ds-alert",17),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("type","alert-info"),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,2,"search.results.empty")))}function q(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,V,3,3,"h3",10),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,$,2,11,"ds-viewable-collection",11),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,A,2,3,"ds-loading",12),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275template"](10,_,6,4,"div",13),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275text"](12,"\n      "),i["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.ngVar,o=i["\u0275\u0275nextContext"](3);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",n&&0!==(null==n||null==n.payload||null==n.payload.page?null:n.payload.page.length)),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",(null==n?null:n.hasSucceeded)&&!i["\u0275\u0275pipeBind1"](5,4,o.isLoading$)&&(null==n||null==n.payload||null==n.payload.page?null:n.payload.page.length)>0),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,6,o.isLoading$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](11,8,o.isLoading$)&&0===(null==n||null==n.payload||null==n.payload.page?null:n.payload.page.length))}}function U(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275template"](2,q,13,10,"ng-container",9),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngVar",i["\u0275\u0275pipeBind1"](3,1,n.entriesRD$))}}function N(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"ds-alert",17),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"p",18),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("type","alert-info"),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"submission.import-external.page.hint")))}function G(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",1),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,U,5,3,"div",8),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275template"](4,N,9,4,"div",8),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""!==n.reload$.value.sourceId),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",""===n.reload$.value.sourceId)}}var Q=function(){return["/mydspace"]},J=function(){var e=function(){function e(t,n,i,o,s){a(this,e),this.searchConfigService=t,this.externalService=n,this.routeService=i,this.router=o,this.modalService=s,this.entriesRD$=new r.a(null),this.isLoading$=new r.a(!1),this.reload$=new r.a({entity:"",query:"",sourceId:""}),this.initialPagination=Object.assign(new v.a,{id:"spc",pageSize:10}),this.subs=[]}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.listId="list-submission-external-sources",this.context=b.a.EntitySearchModalWithNameVariants,this.repeatable=!1,this.routeData={entity:"",sourceId:"",query:""},this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label},this.entriesRD$=new r.a(Object(h.c)(Object(f.b)(new S.a,[]))),this.isLoading$=new r.a(!1),this.subs.push(Object(s.a)([this.routeService.getQueryParameterValue("entity"),this.routeService.getQueryParameterValue("sourceId"),this.routeService.getQueryParameterValue("query")]).pipe(Object(c.a)(1)).subscribe((function(t){var n=o(t,3),i=n[0],r=n[1],s=n[2];e.reload$.next({entity:i||O.b,query:s,sourceId:r}),e.selectLabel(i),e.retrieveExternalSources()})))}},{key:"getExternalSourceData",value:function(e){var t=this;this.router.navigate([],{queryParams:e,replaceUrl:!0}).then((function(){t.reload$.next(e),t.retrieveExternalSources()}))}},{key:"import",value:function(e){this.modalRef=this.modalService.open(g.a,{size:"lg"});var t=this.modalRef.componentInstance;t.externalSourceEntry=e,t.labelPrefix=this.label}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(x.b)(e)})).forEach((function(e){return e.unsubscribe()})),Object(x.b)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe()}},{key:"retrieveExternalSources",value:function(){var e=this;Object(x.b)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe(),this.retrieveExternalSourcesSub=this.reload$.pipe(Object(u.a)((function(e){return Object(x.e)(e.sourceId)&&Object(x.e)(e.query)})),Object(d.a)((function(t){var n=t.query;return e.routeData=t,e.searchConfigService.paginatedSearchOptions.pipe(Object(p.a)((function(){return e.isLoading$.next(!0)})),Object(u.a)((function(e){return e.query===n})),Object(m.a)((function(t){return e.externalService.getExternalSourceEntries(e.routeData.sourceId,t).pipe(Object(I.f)())})))}))).subscribe((function(t){e.entriesRD$.next(t),e.isLoading$.next(!1)}))}},{key:"selectLabel",value:function(e){this.label=e,this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](j.a),i["\u0275\u0275directiveInject"](C.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](D.h),i["\u0275\u0275directiveInject"](w.q))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-import-external"]],decls:32,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],["id","header",1,"pb-2"],[3,"initExternalSourceData","externalSourceData"],["class","row",4,"ngIf"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-chevron-left"],["class","col-md-12",4,"ngIf"],[4,"ngVar"],[4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject",4,"ngIf"],[3,"message",4,"ngIf"],["id","empty-external-entry-list",4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject"],[3,"message"],["id","empty-external-entry-list"],[3,"type"],[1,"lead","mb-0"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",1),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementStart"](4,"div",2),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementStart"](6,"h2",3),i["\u0275\u0275text"](7),i["\u0275\u0275pipe"](8,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275elementStart"](10,"ds-submission-import-external-searchbar",4),i["\u0275\u0275listener"]("externalSourceData",(function(e){return t.getExternalSourceData(e)})),i["\u0275\u0275text"](11,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n  "),i["\u0275\u0275template"](15,G,6,2,"div",5),i["\u0275\u0275text"](16,"\n\n  "),i["\u0275\u0275elementStart"](17,"div",1),i["\u0275\u0275text"](18,"\n    "),i["\u0275\u0275elementStart"](19,"div",2),i["\u0275\u0275text"](20,"\n      "),i["\u0275\u0275element"](21,"hr"),i["\u0275\u0275text"](22,"\n      "),i["\u0275\u0275elementStart"](23,"a",6),i["\u0275\u0275text"](24,"\n        "),i["\u0275\u0275element"](25,"i",7),i["\u0275\u0275text"](26),i["\u0275\u0275pipe"](27,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](28,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](29,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](30,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n")),2&e&&(i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](8,5,"submission.import-external.title"+(t.label?"."+t.label:""))),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("initExternalSourceData",t.reload$.value),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",t.reload$.value.entity),i["\u0275\u0275advance"](8),i["\u0275\u0275property"]("routerLink",i["\u0275\u0275pureFunction0"](9,Q)),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](27,7,"submission.import-external.back-to-my-dspace"),"\n      "))},directives:[k.a,F.p,D.k,B.a,M.a,L.a,T.a],pipes:[R.d,F.b],styles:[""],data:{animation:[y.a]}}),e}()},SCNa:function(e,t,n){"use strict";n.r(t),n.d(t,"SubmissionEditComponent",(function(){return S}));var i=n("fXoL"),o=n("2Vo4"),r=n("eIep"),s=n("pLZG"),c=n("Kj3r"),u=n("J3qs"),d=n("1QIV"),p=n("fBXw"),m=n("lI3o"),f=n("tyNb"),b=n("iqTE"),v=n("J/vq"),h=n("sYmb"),g=n("QjZv"),y=n("m4Gq"),S=function(){var e=function(){function e(t,n,i,r,s,c,l,u){a(this,e),this.changeDetectorRef=t,this.notificationsService=n,this.route=i,this.router=r,this.itemDataService=s,this.submissionService=c,this.translate=l,this.submissionJsonPatchOperationsService=u,this.subs=[],this.itemLink$=new o.a(void 0)}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.subs.push(this.route.paramMap.pipe(Object(r.a)((function(t){return e.submissionService.retrieveSubmission(t.get("id"))})),Object(s.a)((function(e){return Object(u.g)(e)}))).subscribe((function(t){if(t.hasSucceeded)if(Object(u.d)(t.payload))e.notificationsService.info(null,e.translate.get("submission.general.cannot_submit")),e.router.navigate(["/mydspace"]);else{var n=t.payload.errors;e.submissionErrors=Object(p.a)(n),e.submissionId=t.payload.id.toString(),e.collectionId=t.payload.collection.id,e.selfUrl=t.payload._links.self.href,e.sections=t.payload.sections,e.itemLink$.next(t.payload._links.item.href),e.item=t.payload.item,e.submissionDefinition=t.payload.submissionDefinition}else 404===t.statusCode&&e.router.navigate(["/404"],{skipLocationChange:!0})})),this.itemLink$.pipe(Object(u.f)(),Object(r.a)((function(t){return e.itemDataService.findByHref(t)})),Object(d.c)(),Object(c.a)(300)).subscribe((function(t){e.item=t.payload,e.changeDetectorRef.detectChanges()})))}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(u.b)(e)})).forEach((function(e){return e.unsubscribe()})),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](m.a),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](f.h),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](h.e),i["\u0275\u0275directiveInject"](g.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-edit"]],decls:5,vars:7,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","submissionId"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275element"](2,"ds-submission-form",1),i["\u0275\u0275text"](3,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("collectionId",t.collectionId)("sections",t.sections)("selfUrl",t.selfUrl)("submissionDefinition",t.submissionDefinition)("submissionErrors",t.submissionErrors)("item",t.item)("submissionId",t.submissionId))},directives:[y.a],styles:[""]}),e}()},"T/iP":function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var i=n("fXoL"),o=n("LRne"),r=n("SxV6"),s=n("IzEk"),c=n("J3qs"),u=n("oOMw"),d=n("fBXw"),p=n("4GeW"),m=n("lI3o"),f=n("QjZv"),b=n("YJD6"),v=n("J/vq"),h=n("sYmb"),g=n("ofXK"),y=n("4zj/");function S(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-uploader",1),i["\u0275\u0275listener"]("onCompleteItem",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().onCompleteItem(e)}))("onUploadError",(function(){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().onUploadError()})),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("dropMsg",o.dropMsg)("dropOverDocumentMsg",o.dropOverDocumentMsg)("enableDragOverDocument",o.enableDragOverDocument)("onBeforeUpload",o.onBeforeUpload)("uploadFilesOptions",o.uploadFilesOptions)}}var x=function(){var e=function(){function e(t,n,i,r,s){var c=this;a(this,e),this.notificationsService=t,this.operationsService=n,this.sectionService=i,this.submissionService=r,this.translate=s,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=Object(o.a)(!1),this.onBeforeUpload=function(){var e=c.operationsService.jsonPatchByResourceType(c.submissionService.getSubmissionObjectLinkName(),c.submissionId,"sections").subscribe();return c.subs.push(e),e}}return l(e,[{key:"ngOnChanges",value:function(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,p.a.Upload)}},{key:"onCompleteItem",value:function(e){var t=this;this.subs.push(this.uploadEnabled.pipe(Object(r.a)()).subscribe((function(n){if(n){var i=e.sections,o=e.errors,r=Object(d.a)(o);i&&Object(c.e)(i)&&Object.keys(i).forEach((function(e){var n=Object(u.b)(i[e]),o=r[e];t.sectionService.isSectionType(t.submissionId,e,p.a.Upload).pipe(Object(s.a)(1)).subscribe((function(e){e&&(Object(c.d)(o)?t.notificationsService.success(null,t.translate.get("submission.sections.upload.upload-successful")):t.notificationsService.error(null,t.translate.get("submission.sections.upload.upload-failed")))})),t.sectionService.updateSectionData(t.submissionId,e,n,o,o)}))}})))}},{key:"onUploadError",value:function(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(c.b)(e)})).forEach((function(e){return e.unsubscribe()}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](m.a),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](h.e))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:2,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,S,1,5,"ds-uploader",0),i["\u0275\u0275text"](1,"\n")),2&e&&i["\u0275\u0275property"]("ngIf",t.uploadFilesOptions.url)},directives:[g.p,y.a],encapsulation:2}),e}()},THnG:function(e,t,n){"use strict";n.r(t),n.d(t,"SubmissionSubmitComponent",(function(){return v}));var i=n("fXoL"),o=n("2Vo4"),r=n("eIep"),s=n("Kj3r"),c=n("J3qs"),u=n("1QIV"),d=n("lI3o"),p=n("tyNb"),m=n("iqTE"),f=n("J/vq"),b=n("sYmb"),v=function(){var e=function(){function e(t,n,i,r,s,c,l,u){var d=this;a(this,e),this.changeDetectorRef=t,this.notificationsService=n,this.router=i,this.itemDataService=r,this.submissionService=s,this.translate=c,this.viewContainerRef=l,this.route=u,this.itemLink$=new o.a(void 0),this.subs=[],this.route.queryParams.subscribe((function(e){d.collectionParam=e.collection}))}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.subs.push(this.submissionService.createSubmission(this.collectionParam).subscribe((function(t){Object(c.g)(t)&&(Object(c.d)(t)?(e.notificationsService.info(null,e.translate.get("submission.general.cannot_submit")),e.router.navigate(["/mydspace"])):e.router.navigate(["/workspaceitems",t.id,"edit"],{replaceUrl:!0}))})),this.itemLink$.pipe(Object(c.f)(),Object(r.a)((function(t){return e.itemDataService.findByHref(t)})),Object(u.c)(),Object(s.a)(300)).subscribe((function(t){e.item=t.payload,e.changeDetectorRef.detectChanges()})))}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(c.b)(e)})).forEach((function(e){return e.unsubscribe()})),this.viewContainerRef.clear(),this.changeDetectorRef.markForCheck()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](d.a),i["\u0275\u0275directiveInject"](p.h),i["\u0275\u0275directiveInject"](m.a),i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](b.e),i["\u0275\u0275directiveInject"](i.ViewContainerRef),i["\u0275\u0275directiveInject"](p.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-submit"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),e}()},TTdl:function(e,t,n){"use strict";var i=n("J3qs"),o=/([^\/]+)/g,r=/\/sections\/(.*)/;t.a=function(e){return("string"==typeof e?[e]:e).map((function(e){return e.match(o)&&e.match(o).length>2?{sectionId:e.match(o)[1],fieldId:e.match(o)[2],fieldIndex:Object(i.b)(e.match(o)[3])?+e.match(o)[3]:0,originalPath:e}:{sectionId:e.match(r)[1],originalPath:e}}))}},TkMu:function(e,t,n){var i={"./custom/app/submission/submit/submission-submit.component":["cSSl",80]};function o(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(i)},o.id="TkMu",e.exports=o},"Uql/":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i=new Map;function o(e){return function(t){t&&i.set(e,t)}}function r(e){return i.get(e)}},YJD6:function(e,t,n){"use strict";n.d(t,"a",(function(){return B}));var r=n("fXoL"),s=n("itXk"),c=n("lJxs"),u=n("/uUt"),d=n("5+tZ"),p=n("pLZG"),m=n("IzEk"),f=n("LvDl"),b=n("J3qs"),v=n("4jMI"),h=n("LP5c"),g=n("drGc"),y=n("TTdl"),S=n("xvwT"),x=n("4GeW"),I=n("oOMw"),O=n("e+Av"),j=n("0VLH"),C=n("NFsL"),E=n("lI3o"),D=n("KZTq"),w=n("J/vq"),k=n("l7P3"),F=n("sYmb"),B=function(){var e=function(){function e(t,n,i,o,r,s){a(this,e),this.formService=t,this.notificationsService=n,this.scrollToService=i,this.submissionService=o,this.store=r,this.translate=s}return l(e,[{key:"checkSectionErrors",value:function(e,t,n,i){var o=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(Object(b.d)(i))this.store.dispatch(new v.r(e,t)),this.store.dispatch(new S.e(n));else if(!Object(f.isEqual)(i,r)){var s=[];i.forEach((function(e){Object(y.a)(e.path).forEach((function(t){t.fieldId&&(o.formService.addError(n,t.fieldId,t.fieldIndex,e.message),s.push(t.fieldId))}))})),r.forEach((function(e){Object(y.a)(e.path).forEach((function(e){e.fieldId&&(s.includes(e.fieldId)||o.formService.removeError(n,e.fieldId,e.fieldIndex))}))}))}}},{key:"dispatchRemoveSectionErrors",value:function(e,t){this.store.dispatch(new v.r(e,t))}},{key:"dispatchSetSectionFormId",value:function(e,t,n){this.store.dispatch(new v.E(e,t,n))}},{key:"getSectionData",value:function(e,t,n){return this.store.select(Object(h.d)(e,t)).pipe(Object(c.a)((function(e){return n===x.a.SubmissionForm?Object(I.b)(e):e})),Object(u.a)())}},{key:"getShownSectionErrors",value:function(e,t,n){var o=this;return n!==x.a.SubmissionForm?this.getSectionErrors(e,t):this.getSectionState(e,t,n).pipe(Object(d.a)((function(e){return o.formService.getFormErrors(e.formId).pipe(Object(c.a)((function(n){var o=new j.a("sections",t),r=n.map((function(e){return{path:o.getPath(e.fieldId.replace(/\_/g,".")).path,message:e.message}})).filter((function(t){return-1===Object(f.findIndex)(e.errorsToShow,{path:t.path})}));return[].concat(i(e.errorsToShow),i(r))})))})))}},{key:"getSectionErrors",value:function(e,t){return this.store.select(Object(h.e)(e,t)).pipe(Object(u.a)())}},{key:"getSectionServerErrors",value:function(e,t){return this.store.select(Object(h.g)(e,t)).pipe(Object(u.a)())}},{key:"getSectionState",value:function(e,t,n){return this.store.select(Object(h.f)(e,t)).pipe(Object(p.a)((function(e){return Object(b.b)(e)})),Object(c.a)((function(e){return e})),Object(c.a)((function(e){return Object(b.b)(e.data)&&n===x.a.SubmissionForm?Object.assign({},e,{data:Object(I.b)(e.data)}):e})),Object(u.a)())}},{key:"isSectionValid",value:function(e,t){return this.store.select(Object(h.f)(e,t)).pipe(Object(p.a)((function(e){return Object(b.b)(e)})),Object(c.a)((function(e){return e.isValid})),Object(u.a)())}},{key:"isSectionActive",value:function(e,t){return this.submissionService.getActiveSectionId(e).pipe(Object(c.a)((function(e){return t===e})),Object(u.a)())}},{key:"isSectionEnabled",value:function(e,t){return this.store.select(Object(h.f)(e,t)).pipe(Object(p.a)((function(e){return Object(b.b)(e)})),Object(c.a)((function(e){return e.enabled})),Object(u.a)())}},{key:"isSectionReadOnly",value:function(e,t,n){return this.store.select(Object(h.f)(e,t)).pipe(Object(p.a)((function(e){return Object(b.b)(e)})),Object(c.a)((function(e){return Object(b.e)(e.visibility)&&"READONLY"===e.visibility.other&&n!==g.a.WorkspaceItem})),Object(u.a)())}},{key:"isSectionAvailable",value:function(e,t){return this.store.select(Object(h.c)(e)).pipe(Object(p.a)((function(e){return Object(b.h)(e)})),Object(c.a)((function(e){return Object(b.h)(e.sections)&&Object(b.h)(e.sections[t])})),Object(u.a)())}},{key:"isSectionTypeAvailable",value:function(e,t){return this.store.select(Object(h.c)(e)).pipe(Object(p.a)((function(e){return Object(b.h)(e)})),Object(c.a)((function(e){return Object(b.h)(e.sections)&&Object(b.h)(Object(f.findKey)(e.sections,{sectionType:t}))})),Object(u.a)())}},{key:"isSectionType",value:function(e,t,n){return this.store.select(Object(h.c)(e)).pipe(Object(p.a)((function(e){return Object(b.h)(e)})),Object(c.a)((function(e){return Object(b.h)(e.sections)&&Object(b.h)(e.sections[t])&&e.sections[t].sectionType===n})),Object(u.a)())}},{key:"addSection",value:function(e,t){this.store.dispatch(new v.m(e,t)),this.scrollToService.scrollTo({target:t,offset:-70})}},{key:"removeSection",value:function(e,t){this.store.dispatch(new v.h(e,t))}},{key:"updateSectionData",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5?arguments[5]:void 0;if(Object(b.e)(n)){var l=this.isSectionAvailable(e,t),u=this.isSectionEnabled(e,t);Object(s.a)(l,u).pipe(Object(m.a)(1),Object(p.a)((function(e){var t=o(e,2),n=t[0];t[1];return n}))).subscribe((function(s){var l=o(s,2);l[0],l[1];i.store.dispatch(new v.G(e,t,n,r,a,c))}))}}},{key:"setSectionError",value:function(e,t,n){this.store.dispatch(new v.n(e,t,n))}},{key:"setSectionStatus",value:function(e,t,n){this.store.dispatch(new v.C(e,t,n))}},{key:"computeSectionConfiguredMetadata",value:function(e){var t=[],n="string"==typeof e?JSON.parse(e,O.T):e;return n.rows&&!Object(b.d)(n.rows)&&n.rows.forEach((function(e){e.fields&&!Object(b.d)(e.fields)&&e.fields.forEach((function(e){e.selectableMetadata&&!Object(b.d)(e.selectableMetadata)&&e.selectableMetadata.forEach((function(e){t.includes(e.metadata)||t.push(e.metadata)}))}))})),t}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275inject"](C.a),r["\u0275\u0275inject"](E.a),r["\u0275\u0275inject"](D.b),r["\u0275\u0275inject"](w.a),r["\u0275\u0275inject"](k.i),r["\u0275\u0275inject"](F.e))},e.\u0275prov=r["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e}()},Yfyx:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n("fXoL"),o=n("Uql/"),r=n("ac5F"),s=n("b8BE"),c=n("ofXK"),u=n("1kSV"),d=n("VYMa"),p=n("sYmb"),m=["sectionRef"];function f(e,t){1&e&&(i["\u0275\u0275element"](0,"i",17),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275pipe"](2,"translate")),2&e&&(i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.sections.status.warnings.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](2,4,"submission.sections.status.warnings.aria")))}function b(e,t){1&e&&(i["\u0275\u0275element"](0,"i",18),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275pipe"](2,"translate")),2&e&&(i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.sections.status.errors.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](2,4,"submission.sections.status.errors.aria")))}function v(e,t){1&e&&(i["\u0275\u0275element"](0,"i",19),i["\u0275\u0275pipe"](1,"translate"),i["\u0275\u0275pipe"](2,"translate")),2&e&&(i["\u0275\u0275propertyInterpolate"]("title",i["\u0275\u0275pipeBind1"](1,2,"submission.sections.status.valid.title")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind1"](2,4,"submission.sections.status.valid.aria")))}function h(e,t){1&e&&i["\u0275\u0275element"](0,"span",20)}function g(e,t){1&e&&i["\u0275\u0275element"](0,"span",21)}function y(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"a",22),i["\u0275\u0275listener"]("click",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"](3).removeSection(e)})),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"i",23),i["\u0275\u0275text"](3,"\n          "),i["\u0275\u0275elementEnd"]()}}var S=function(e){return{sectionHeader:e}};function x(e,t){if(1&e&&(i["\u0275\u0275text"](0,"\n        "),i["\u0275\u0275elementStart"](1,"span",8),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](4,"\n        "),i["\u0275\u0275elementStart"](5,"div",9),i["\u0275\u0275text"](6,"\n          "),i["\u0275\u0275template"](7,f,3,6,"i",10),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n          "),i["\u0275\u0275template"](10,b,3,6,"i",11),i["\u0275\u0275text"](11,"\n          "),i["\u0275\u0275template"](12,v,3,6,"i",12),i["\u0275\u0275pipe"](13,"async"),i["\u0275\u0275text"](14,"\n          "),i["\u0275\u0275elementStart"](15,"a",13),i["\u0275\u0275pipe"](16,"translate"),i["\u0275\u0275pipe"](17,"translate"),i["\u0275\u0275pipe"](18,"translate"),i["\u0275\u0275text"](19,"\n            "),i["\u0275\u0275template"](20,h,1,0,"span",14),i["\u0275\u0275text"](21,"\n            "),i["\u0275\u0275template"](22,g,1,0,"span",15),i["\u0275\u0275text"](23,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n          "),i["\u0275\u0275template"](25,y,4,0,"a",16),i["\u0275\u0275text"](26,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](27,"\n      ")),2&e){var n=i["\u0275\u0275nextContext"](2),o=i["\u0275\u0275reference"](1);i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](3,9,"submission.sections."+n.sectionData.header)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](8,11,o.isValid())&&!o.hasErrors()),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",o.hasErrors()),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](13,13,o.isValid())&&!o.hasErrors()),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("title",i["\u0275\u0275pipeBind1"](18,20,o.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),i["\u0275\u0275attribute"]("aria-label",i["\u0275\u0275pipeBind2"](16,15,o.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",i["\u0275\u0275pureFunction1"](22,S,i["\u0275\u0275pipeBind1"](17,18,"submission.sections."+n.sectionData.header)))),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",o.isOpen()),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!o.isOpen()),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!o.isMandatory())}}function I(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-alert",28),i["\u0275\u0275listener"]("close",(function(){i["\u0275\u0275restoreView"](n);var e=t.index;return i["\u0275\u0275nextContext"](4),i["\u0275\u0275reference"](1).removeError(e)})),i["\u0275\u0275elementEnd"]()}if(2&e){var o=t.$implicit,r=i["\u0275\u0275nextContext"](4);i["\u0275\u0275property"]("content",o)("dismissible",!0)("type",r.AlertTypeEnum.Error)}}function O(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",5),i["\u0275\u0275text"](1,"\n          "),i["\u0275\u0275template"](2,I,1,3,"ds-alert",27),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"](3),o=i["\u0275\u0275reference"](1);i["\u0275\u0275propertyInterpolate1"]("id","sectionGenericError_",n.sectionData.id,""),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngForOf",o.getErrors())}}function j(e,t){1&e&&i["\u0275\u0275elementContainer"](0)}function C(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275text"](0,"\n        "),i["\u0275\u0275template"](1,O,4,2,"div",24),i["\u0275\u0275text"](2,"\n        "),i["\u0275\u0275elementStart"](3,"div",25),i["\u0275\u0275listener"]("click",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"](2),i["\u0275\u0275reference"](1).setFocus(e)})),i["\u0275\u0275text"](4,"\n          "),i["\u0275\u0275template"](5,j,1,0,"ng-container",26),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n      ")}if(2&e){var o=i["\u0275\u0275nextContext"](2),r=i["\u0275\u0275reference"](1);i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",r.hasGenericErrors()),i["\u0275\u0275advance"](2),i["\u0275\u0275propertyInterpolate1"]("id","sectionContent_",o.sectionData.id,""),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngComponentOutlet",o.getSectionContent())("ngComponentOutletInjector",o.objectInjector)}}function E(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ngb-accordion",3,4),i["\u0275\u0275listener"]("panelChange",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"](),i["\u0275\u0275reference"](1).sectionChange(e)})),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"ngb-panel",5),i["\u0275\u0275text"](4,"\n      "),i["\u0275\u0275template"](5,x,28,24,"ng-template",6),i["\u0275\u0275text"](6,"\n      "),i["\u0275\u0275template"](7,C,8,4,"ng-template",7),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n  "),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275propertyInterpolate"]("activeIds",o.sectionData.id),i["\u0275\u0275property"]("destroyOnHide",!1),i["\u0275\u0275advance"](3),i["\u0275\u0275propertyInterpolate"]("id",o.sectionData.id)}}var D=function(e){return{"section-focus":e}},w=function(){var e=function(){function e(t){a(this,e),this.injector=t,this.AlertTypeEnum=r.a}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.objectInjector=i.Injector.create({providers:[{provide:"collectionIdProvider",useFactory:function(){return e.collectionId},deps:[]},{provide:"sectionDataProvider",useFactory:function(){return e.sectionData},deps:[]},{provide:"submissionIdProvider",useFactory:function(){return e.submissionId},deps:[]}],parent:this.injector})}},{key:"removeSection",value:function(e){e.preventDefault(),e.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}},{key:"getSectionContent",value:function(){return Object(o.b)(this.sectionData.sectionType)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.Injector))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-section-container"]],viewQuery:function(e,t){var n;(1&e&&i["\u0275\u0275viewQuery"](m,1),2&e)&&(i["\u0275\u0275queryRefresh"](n=i["\u0275\u0275loadQuery"]())&&(t.sectionRef=n.first))},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},decls:7,vars:11,consts:[["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],["sectionRef","sectionRef"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"activeIds","destroyOnHide","panelChange"],["acc","ngbAccordion"],[3,"id"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],[1,"fas","fa-chevron-up","fa-fw"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"id","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"content","dismissible","type","close"]],template:function(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",0,1),i["\u0275\u0275text"](2,"\n  "),i["\u0275\u0275template"](3,E,10,3,"ngb-accordion",2),i["\u0275\u0275pipe"](4,"async"),i["\u0275\u0275text"](5,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n")),2&e){var n=i["\u0275\u0275reference"](1);i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](9,D,n.isSectionActive()))("mandatory",t.sectionData.mandatory)("submissionId",t.submissionId)("sectionType",t.sectionData.sectionType)("sectionId",t.sectionData.id),i["\u0275\u0275attribute"]("id","section_"+t.sectionData.id),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](4,7,n.isEnabled()))}},directives:[s.a,c.m,c.p,u.a,u.D,u.F,u.E,c.n,c.o,d.a],pipes:[c.b,p.d],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);-webkit-box-shadow:var(--bs-btn-focus-box-shadow);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{-webkit-box-shadow:none!important;box-shadow:none!important;width:100%}"]}),e}()},YoQ9:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("fXoL"),o=n("JTKQ");function r(e,t){}var s=function(){var e=function(e){u(i,e);var t=p(i);function i(){return a(this,i),t.apply(this,arguments)}return l(i,[{key:"getComponentName",value:function(){return"SubmissionEditComponent"}},{key:"importThemedComponent",value:function(e){return n("3aq+")("./".concat(e,"/app/submission/edit/submission-edit.component"))}},{key:"importUnthemedComponent",value:function(){return Promise.resolve().then(n.bind(null,"SCNa"))}}]),i}(o.a);return e.\u0275fac=function(t){return c(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-themed-submission-edit"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:0,consts:[["vcr",""]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,r,0,0,"ng-template",null,0,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](2,"\n"))},encapsulation:2}),e}(),c=i["\u0275\u0275getInheritedFactory"](s)},b8BE:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n("fXoL"),o=n("lJxs"),r=n("LvDl"),s=n("J3qs"),c=n("TTdl"),u=n("J/vq"),d=n("YJD6"),p=function(){var e=function(){function e(t,n,i){a(this,e),this.changeDetectorRef=t,this.submissionService=n,this.sectionService=i,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe(Object(o.a)((function(t){return t&&e.resetErrors(),t}))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe((function(t){Object(s.e)(t)?t.forEach((function(t){Object(c.a)(t.path).forEach((function(n){n.fieldId?e.allSectionErrors.push(t.message):e.genericSectionErrors=Object(r.uniq)(e.genericSectionErrors.concat(t.message))}))})):e.resetErrors()})),this.submissionService.getActiveSectionId(this.submissionId).subscribe((function(t){var n=e.active;e.active=t===e.sectionId,n!==e.active&&(e.changeDetectorRef.detectChanges(),!e.active&&Object(s.g)(t)&&e.submissionService.dispatchSave(e.submissionId))}))),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(s.b)(e)})).forEach((function(e){return e.unsubscribe()}))}},{key:"sectionChange",value:function(e){this.sectionState=e.nextState}},{key:"isOpen",value:function(){return this.sectionState}},{key:"isMandatory",value:function(){return this.mandatory}},{key:"isSectionActive",value:function(){return this.active}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isValid",value:function(){return this.valid}},{key:"removeSection",value:function(e,t){this.sectionService.removeSection(e,t)}},{key:"hasGenericErrors",value:function(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}},{key:"hasErrors",value:function(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}},{key:"getErrors",value:function(){return this.genericSectionErrors}},{key:"setFocus",value:function(e){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}},{key:"removeError",value:function(e){this.genericSectionErrors.splice(e)}},{key:"resetErrors",value:function(){Object(s.e)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](u.a),i["\u0275\u0275directiveInject"](d.a))},e.\u0275dir=i["\u0275\u0275defineDirective"]({type:e,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"]}),e}()},c3nT:function(t,i,r){"use strict";r.d(i,"a",(function(){return Xn}));var s,c=r("fXoL"),d=r("pKmL"),m=r("PCNd"),b=r("mrSG"),v=r("itXk"),h=r("lJxs"),g=r("vkgz"),y=r("5+tZ"),S=r("IzEk"),x=r("cBqT"),I=r("/uUt"),O=r("pLZG"),j=r("LvDl"),C=r("Q5/L"),E=r("NFsL"),D=r("JX91"),w=r("J3qs"),k=((s=function(){function e(t,n,i){a(this,e),this.injectedCollectionId=t,this.injectedSectionData=n,this.injectedSubmissionId=i,this.collectionId=t,this.sectionData=n,this.submissionId=i}return l(e,[{key:"ngOnInit",value:function(){this.onSectionInit(),this.updateSectionStatus()}},{key:"updateSectionStatus",value:function(){var e=this;this.sectionStatusSub=this.getSectionStatus().pipe(Object(O.a)((function(e){return Object(w.h)(e)})),Object(D.a)(!0)).subscribe((function(t){e.sectionService.setSectionStatus(e.submissionId,e.sectionData.id,t)}))}},{key:"ngOnDestroy",value:function(){Object(w.b)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}}]),e}()).\u0275fac=function(e){return new(e||s)(c["\u0275\u0275directiveInject"]("collectionIdProvider"),c["\u0275\u0275directiveInject"]("sectionDataProvider"),c["\u0275\u0275directiveInject"]("submissionIdProvider"))},s.\u0275cmp=c["\u0275\u0275defineComponent"]({type:s,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),s),F=r("+ZI/"),B=r("0VLH"),M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a(this,e),this._path=t,this._value=n}return l(e,[{key:"path",get:function(){return this._path},set:function(e){this._path=e}},{key:"value",get:function(){return this._value},set:function(e){this._value=e}},{key:"delete",value:function(){this._value=null,this._path=null}},{key:"isPathEqual",value:function(e){return this._path&&Object(j.isEqual)(this._path,e)}}]),e}(),L=r("Uql/"),T=r("4GeW"),R=r("J/vq"),V=r("ITak"),P=r("lI3o"),$=r("YJD6"),A=r("Gx58"),_=r("1QIV"),q=r("fHtB"),U=r("mycY"),N=r("X/78"),G=r("84Zn"),Q=r("AytR"),J=r("sYmb"),X=r("ofXK"),H=r("Frqi"),Y=r("hqmO"),K=["formRef"];function z(e,t){1&e&&c["\u0275\u0275element"](0,"ds-loading",2)}function Z(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ds-form",3,4),c["\u0275\u0275listener"]("dfChange",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onChange(e)}))("dfFocus",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onFocus(e)}))("remove",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onRemove(e)}))("ngbEvent",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onCustomEvent(e)}))("removeArrayItem",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onRemove(e)})),c["\u0275\u0275elementEnd"]()}if(2&e){var i=c["\u0275\u0275nextContext"]();c["\u0275\u0275property"]("formId",i.formId)("formModel",i.formModel)("displaySubmit",!1)("displayCancel",!1)}}var W,ee=((W=function(e){u(n,e);var t=p(n);function n(e,i,o,r,s,c,l,u,d,p,m,f,b,v,h){var g;return a(this,n),(g=t.call(this,b,v,h)).cdr=e,g.formBuilderService=i,g.formOperationsService=o,g.formService=r,g.formConfigService=s,g.notificationsService=c,g.sectionService=l,g.submissionService=u,g.translate=d,g.submissionObjectService=p,g.objectCache=m,g.requestService=f,g.injectedCollectionId=b,g.injectedSectionData=v,g.injectedSubmissionId=h,g.isUpdating=!1,g.isLoading=!0,g.fieldsOnTheirWayToBeRemoved=new Map,g.formData=Object.create({}),g.previousValue=new M,g.subs=[],g}return l(n,[{key:"onSectionInit",value:function(){var e=this;this.pathCombiner=new B.a("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe(Object(h.a)((function(e){return e.payload})),Object(g.a)((function(t){return e.formConfig=t})),Object(y.a)((function(){return Object(v.a)([e.sectionService.getSectionData(e.submissionId,e.sectionData.id,e.sectionData.sectionType),e.submissionObjectService.findById(e.submissionId,!0,!1,Object(G.a)("item")).pipe(Object(_.i)(),Object(_.o)())])})),Object(S.a)(1)).subscribe((function(t){var n=o(t,2),i=n[0],r=n[1];Object(w.j)(e.formModel)&&(e.workspaceItem=r,e.initForm(i),e.sectionData.data=i,e.subscriptions(),e.isLoading=!1,e.cdr.detectChanges())}))}},{key:"onSectionDestroy",value:function(){this.subs.filter((function(e){return Object(w.b)(e)})).forEach((function(e){return e.unsubscribe()}))}},{key:"getSectionStatus",value:function(){var e=this.formService.isValid(this.formId),t=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe(Object(h.a)((function(e){return Object(w.d)(e)})));return Object(v.a)([e,t]).pipe(Object(h.a)((function(e){var t=o(e,2),n=t[0],i=t[1];return n&&i})))}},{key:"hasMetadataEnrichment",value:function(e){var t=this,n={};Object.keys(e).forEach((function(i){t.sectionMetadata&&t.sectionMetadata.includes(i)&&(n[i]=e[i])}));var i=[],o=Object(A.a)(n,this.formData);return Object.keys(o).forEach((function(e){o[e].forEach((function(n){n.hasOwnProperty("value")&&Object(j.findIndex)(t.formData[e],{value:n.value})<0&&i.push(n)}))})),Object(w.e)(i)}},{key:"initForm",value:function(e){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,e,this.submissionService.getSubmissionScope());var t=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,e,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors,t)}catch(i){var n={message:this.translate.instant("error.submission.sections.init-form-error")+i.toString(),path:"/sections/"+this.sectionData.id};console.error(i.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,n)}}},{key:"updateForm",value:function(e,t){Object(w.e)(e)&&!Object(j.isEqual)(e,this.sectionData.data)?(this.sectionData.data=e,this.hasMetadataEnrichment(e)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(e),this.checksForErrors(t),this.isUpdating=!1,this.cdr.detectChanges()):(Object(w.e)(t)||Object(w.e)(this.sectionData.errorsToShow))&&this.checksForErrors(t)):(Object(w.e)(t)||Object(w.e)(this.sectionData.errorsToShow))&&this.checksForErrors(t)}},{key:"checksForErrors",value:function(e){var t=this;this.formService.isFormInitialized(this.formId).pipe(Object(x.a)((function(e){return!0===e&&!t.isUpdating}))).subscribe((function(){t.sectionService.checkSectionErrors(t.submissionId,t.sectionData.id,t.formId,e,t.sectionData.errorsToShow),t.sectionData.errorsToShow=e,t.cdr.detectChanges()}))}},{key:"subscriptions",value:function(){var e=this;this.subs.push(this.formService.getFormData(this.formId).pipe(Object(I.a)()).subscribe((function(t){e.formData=t})),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe(Object(O.a)((function(e){return Object(w.e)(e)&&(Object(w.e)(e.data)||Object(w.e)(e.errorsToShow))})),Object(I.a)()).subscribe((function(t){e.fieldsOnTheirWayToBeRemoved=new Map,e.sectionMetadata=t.metadata,e.updateForm(t.data,t.errorsToShow)})))}},{key:"onChange",value:function(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(e.model),this.formOperationsService.getArrayIndexFromEvent(e)));var t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),n=this.formOperationsService.getFieldValueFromChangeEvent(e);(-1!==Q.a.submission.autosave.metadata.indexOf(t)&&Object(w.e)(n)||this.hasRelatedCustomError(t))&&this.submissionService.dispatchSave(this.submissionId)}},{key:"hasRelatedCustomError",value:function(e){var t=Object(j.findIndex)(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(e).path});if(-1!==t){var n=this.sectionData.errorsToShow[t].message.replace("error.validation.","");return!Q.a.form.validatorMap.hasOwnProperty(n)}return!1}},{key:"onFocus",value:function(e){var t=this.formOperationsService.getFieldValueFromChangeEvent(e),n=this.formBuilderService.getPath(e.model);this.formBuilderService.hasMappedGroupValue(e.model)?(this.previousValue.path=n,this.previousValue.value=this.formOperationsService.getQualdropValueMap(e)):Object(w.e)(t)&&("object"==typeof t&&Object(w.e)(t.value)||"string"==typeof t)&&(this.previousValue.path=n,this.previousValue.value=t)}},{key:"onRemove",value:function(e){var t=this.formBuilderService.getId(e.model),n=this.formOperationsService.getArrayIndexFromEvent(e);if(this.fieldsOnTheirWayToBeRemoved.has(t)){var i=this.fieldsOnTheirWayToBeRemoved.get(t);i.push(n),this.fieldsOnTheirWayToBeRemoved.set(t,i)}else this.fieldsOnTheirWayToBeRemoved.set(t,[n]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(t,n))}},{key:"hasStoredValue",value:function(e,t){return!!Object(w.e)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(e)&&Object(w.e)(this.sectionData.data[e][t])&&!this.isFieldToRemove(e,t)}},{key:"isFieldToRemove",value:function(e,t){return this.fieldsOnTheirWayToBeRemoved.has(e)&&this.fieldsOnTheirWayToBeRemoved.get(e).includes(t)}},{key:"onCustomEvent",value:function(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,null)}}]),n}(k)).\u0275fac=function(e){return new(e||W)(c["\u0275\u0275directiveInject"](c.ChangeDetectorRef),c["\u0275\u0275directiveInject"](C.a),c["\u0275\u0275directiveInject"](V.a),c["\u0275\u0275directiveInject"](E.a),c["\u0275\u0275directiveInject"](F.a),c["\u0275\u0275directiveInject"](P.a),c["\u0275\u0275directiveInject"]($.a),c["\u0275\u0275directiveInject"](R.a),c["\u0275\u0275directiveInject"](J.e),c["\u0275\u0275directiveInject"](q.a),c["\u0275\u0275directiveInject"](U.a),c["\u0275\u0275directiveInject"](N.a),c["\u0275\u0275directiveInject"]("collectionIdProvider"),c["\u0275\u0275directiveInject"]("sectionDataProvider"),c["\u0275\u0275directiveInject"]("submissionIdProvider"))},W.\u0275cmp=c["\u0275\u0275defineComponent"]({type:W,selectors:[["ds-submission-section-form"]],viewQuery:function(e,t){var n;1&e&&c["\u0275\u0275viewQuery"](K,1),2&e&&c["\u0275\u0275queryRefresh"](n=c["\u0275\u0275loadQuery"]())&&(t.formRef=n.first)},features:[c["\u0275\u0275InheritDefinitionFeature"]],decls:4,vars:2,consts:[["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem"],["formRef","formComponent"]],template:function(e,t){1&e&&(c["\u0275\u0275template"](0,z,1,0,"ds-loading",0),c["\u0275\u0275text"](1,"\n"),c["\u0275\u0275template"](2,Z,2,4,"ds-form",1),c["\u0275\u0275text"](3,"\n")),2&e&&(c["\u0275\u0275property"]("ngIf",t.isLoading),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",!t.isLoading&&t.formModel))},directives:[X.p,H.a,Y.a],styles:[""]}),W=Object(b.b)([Object(L.a)(T.a.SubmissionForm)],W));r("b8BE"),r("wQzj"),r("yAsG"),r("m4Gq"),r("ph1m"),r("Yfyx");var te=r("l7P3"),ne=r("9jGm"),ie=r("33F9"),oe=r("Cfvw"),re=r("LRne"),se=r("eIep"),ae=r("JIr8"),ce=r("zp1y"),le=r("fBXw"),ue=r("4jMI"),de=r("TTdl"),pe=r("QjZv");function me(e,t,n){return e?e[t.sections[n].formId]:null}function fe(e,t,n,i){if(i||n!==T.a.SubmissionForm)return t;if(!e||!e.touched)return[];var o=[];return t.forEach((function(t){Object(de.a)(t.path).forEach((function(n){n.fieldId&&e.touched[n.fieldId]&&o.push(t)}))})),o}var be,ve,he,ge=[(be=function(){function e(t,n,i,r,s,c,l,u){var d=this;a(this,e),this.actions$=t,this.notificationsService=n,this.operationsService=i,this.sectionService=r,this.store$=s,this.submissionService=c,this.submissionObjectService=l,this.translate=u,this.loadForm$=this.actions$.pipe(Object(ne.f)(ue.F.INIT_SUBMISSION_FORM),Object(h.a)((function(e){var t=e.payload.submissionDefinition,n=[];return t.sections.page.forEach((function(t){var i,o=t._links.self.href||t._links.self,r=o.substr(o.lastIndexOf("/")+1),s=t._links.config?t._links.config.href||t._links.config:"",a=t.mandatory||Object(w.e)(e.payload.sections)&&e.payload.sections.hasOwnProperty(r);i=t.sectionType!==T.a.SubmissionForm?Object(w.h)(e.payload.sections)&&Object(w.h)(e.payload.sections[r])?e.payload.sections[r]:Object.create(null):e.payload.item.metadata;var c=Object(w.e)(e.payload.errors)&&e.payload.errors[r]||null;n.push(new ue.o(e.payload.submissionId,r,t.header,s,t.mandatory,t.sectionType,t.visibility,a,i,c))})),{action:e,definition:t,mappedActions:n}})),Object(y.a)((function(e){return Object(oe.a)(e.mappedActions.concat(new ue.c(e.action.payload.submissionId)))}))),this.resetForm$=this.actions$.pipe(Object(ne.f)(ue.F.RESET_SUBMISSION_FORM),Object(h.a)((function(e){return new ue.p(e.payload.collectionId,e.payload.submissionId,e.payload.selfUrl,e.payload.submissionDefinition,e.payload.sections,e.payload.item,null)}))),this.saveSubmission$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_SUBMISSION_FORM),Object(se.a)((function(e){return d.operationsService.jsonPatchByResourceType(d.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections").pipe(Object(h.a)((function(t){return new ue.y(e.payload.submissionId,t,e.payload.isManual)})),Object(ae.a)((function(){return Object(re.a)(new ue.x(e.payload.submissionId))})))}))),this.saveForLaterSubmission$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_FOR_LATER_SUBMISSION_FORM),Object(se.a)((function(e){return d.operationsService.jsonPatchByResourceType(d.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections").pipe(Object(h.a)((function(t){return new ue.v(e.payload.submissionId,t)})),Object(ae.a)((function(){return Object(re.a)(new ue.x(e.payload.submissionId))})))}))),this.saveSubmissionSuccess$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_SUBMISSION_FORM_SUCCESS),Object(ce.a)(this.store$),Object(h.a)((function(e){var t=o(e,2),n=t[0],i=t[1];return d.parseSaveResponse(i.submission.objects[n.payload.submissionId],n.payload.submissionObject,n.payload.submissionId,i.forms,n.payload.notify)})),Object(y.a)((function(e){return Object(oe.a)(e)}))),this.saveSubmissionSectionSuccess$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_SUBMISSION_SECTION_FORM_SUCCESS),Object(ce.a)(this.store$),Object(h.a)((function(e){var t=o(e,2),n=t[0],i=t[1];return d.parseSaveResponse(i.submission.objects[n.payload.submissionId],n.payload.submissionObject,n.payload.submissionId,i.forms,!1)})),Object(y.a)((function(e){return Object(oe.a)(e)}))),this.saveSection$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_SUBMISSION_SECTION_FORM),Object(se.a)((function(e){return d.operationsService.jsonPatchByResourceID(d.submissionService.getSubmissionObjectLinkName(),e.payload.submissionId,"sections",e.payload.sectionId).pipe(Object(h.a)((function(t){return new ue.B(e.payload.submissionId,t)})),Object(ae.a)((function(){return Object(re.a)(new ue.A(e.payload.submissionId))})))}))),this.saveError$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_SUBMISSION_FORM_ERROR,ue.F.SAVE_SUBMISSION_SECTION_FORM_ERROR),Object(ce.a)(this.store$),Object(g.a)((function(){return d.notificationsService.error(null,d.translate.get("submission.sections.general.save_error_notice"))}))),this.saveAndDeposit$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_AND_DEPOSIT_SUBMISSION),Object(ce.a)(this.submissionService.hasUnsavedModification()),Object(se.a)((function(e){var t=o(e,2),n=t[0];return(t[1]?d.operationsService.jsonPatchByResourceType(d.submissionService.getSubmissionObjectLinkName(),n.payload.submissionId,"sections"):d.submissionObjectService.findById(n.payload.submissionId,!1,!0).pipe(Object(_.j)(),Object(h.a)((function(e){return[e]})))).pipe(Object(h.a)((function(e){return d.canDeposit(e)?new ue.e(n.payload.submissionId):new ue.y(n.payload.submissionId,e)})),Object(ae.a)((function(){return Object(re.a)(new ue.x(n.payload.submissionId))})))}))),this.depositSubmission$=this.actions$.pipe(Object(ne.f)(ue.F.DEPOSIT_SUBMISSION),Object(ce.a)(this.store$),Object(se.a)((function(e){var t=o(e,2),n=t[0],i=t[1];return d.submissionService.depositSubmission(i.submission.objects[n.payload.submissionId].selfUrl).pipe(Object(h.a)((function(){return new ue.g(n.payload.submissionId)})),Object(ae.a)((function(e){return Object(re.a)(new ue.f(n.payload.submissionId))})))}))),this.saveForLaterSubmissionSuccess$=this.actions$.pipe(Object(ne.f)(ue.F.SAVE_FOR_LATER_SUBMISSION_FORM_SUCCESS),Object(g.a)((function(){return d.notificationsService.success(null,d.translate.get("submission.sections.general.save_success_notice"))})),Object(g.a)((function(){return d.submissionService.redirectToMyDSpace()}))),this.depositSubmissionSuccess$=this.actions$.pipe(Object(ne.f)(ue.F.DEPOSIT_SUBMISSION_SUCCESS),Object(g.a)((function(){return d.notificationsService.success(null,d.translate.get("submission.sections.general.deposit_success_notice"))})),Object(g.a)((function(){return d.submissionService.redirectToMyDSpace()}))),this.depositSubmissionError$=this.actions$.pipe(Object(ne.f)(ue.F.DEPOSIT_SUBMISSION_ERROR),Object(g.a)((function(){return d.notificationsService.error(null,d.translate.get("submission.sections.general.deposit_error_notice"))}))),this.discardSubmission$=this.actions$.pipe(Object(ne.f)(ue.F.DISCARD_SUBMISSION),Object(se.a)((function(e){return d.submissionService.discardSubmission(e.payload.submissionId).pipe(Object(h.a)((function(){return new ue.k(e.payload.submissionId)})),Object(ae.a)((function(){return Object(re.a)(new ue.j(e.payload.submissionId))})))}))),this.addAllMetadataToSectionData=this.actions$.pipe(Object(ne.f)(ue.F.UPDATE_SECTION_DATA),Object(se.a)((function(e){return d.sectionService.getSectionState(e.payload.submissionId,e.payload.sectionId,T.a.Upload).pipe(Object(h.a)((function(t){return[e,t]})),Object(S.a)(1))})),Object(O.a)((function(e){var t=o(e,2);return t[0],t[1].sectionType===T.a.SubmissionForm})),Object(se.a)((function(e){var t=o(e,2),n=t[0];return t[1].sectionType===T.a.SubmissionForm?d.submissionObjectService.findById(n.payload.submissionId,!0,!1,Object(G.a)("item")).pipe(Object(_.j)()).pipe(Object(se.a)((function(e){return e.item.pipe(Object(_.j)())}))).pipe(Object(h.a)((function(e){return e.metadata})),Object(O.a)((function(e){return!Object(j.isEqual)(n.payload.data,e)})),Object(h.a)((function(e){return new ue.G(n.payload.submissionId,n.payload.sectionId,e,n.payload.errorsToShow,n.payload.serverValidationErrors,n.payload.metadata)}))):Object(re.a)(new ue.H)}))),this.discardSubmissionSuccess$=this.actions$.pipe(Object(ne.f)(ue.F.DISCARD_SUBMISSION_SUCCESS),Object(g.a)((function(){return d.notificationsService.success(null,d.translate.get("submission.sections.general.discard_success_notice"))})),Object(g.a)((function(){return d.submissionService.redirectToMyDSpace()}))),this.discardSubmissionError$=this.actions$.pipe(Object(ne.f)(ue.F.DISCARD_SUBMISSION_ERROR),Object(g.a)((function(){return d.notificationsService.error(null,d.translate.get("submission.sections.general.discard_error_notice"))})))}return l(e,[{key:"canDeposit",value:function(e){var t=!0;return Object(w.e)(e)&&e.forEach((function(e){var n=e.errors;n&&!Object(w.d)(n)&&(t=!1)})),t}},{key:"parseSaveResponse",value:function(e,t,i,o){var r=this,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=[];return Object(w.e)(t)&&(s&&this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice")),t.forEach((function(t){var c=Object.create({}),l=t.errors;l&&!Object(w.d)(l)&&(c=Object(le.a)(l),s&&r.notificationsService.warning(null,r.translate.get("submission.sections.general.sections_not_valid")));var u,d=t.sections&&Object(w.e)(t.sections)?t.sections:{},p=n(Object(j.union)(Object.keys(d),Object.keys(c)));try{for(p.s();!(u=p.n()).done;){var m=u.value,f=c[m]||[],b=d[m]||{};if(e.sections[m].sectionType!==T.a.Upload||!Object(w.d)(b.files)||e.sections[m].enabled){s&&!e.sections[m].enabled&&r.submissionService.notifyNewSection(i,m,e.sections[m].sectionType);var v=fe(me(o,e,m),f,e.sections[m].sectionType,s);a.push(new ue.G(i,m,b,v,f))}}}catch(h){p.e(h)}finally{p.f()}}))),a}}]),e}(),be.\u0275fac=function(e){return new(e||be)(c["\u0275\u0275inject"](ne.a),c["\u0275\u0275inject"](P.a),c["\u0275\u0275inject"](pe.a),c["\u0275\u0275inject"]($.a),c["\u0275\u0275inject"](te.i),c["\u0275\u0275inject"](R.a),c["\u0275\u0275inject"](q.a),c["\u0275\u0275inject"](J.e))},be.\u0275prov=c["\u0275\u0275defineInjectable"]({token:be,factory:be.\u0275fac}),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"loadForm$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"resetForm$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"saveSubmission$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"saveForLaterSubmission$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"saveSubmissionSuccess$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"saveSubmissionSectionSuccess$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"saveSection$",void 0),Object(b.b)([Object(ne.b)({dispatch:!1}),Object(b.c)("design:type",Object)],be.prototype,"saveError$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"saveAndDeposit$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"depositSubmission$",void 0),Object(b.b)([Object(ne.b)({dispatch:!1}),Object(b.c)("design:type",Object)],be.prototype,"saveForLaterSubmissionSuccess$",void 0),Object(b.b)([Object(ne.b)({dispatch:!1}),Object(b.c)("design:type",Object)],be.prototype,"depositSubmissionSuccess$",void 0),Object(b.b)([Object(ne.b)({dispatch:!1}),Object(b.c)("design:type",Object)],be.prototype,"depositSubmissionError$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"discardSubmission$",void 0),Object(b.b)([Object(ne.b)(),Object(b.c)("design:type",Object)],be.prototype,"addAllMetadataToSectionData",void 0),Object(b.b)([Object(ne.b)({dispatch:!1}),Object(b.c)("design:type",Object)],be.prototype,"discardSubmissionSuccess$",void 0),Object(b.b)([Object(ne.b)({dispatch:!1}),Object(b.c)("design:type",Object)],be.prototype,"discardSubmissionError$",void 0),be)],ye=r("2Vo4"),Se=r("LP5c"),xe=((ve=function(){function e(t){a(this,e),this.store=t}return l(e,[{key:"getUploadedFileList",value:function(e,t){return this.store.select(Object(Se.i)(e,t)).pipe(Object(h.a)((function(e){return e})),Object(I.a)())}},{key:"getFileData",value:function(e,t,n){return this.store.select(Object(Se.i)(e,t)).pipe(Object(O.a)((function(e){return!Object(w.j)(e)})),Object(h.a)((function(e){var t;return Object.keys(e).filter((function(t){return e[t].uuid===n})).forEach((function(n){return t=e[n]})),t})),Object(I.a)())}},{key:"getDefaultPolicies",value:function(e,t,n){return this.store.select(Object(Se.h)(e,t,n)).pipe(Object(h.a)((function(e){return e})),Object(I.a)())}},{key:"addUploadedFile",value:function(e,t,n,i){this.store.dispatch(new ue.q(e,t,n,i))}},{key:"updateFileData",value:function(e,t,n,i){this.store.dispatch(new ue.l(e,t,n,i))}},{key:"removeUploadedFile",value:function(e,t,n){this.store.dispatch(new ue.d(e,t,n))}}]),e}()).\u0275fac=function(e){return new(e||ve)(c["\u0275\u0275inject"](te.i))},ve.\u0275prov=c["\u0275\u0275defineInjectable"]({token:ve,factory:ve.\u0275fac}),ve),Ie=r("DNva"),Oe=r("YIpg"),je=r("8a3C"),Ce=r("EdIQ"),Ee=r("uLZQ"),De=r("zQ+x"),we=r("5HAD"),ke=r("7vy/"),Fe=r("VOnO"),Be=r("tk/3"),Me=((he=function(t){u(i,t);var n=p(i);function i(e,t,o,r,s,c,l,u){var d;return a(this,i),(d=n.call(this,e,t,null,r,s,c,l,u,"submissionuploads")).requestService=e,d.rdbService=t,d.store=o,d.objectCache=r,d.halService=s,d.notificationsService=c,d.http=l,d.comparator=u,d}return l(i,[{key:"findByHref",value:function(t){for(var n,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length,a=new Array(s>3?s-3:0),c=3;c<s;c++)a[c-3]=arguments[c];return(n=e(f(i.prototype),"findByHref",this)).call.apply(n,[this,t,o,r].concat(a))}}]),i}(Ce.a)).\u0275fac=function(e){return new(e||he)(c["\u0275\u0275inject"](N.a),c["\u0275\u0275inject"](ke.a),c["\u0275\u0275inject"](te.i),c["\u0275\u0275inject"](U.a),c["\u0275\u0275inject"](Ee.a),c["\u0275\u0275inject"](P.a),c["\u0275\u0275inject"](Be.b),c["\u0275\u0275inject"](Fe.a))},he.\u0275prov=c["\u0275\u0275defineInjectable"]({token:he,factory:he.\u0275fac}),he=Object(b.b)([Object(De.d)(we.g)],he)),Le=r("ac5F");function Te(e,t){1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275elementStart"](2,"div",2),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275elementStart"](4,"div",3),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275elementStart"](6,"h3",4),c["\u0275\u0275elementStart"](7,"span",5),c["\u0275\u0275text"](8),c["\u0275\u0275pipe"](9,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](10,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](11,"\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](12,"\n"),c["\u0275\u0275elementContainerEnd"]()),2&e&&(c["\u0275\u0275advance"](8),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](9,1,"submission.sections.upload.no-file-uploaded")))}var Re=function(e){return{collectionName:e}};function Ve(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"](3);c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",c["\u0275\u0275pipeBind2"](2,1,"submission.sections.upload.header.policy.default.nolist",c["\u0275\u0275pureFunction1"](4,Re,n.collectionName)),"\n        ")}}function Pe(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"](3);c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",c["\u0275\u0275pipeBind2"](2,1,"submission.sections.upload.header.policy.default.withlist",c["\u0275\u0275pureFunction1"](4,Re,n.collectionName)),"\n        ")}}function $e(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"div",2),c["\u0275\u0275text"](1,"\n    "),c["\u0275\u0275elementStart"](2,"div",8),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275elementStart"](4,"ds-alert",9),c["\u0275\u0275text"](5,"\n        "),c["\u0275\u0275template"](6,Ve,3,6,"ng-container",1),c["\u0275\u0275text"](7,"\n        "),c["\u0275\u0275template"](8,Pe,3,6,"ng-container",1),c["\u0275\u0275text"](9,"\n        "),c["\u0275\u0275element"](10,"span",10),c["\u0275\u0275text"](11,"\n        "),c["\u0275\u0275element"](12,"ds-submission-section-upload-access-conditions",11),c["\u0275\u0275text"](13,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](14,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](15,"\n  "),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](4),c["\u0275\u0275property"]("type",n.AlertTypeEnum.Warning),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",1===n.collectionPolicyType),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",2===n.collectionPolicyType),c["\u0275\u0275advance"](4),c["\u0275\u0275property"]("accessConditions",n.collectionDefaultAccessConditions)}}function Ae(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n    "),c["\u0275\u0275element"](2,"ds-submission-upload-section-file",12),c["\u0275\u0275pipe"](3,"async"),c["\u0275\u0275text"](4,"\n    "),c["\u0275\u0275elementStart"](5,"div",2),c["\u0275\u0275text"](6,"\n      "),c["\u0275\u0275elementStart"](7,"div",3),c["\u0275\u0275text"](8,"\n        "),c["\u0275\u0275element"](9,"hr"),c["\u0275\u0275text"](10,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](11,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](12,"\n  "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit,i=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("availableAccessConditionOptions",i.availableAccessConditionOptions)("collectionId",i.collectionId)("collectionPolicyType",i.collectionPolicyType)("configMetadataForm",c["\u0275\u0275pipeBind1"](3,9,i.configMetadataForm$))("fileId",i.fileIndexes[i.fileList.indexOf(n)])("fileIndex",i.fileList.indexOf(n))("fileName",i.fileNames[i.fileList.indexOf(n)])("sectionId",i.sectionData.id)("submissionId",i.submissionId)}}function _e(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n\n  "),c["\u0275\u0275template"](2,$e,16,4,"div",6),c["\u0275\u0275text"](3,"\n\n  "),c["\u0275\u0275template"](4,Ae,13,11,"ng-container",7),c["\u0275\u0275text"](5,"\n"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",n.collectionDefaultAccessConditions.length>0),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",n.fileList)}}var qe,Ue=((qe=function(e){u(n,e);var t=p(n);function n(e,i,o,r,s,c,l,u,d,p){var m;return a(this,n),(m=t.call(this,void 0,d,p)).bitstreamService=e,m.changeDetectorRef=i,m.collectionDataService=o,m.groupService=r,m.resourcePolicyService=s,m.sectionService=c,m.submissionService=l,m.uploadsConfigService=u,m.injectedSectionData=d,m.injectedSubmissionId=p,m.AlertTypeEnum=Le.a,m.fileIndexes=[],m.fileList=[],m.fileNames=[],m.collectionDefaultAccessConditions=[],m.required$=new ye.a(!0),m.subs=[],m}return l(n,[{key:"onSectionInit",value:function(){var e=this,t=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,Object(G.a)("metadata")).pipe(Object(_.i)(),Object(h.a)((function(e){return e.payload})));this.configMetadataForm$=t.pipe(Object(se.a)((function(e){return e.metadata.pipe(Object(_.i)(),Object(h.a)((function(e){return e.payload})))}))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe(Object(O.a)((function(e){return Object(w.h)(e)&&!e.isLoading})),Object(O.a)((function(t){return Object(w.j)(e.collectionId)||e.collectionId!==t.collection})),Object(g.a)((function(t){return e.collectionId=t.collection})),Object(y.a)((function(t){return e.collectionDataService.findById(t.collection)})),Object(O.a)((function(e){return Object(w.h)(e.payload)})),Object(g.a)((function(t){return e.collectionName=t.payload.name})),Object(y.a)((function(){return t}))).subscribe((function(t){e.required$.next(t.required),e.availableAccessConditionOptions=Object(w.e)(t.accessConditionOptions)?t.accessConditionOptions:[],e.collectionPolicyType=e.availableAccessConditionOptions.length>0?2:1,e.changeDetectorRef.detectChanges()})),Object(v.a)(this.configMetadataForm$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id)).pipe(Object(O.a)((function(e){var t=o(e,2),n=t[0],i=t[1];return Object(w.e)(n)&&Object(w.h)(i)})),Object(I.a)()).subscribe((function(t){var n=o(t,2),i=n[0],r=n[1];e.fileList=[],e.fileIndexes=[],e.fileNames=[],e.changeDetectorRef.detectChanges(),Object(w.h)(r)&&r.length>0&&r.forEach((function(t){e.fileList.push(t),e.fileIndexes.push(t.uuid),e.fileNames.push(e.getFileName(i,t))})),e.changeDetectorRef.detectChanges()})))}},{key:"getFileName",value:function(e,t){var n=e.rows[0].fields[0].selectableMetadata[0].metadata;return Object(w.e)(t.metadata)&&Object(w.e)(t.metadata[n])?t.metadata[n][0].display:t.uuid}},{key:"getSectionStatus",value:function(){return Object(v.a)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(function(e,t){return!e||Object(w.h)(t)&&t.length>0}))}},{key:"onSectionDestroy",value:function(){this.subs.filter((function(e){return Object(w.b)(e)})).forEach((function(e){return e.unsubscribe()}))}}]),n}(k)).\u0275fac=function(e){return new(e||qe)(c["\u0275\u0275directiveInject"](xe),c["\u0275\u0275directiveInject"](c.ChangeDetectorRef),c["\u0275\u0275directiveInject"](Ie.a),c["\u0275\u0275directiveInject"](Oe.a),c["\u0275\u0275directiveInject"](je.a),c["\u0275\u0275directiveInject"]($.a),c["\u0275\u0275directiveInject"](R.a),c["\u0275\u0275directiveInject"](Me),c["\u0275\u0275directiveInject"]("sectionDataProvider"),c["\u0275\u0275directiveInject"]("submissionIdProvider"))},qe.\u0275cmp=c["\u0275\u0275defineComponent"]({type:qe,selectors:[["ds-submission-section-upload"]],features:[c["\u0275\u0275InheritDefinitionFeature"]],decls:6,vars:5,consts:[[3,"content","dismissible","type"],[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"text-center"],[1,"text-muted"],["class","row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]],template:function(e,t){1&e&&(c["\u0275\u0275element"](0,"ds-alert",0),c["\u0275\u0275text"](1,"\n\n"),c["\u0275\u0275template"](2,Te,13,3,"ng-container",1),c["\u0275\u0275text"](3,"\n\n"),c["\u0275\u0275template"](4,_e,6,2,"ng-container",1),c["\u0275\u0275text"](5,"\n")),2&e&&(c["\u0275\u0275property"]("content","submission.sections.upload.info")("dismissible",!0)("type",t.AlertTypeEnum.Info),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",0==t.fileList.length),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",t.fileList.length>0))},styles:[""]}),qe=Object(b.b)([Object(L.a)(T.a.Upload)],qe));r("T/iP");var Ne=r("BVmw"),Ge={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},Qe=[{id:"granted",label:"I confirm the license above",required:!0,value:!1,validators:{required:null},errorMessages:{required:"You must accept the license",notgranted:"You must accept the license"},type:"CHECKBOX"}],Je=["formRef"];function Xe(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ds-form",2,3),c["\u0275\u0275listener"]("dfChange",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onChange(e)})),c["\u0275\u0275elementEnd"]()}if(2&e){var i=c["\u0275\u0275nextContext"]();c["\u0275\u0275property"]("formId",i.formId)("formModel",i.formModel)("formLayout",i.formLayout)("displaySubmit",i.displaySubmit)("displayCancel",!1)}}var He,Ye=((He=function(e){u(n,e);var t=p(n);function n(e,i,o,r,s,c,l,u,d,p,m){var f;return a(this,n),(f=t.call(this,d,p,m)).changeDetectorRef=e,f.collectionDataService=i,f.formBuilderService=o,f.formOperationsService=r,f.formService=s,f.operationsBuilder=c,f.sectionService=l,f.submissionService=u,f.injectedCollectionId=d,f.injectedSectionData=p,f.injectedSubmissionId=m,f.formLayout=Ge,f.displaySubmit=!1,f.subs=[],f}return l(n,[{key:"onSectionInit",value:function(){var e=this;this.pathCombiner=new B.a("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(Qe);var t=this.formBuilderService.findById("granted",this.formModel);t.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,Object(G.a)("license")).pipe(Object(O.a)((function(e){return Object(w.h)(e.payload)})),Object(y.a)((function(e){return e.payload.license})),Object(x.a)((function(e){return Object(w.h)(e.payload)})),Object(h.a)((function(e){return e.payload.text})),Object(D.a)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe(Object(S.a)(1),Object(O.a)((function(e){return e}))).subscribe((function(){t.disabled=!0})),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe(Object(O.a)((function(e){return Object(w.e)(e)})),Object(I.a)()).subscribe((function(n){var i=n.map((function(e){return"/sections/license"===e.path?t.checked?null:Object.assign({},e,{path:"/sections/license/granted"}):e})).filter((function(e){return Object(w.g)(e)}));Object(w.e)(i)?(e.sectionService.checkSectionErrors(e.submissionId,e.sectionData.id,e.formId,i),e.sectionData.errors=n):e.sectionService.dispatchRemoveSectionErrors(e.submissionId,e.sectionData.id),e.changeDetectorRef.detectChanges()})))}},{key:"getSectionStatus",value:function(){var e=this.formBuilderService.findById("granted",this.formModel);return e.valueChanges.pipe(Object(h.a)((function(e){return!0===e})),Object(D.a)(e.value))}},{key:"onChange",value:function(e){var t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),n=this.formOperationsService.getFieldValueFromChangeEvent(e);n?(this.operationsBuilder.add(this.pathCombiner.getPath(t),n.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(t))}},{key:"onSectionDestroy",value:function(){this.subs.filter((function(e){return Object(w.b)(e)})).forEach((function(e){return e.unsubscribe()}))}}]),n}(k)).\u0275fac=function(e){return new(e||He)(c["\u0275\u0275directiveInject"](c.ChangeDetectorRef),c["\u0275\u0275directiveInject"](Ie.a),c["\u0275\u0275directiveInject"](C.a),c["\u0275\u0275directiveInject"](V.a),c["\u0275\u0275directiveInject"](E.a),c["\u0275\u0275directiveInject"](Ne.a),c["\u0275\u0275directiveInject"]($.a),c["\u0275\u0275directiveInject"](R.a),c["\u0275\u0275directiveInject"]("collectionIdProvider"),c["\u0275\u0275directiveInject"]("sectionDataProvider"),c["\u0275\u0275directiveInject"]("submissionIdProvider"))},He.\u0275cmp=c["\u0275\u0275defineComponent"]({type:He,selectors:[["ds-submission-section-license"]],viewQuery:function(e,t){var n;1&e&&c["\u0275\u0275viewQuery"](Je,1),2&e&&c["\u0275\u0275queryRefresh"](n=c["\u0275\u0275loadQuery"]())&&(t.formRef=n.first)},features:[c["\u0275\u0275InheritDefinitionFeature"]],decls:9,vars:4,consts:[[1,"mb-5",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange"],["formRef","formComponent"]],template:function(e,t){1&e&&(c["\u0275\u0275element"](0,"span",0),c["\u0275\u0275pipe"](1,"async"),c["\u0275\u0275text"](2,"\n"),c["\u0275\u0275element"](3,"br"),c["\u0275\u0275text"](4," "),c["\u0275\u0275element"](5,"br"),c["\u0275\u0275text"](6,"\n"),c["\u0275\u0275template"](7,Xe,2,5,"ds-form",1),c["\u0275\u0275text"](8,"\n")),2&e&&(c["\u0275\u0275property"]("innerHTML",c["\u0275\u0275pipeBind1"](1,2,t.licenseText$),c["\u0275\u0275sanitizeHtml"]),c["\u0275\u0275advance"](7),c["\u0275\u0275property"]("ngIf",t.formModel))},directives:[X.p,Y.a],pipes:[X.b],styles:[""]}),He=Object(b.b)([Object(L.a)(T.a.License)],He));r("SCNa");var Ke=r("e+Av"),ze={id:"metadata",group:[]},Ze={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},We={id:"accessConditionGroup",group:[]},et={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},tt={id:"accessConditions",groupFactory:null},nt={grid:{group:"form-row pt-4"}},it={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},ot={element:{host:"col-12",label:"col-form-label name-label"}},rt={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ke.Q,operator:Ke.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},st={element:{label:"col-form-label"},grid:{host:"col-6"}},at={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ke.Q,operator:Ke.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},ct={element:{label:"col-form-label"},grid:{host:"col-6"}},lt=r("fM99"),ut=r("1kSV"),dt=["formRef"];function pt(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ds-form",6,7),c["\u0275\u0275listener"]("submitForm",(function(){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onSubmit()}))("cancel",(function(){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onModalClose()}))("dfChange",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onChange(e)})),c["\u0275\u0275elementEnd"]()}if(2&e){var i=c["\u0275\u0275nextContext"]();c["\u0275\u0275property"]("formId",i.formId)("formModel",i.formModel)("displaySubmit",!i.isSaving)("displayCancel",!i.isSaving)}}var mt,ft=((mt=function(){function e(t,n,i,o,r,s,c,l){a(this,e),this.activeModal=t,this.cdr=n,this.formBuilderService=i,this.formService=o,this.submissionService=r,this.operationsBuilder=s,this.operationsService=c,this.uploadService=l,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}return l(e,[{key:"initModelData",value:function(e){var t=this;this.fileData.accessConditions.forEach((function(n,i){Array.of("name","startDate","endDate").filter((function(e){return n.hasOwnProperty(e)&&Object(w.e)(n[e])})).forEach((function(o){var r=t.formBuilderService.findById(o,e,i);if(r)if(r.type===Ke.g){var s=new Date(n[o]);r.value={year:s.getUTCFullYear(),month:s.getUTCMonth()+1,day:s.getUTCDate()}}else r.value=n[o]}))}))}},{key:"onChange",value:function(e){"name"===e.model.id&&this.setOptions(e.model,e.control)}},{key:"onModalClose",value:function(){this.activeModal.dismiss()}},{key:"onSubmit",value:function(){this.isSaving=!0,this.saveBitstreamData()}},{key:"setOptions",value:function(e,t){var n=null;if(this.availableAccessConditionOptions.filter((function(e){return e.name===t.value})).forEach((function(e){return n=e})),Object(w.e)(n)){var i=!0===n.hasStartDate||!0===n.hasEndDate,o=t.parent.get("startDate"),r=t.parent.get("endDate");if(null==o||o.markAsUntouched(),null==r||r.markAsUntouched(),null==o||o.setValue(null),t.parent.markAsDirty(),null==r||r.setValue(null),i){if(n.hasStartDate){var s=this.formBuilderService.findById("startDate",e.parent.group),a=new Date(n.maxStartDate);s.max={year:a.getUTCFullYear(),month:a.getUTCMonth()+1,day:a.getUTCDate()}}if(n.hasEndDate){var c=this.formBuilderService.findById("endDate",e.parent.group),l=new Date(n.maxEndDate);c.max={year:l.getUTCFullYear(),month:l.getUTCMonth()+1,day:l.getUTCDate()}}}}}},{key:"ngOnInit",value:function(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}},{key:"ngOnDestroy",value:function(){this.unsubscribeAll()}},{key:"retrieveValueFromField",value:function(e){var t=Array.isArray(e)?e[0]:e;return t?t.value:void 0}},{key:"buildFileEditForm",value:function(){var e=Object.assign({},this.configMetadataForm.rows[0].fields[0]);e.repeatable=!1;var t=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],e])}),i=[],o=Object.assign({},ze);o.group=this.formBuilderService.modelFromConfiguration(this.submissionId,t,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),i.push(new Ke.D(o,Ze));var r=Object.assign({},it),s=Object.assign({},tt),a=[];if(2===this.collectionPolicyType){var c,l=n(this.availableAccessConditionOptions);try{for(l.s();!(c=l.n()).done;){var u=c.value;a.push({label:u.name,value:u.name})}}catch(v){l.e(v)}finally{l.f()}r.options=a;var d=[],p=[],m=[];this.availableAccessConditionOptions.forEach((function(e){var t=!0===e.hasStartDate,n=!0===e.hasEndDate,i=t||n;t&&d.push({id:"name",value:e.name}),n&&p.push({id:"name",value:e.name}),i&&m.push({id:"name",value:e.name})}));var f={relations:[{match:Ke.Q,operator:Ke.R,when:d}]},b={relations:[{match:Ke.Q,operator:Ke.R,when:p}]};s.groupFactory=function(){var e=new Ke.N(r,ot),t=Object.assign({},rt,f),n=Object.assign({},at,b),i=new Ke.t(t,st),o=new Ke.t(n,ct),s=Object.assign({},We);return s.group=[e],d.length>0&&s.group.push(i),p.length>0&&s.group.push(o),[new Ke.D(s,et)]},s.initialCount=Object(w.e)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,i.push(new Ke.w(s,nt))}return this.initModelData(i),i}},{key:"saveBitstreamData",value:function(){var e=this;this.formService.validateAllFormFields(this.formRef.formGroup);var t=this.formService.isValid(this.formId).pipe(Object(S.a)(1),Object(O.a)((function(e){return e})),Object(y.a)((function(){return e.formService.getFormData(e.formId)})),Object(S.a)(1),Object(y.a)((function(t){Object.keys(t.metadata).filter((function(e){return Object(w.e)(t.metadata[e])})).forEach((function(n){var i=n.replace(/_/g,".");e.operationsBuilder.add(e.pathCombiner.getPath("metadata/".concat(i)),t.metadata[n],!0)})),Object.keys(e.fileData.metadata).filter((function(t){return Object(w.e)(e.fileData.metadata[t])})).filter((function(e){return Object(w.a)(t.metadata[e])})).filter((function(t){return e.formMetadata.includes(t)})).forEach((function(t){var n=t.replace(/_/g,".");e.operationsBuilder.remove(e.pathCombiner.getPath("metadata/".concat(n)))}));var n=[];return t.accessConditions.map((function(e){return e.accessConditionGroup})).filter((function(e){return Object(w.e)(e)})).forEach((function(t){var i;if(e.availableAccessConditionOptions.filter((function(e){return Object(w.g)(t.name)&&e.name===t.name[0].value})).forEach((function(e){return i=e})),i){var o=Object.assign({},t);if(o.name=e.retrieveValueFromField(t.name),i.hasStartDate){if(t.startDate){var r=e.retrieveValueFromField(t.startDate);o.startDate=Object(lt.a)(r)}}else delete o.startDate;if(i.hasEndDate){if(t.endDate){var s=e.retrieveValueFromField(t.endDate);o.endDate=Object(lt.a)(s)}}else delete o.endDate;n.push(o)}})),Object(w.e)(n)&&e.operationsBuilder.add(e.pathCombiner.getPath("accessConditions"),n,!0),e.operationsService.jsonPatchByResourceID(e.submissionService.getSubmissionObjectLinkName(),e.submissionId,e.pathCombiner.rootElement,e.pathCombiner.subRootElement)}))).subscribe((function(t){if(t[0].sections[e.sectionId]){var n=t[0].sections[e.sectionId];Object.keys(n.files).filter((function(t){return n.files[t].uuid===e.fileId})).forEach((function(t){return e.uploadService.updateFileData(e.submissionId,e.sectionId,e.fileId,n.files[t])}))}e.isSaving=!1,e.activeModal.close()}));this.subscriptions.push(t)}},{key:"unsubscribeAll",value:function(){this.subscriptions.filter((function(e){return Object(w.b)(e)})).forEach((function(e){return e.unsubscribe()}))}}]),e}()).\u0275fac=function(e){return new(e||mt)(c["\u0275\u0275directiveInject"](ut.c),c["\u0275\u0275directiveInject"](c.ChangeDetectorRef),c["\u0275\u0275directiveInject"](C.a),c["\u0275\u0275directiveInject"](E.a),c["\u0275\u0275directiveInject"](R.a),c["\u0275\u0275directiveInject"](Ne.a),c["\u0275\u0275directiveInject"](pe.a),c["\u0275\u0275directiveInject"](xe))},mt.\u0275cmp=c["\u0275\u0275defineComponent"]({type:mt,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(e,t){var n;1&e&&c["\u0275\u0275viewQuery"](dt,1),2&e&&c["\u0275\u0275queryRefresh"](n=c["\u0275\u0275loadQuery"]())&&(t.formRef=n.first)},decls:21,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"disabled","click"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange"],["formRef","formComponent"]],template:function(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"div"),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275elementStart"](2,"div",0),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275elementStart"](4,"h4",1),c["\u0275\u0275text"](5),c["\u0275\u0275pipe"](6,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](7,"\n    "),c["\u0275\u0275elementStart"](8,"button",2),c["\u0275\u0275listener"]("click",(function(){return t.onModalClose()})),c["\u0275\u0275text"](9,"\n      "),c["\u0275\u0275elementStart"](10,"span",3),c["\u0275\u0275text"](11,"\xd7"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](12,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](13,"\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](14,"\n  "),c["\u0275\u0275elementStart"](15,"div",4),c["\u0275\u0275text"](16,"\n\n    "),c["\u0275\u0275template"](17,pt,2,4,"ds-form",5),c["\u0275\u0275text"](18,"\n\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](19,"\n"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](20,"\n")),2&e&&(c["\u0275\u0275advance"](5),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](6,3,"submission.sections.upload.edit.title")),c["\u0275\u0275advance"](3),c["\u0275\u0275property"]("disabled",t.isSaving),c["\u0275\u0275advance"](9),c["\u0275\u0275property"]("ngIf",t.formModel))},directives:[X.p,Y.a],pipes:[J.d],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),mt),bt=r("PJyI"),vt=r("/lGE"),ht=r("OXP5"),gt=r("/eM4");function yt(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span",3),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate3"]("\n    ",n.name," ",n.startDate," ",n.endDate,"\n  ")}}function St(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span",3),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate2"]("",n.name," from ",n.endDate,"")}}function xt(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span",4),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate2"]("",n.name," until ",n.startDate,"")}}function It(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275template"](2,yt,2,3,"span",1),c["\u0275\u0275text"](3,"\n  "),c["\u0275\u0275template"](4,St,2,2,"span",1),c["\u0275\u0275text"](5,"\n  "),c["\u0275\u0275template"](6,xt,2,2,"span",2),c["\u0275\u0275text"](7,"\n  "),c["\u0275\u0275element"](8,"br"),c["\u0275\u0275text"](9,"\n"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf","DEFAULT_BITSTREAM_READ"==n.action),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf","lease"==n.name),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf","embargo"==n.name)}}var Ot,jt=((Ot=function(){function e(t){a(this,e),this.groupService=t,this.accessConditionsList=[]}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.accessConditions.forEach((function(t){Object(w.d)(t.name)?e.groupService.findByHref(t._links.group.href).pipe(Object(x.a)((function(e){return!e.isResponsePending&&e.hasSucceeded}))).subscribe((function(n){var i=n.payload,o=Object.assign({},t);o.name=i.name,e.accessConditionsList.push(o)})):e.accessConditionsList.push(t)}))}}]),e}()).\u0275fac=function(e){return new(e||Ot)(c["\u0275\u0275directiveInject"](Oe.a))},Ot.\u0275cmp=c["\u0275\u0275defineComponent"]({type:Ot,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(e,t){1&e&&(c["\u0275\u0275template"](0,It,10,3,"ng-container",0),c["\u0275\u0275text"](1,"\n")),2&e&&c["\u0275\u0275property"]("ngForOf",t.accessConditionsList)},directives:[X.o,X.p],encapsulation:2}),Ot),Ct=r("BCqK");function Et(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275elementStart"](2,"h5"),c["\u0275\u0275text"](3),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](4,"\n      "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate1"]("\n          ",n.value,"\n        ")}}function Dt(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"h5"),c["\u0275\u0275text"](1,"\n          "),c["\u0275\u0275elementStart"](2,"span",4),c["\u0275\u0275text"](3),c["\u0275\u0275pipe"](4,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](5,"\n        "),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"](4);c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate2"]("",c["\u0275\u0275pipeBind1"](4,2,"submission.sections.upload.no-entry")," ",n.fileTitleKey,"")}}function wt(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275template"](2,Dt,6,4,"h5",0),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit,i=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",0===i.metadata[i.fileTitleKey].indexOf(n))}}function kt(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275template"](2,Et,5,1,"ng-container",0),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275template"](4,wt,4,1,"ng-container",0),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275element"](6,"span",1),c["\u0275\u0275text"](7,"\n    "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",""!==n.value),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",""===n.value)}}var Ft=function(){return["150"]};function Bt(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"dsTruncate"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",c["\u0275\u0275pipeBind2"](2,1,n.value,c["\u0275\u0275pureFunction0"](4,Ft)),"\n      ")}}function Mt(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span",4),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"](4);c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate2"]("",c["\u0275\u0275pipeBind1"](2,2,"submission.sections.upload.no-entry")," ",n.fileDescrKey,"")}}function Lt(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275template"](2,Mt,3,4,"span",5),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit,i=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",0===i.metadata[i.fileDescrKey].indexOf(n))}}function Tt(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275template"](2,Bt,3,5,"ng-container",0),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275template"](4,Lt,4,1,"ng-container",0),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275element"](6,"span",1),c["\u0275\u0275text"](7,"\n    "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",""!==n.value),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",""===n.value)}}function Rt(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n    "),c["\u0275\u0275template"](2,kt,8,2,"ng-container",3),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275template"](4,Tt,8,2,"ng-container",3),c["\u0275\u0275text"](5,"\n  "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",n.getAllMetadataValue(n.fileTitleKey)),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",n.getAllMetadataValue(n.fileDescrKey))}}var Vt,Pt=((Vt=function(){function e(){a(this,e),this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}return l(e,[{key:"ngOnInit",value:function(){Object(w.e)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=gt.a.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=gt.a.all(this.fileData.metadata,"dc.description"))}},{key:"getAllMetadataValue",value:function(e){return gt.a.all(this.metadata,e)}}]),e}()).\u0275fac=function(e){return new(e||Vt)},Vt.\u0275cmp=c["\u0275\u0275defineComponent"]({type:Vt,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},decls:9,vars:2,consts:[[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"]],template:function(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"div"),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275template"](2,Rt,6,2,"ng-container",0),c["\u0275\u0275text"](3,"\n\n  "),c["\u0275\u0275element"](4,"span",1),c["\u0275\u0275text"](5,"\n  "),c["\u0275\u0275element"](6,"ds-submission-section-upload-access-conditions",2),c["\u0275\u0275text"](7,"\n"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](8,"\n")),2&e&&(c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",t.metadata),c["\u0275\u0275advance"](4),c["\u0275\u0275property"]("accessConditions",t.fileData.accessConditions))},directives:[X.p,jt,X.o],pipes:[J.d,Ct.a],encapsulation:2}),Vt),$t=r("t8/W");function At(e,t){1&e&&c["\u0275\u0275element"](0,"i",18)}function _t(e,t){1&e&&c["\u0275\u0275element"](0,"i",19)}function qt(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275elementStart"](2,"div",2),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275elementStart"](4,"div",3),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275text"](6,"\n      "),c["\u0275\u0275element"](7,"ds-thumbnail",4),c["\u0275\u0275text"](8,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](9,"\n    "),c["\u0275\u0275elementStart"](10,"div",5),c["\u0275\u0275text"](11,"\n      "),c["\u0275\u0275elementStart"](12,"div",6),c["\u0275\u0275text"](13,"\n        "),c["\u0275\u0275elementStart"](14,"h3"),c["\u0275\u0275text"](15),c["\u0275\u0275elementStart"](16,"span",7),c["\u0275\u0275text"](17),c["\u0275\u0275pipe"](18,"dsFileSize"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](19,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](20,"\n      "),c["\u0275\u0275elementStart"](21,"div",8),c["\u0275\u0275text"](22,"\n        "),c["\u0275\u0275elementContainerStart"](23),c["\u0275\u0275text"](24,"\n          "),c["\u0275\u0275elementStart"](25,"ds-file-download-link",9),c["\u0275\u0275text"](26,"\n            "),c["\u0275\u0275element"](27,"i",10),c["\u0275\u0275text"](28,"\n          "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](29,"\n          "),c["\u0275\u0275elementStart"](30,"button",11),c["\u0275\u0275listener"]("click",(function(e){c["\u0275\u0275restoreView"](n);var t=c["\u0275\u0275nextContext"]();return e.preventDefault(),t.editBitstreamData()})),c["\u0275\u0275pipe"](31,"translate"),c["\u0275\u0275pipe"](32,"translate"),c["\u0275\u0275text"](33,"\n            "),c["\u0275\u0275element"](34,"i",12),c["\u0275\u0275text"](35,"\n          "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](36,"\n          "),c["\u0275\u0275elementStart"](37,"button",13),c["\u0275\u0275listener"]("click",(function(e){c["\u0275\u0275restoreView"](n);var t=c["\u0275\u0275nextContext"](),i=c["\u0275\u0275reference"](3);return e.preventDefault(),t.confirmDelete(i)})),c["\u0275\u0275pipe"](38,"translate"),c["\u0275\u0275pipe"](39,"translate"),c["\u0275\u0275pipe"](40,"async"),c["\u0275\u0275text"](41,"\n            "),c["\u0275\u0275template"](42,At,1,0,"i",14),c["\u0275\u0275pipe"](43,"async"),c["\u0275\u0275text"](44,"\n            "),c["\u0275\u0275template"](45,_t,1,0,"i",15),c["\u0275\u0275pipe"](46,"async"),c["\u0275\u0275text"](47,"\n          "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](48,"\n        "),c["\u0275\u0275elementContainerEnd"](),c["\u0275\u0275text"](49,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](50,"\n      "),c["\u0275\u0275element"](51,"div",16),c["\u0275\u0275text"](52,"\n      "),c["\u0275\u0275element"](53,"ds-submission-section-upload-file-view",17),c["\u0275\u0275text"](54,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](55,"\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](56,"\n"),c["\u0275\u0275elementContainerEnd"]()}if(2&e){var i=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](7),c["\u0275\u0275property"]("thumbnail",null==i.fileData?null:i.fileData.thumbnail),c["\u0275\u0275advance"](8),c["\u0275\u0275textInterpolate1"]("",i.fileName," "),c["\u0275\u0275advance"](2),c["\u0275\u0275textInterpolate1"]("(",c["\u0275\u0275pipeBind1"](18,15,null==i.fileData?null:i.fileData.sizeBytes),")"),c["\u0275\u0275advance"](8),c["\u0275\u0275property"]("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",i.getBitstream())("enableRequestACopy",!1),c["\u0275\u0275advance"](5),c["\u0275\u0275propertyInterpolate"]("title",c["\u0275\u0275pipeBind1"](32,19,"submission.sections.upload.edit.title")),c["\u0275\u0275attribute"]("aria-label",c["\u0275\u0275pipeBind1"](31,17,"submission.sections.upload.edit.title")),c["\u0275\u0275advance"](7),c["\u0275\u0275propertyInterpolate"]("title",c["\u0275\u0275pipeBind1"](39,23,"submission.sections.upload.delete.confirm.title")),c["\u0275\u0275property"]("disabled",c["\u0275\u0275pipeBind1"](40,25,i.processingDelete$)),c["\u0275\u0275attribute"]("aria-label",c["\u0275\u0275pipeBind1"](38,21,"submission.sections.upload.delete.confirm.title")),c["\u0275\u0275advance"](5),c["\u0275\u0275property"]("ngIf",c["\u0275\u0275pipeBind1"](43,27,i.processingDelete$)),c["\u0275\u0275advance"](3),c["\u0275\u0275property"]("ngIf",!c["\u0275\u0275pipeBind1"](46,29,i.processingDelete$)),c["\u0275\u0275advance"](8),c["\u0275\u0275property"]("fileData",i.fileData)}}function Ut(e,t){1&e&&(c["\u0275\u0275text"](0,"\n  "),c["\u0275\u0275elementStart"](1,"div",20),c["\u0275\u0275text"](2,"\n    "),c["\u0275\u0275elementStart"](3,"h4",21),c["\u0275\u0275text"](4),c["\u0275\u0275pipe"](5,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](6,"\n    "),c["\u0275\u0275elementStart"](7,"button",22),c["\u0275\u0275listener"]("click",(function(){return(0,t.dismiss)("cancel")})),c["\u0275\u0275text"](8,"\n      "),c["\u0275\u0275elementStart"](9,"span",23),c["\u0275\u0275text"](10,"\xd7"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](11,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](12,"\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](13,"\n  "),c["\u0275\u0275elementStart"](14,"div",24),c["\u0275\u0275text"](15,"\n    "),c["\u0275\u0275elementStart"](16,"p"),c["\u0275\u0275text"](17),c["\u0275\u0275pipe"](18,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](19,"\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](20,"\n  "),c["\u0275\u0275elementStart"](21,"div",25),c["\u0275\u0275text"](22,"\n    "),c["\u0275\u0275elementStart"](23,"button",26),c["\u0275\u0275listener"]("click",(function(){return(0,t.close)("cancel")})),c["\u0275\u0275text"](24),c["\u0275\u0275pipe"](25,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](26,"\n    "),c["\u0275\u0275elementStart"](27,"button",27),c["\u0275\u0275listener"]("click",(function(){return(0,t.close)("ok")})),c["\u0275\u0275text"](28),c["\u0275\u0275pipe"](29,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](30,"\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](31,"\n")),2&e&&(c["\u0275\u0275advance"](4),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](5,4,"submission.sections.upload.delete.confirm.title")),c["\u0275\u0275advance"](13),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](18,6,"submission.sections.upload.delete.confirm.info")),c["\u0275\u0275advance"](7),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](25,8,"submission.sections.upload.delete.confirm.cancel")),c["\u0275\u0275advance"](4),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](29,10,"submission.sections.upload.delete.confirm.submit")))}var Nt,Gt=((Nt=function(){function e(t,n,i,o,r,s,c,l){a(this,e),this.cdr=t,this.formService=n,this.halService=i,this.modalService=o,this.operationsBuilder=r,this.operationsService=s,this.submissionService=c,this.uploadService=l,this.processingDelete$=new ye.a(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}return l(e,[{key:"ngOnChanges",value:function(){var e=this;this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe(Object(O.a)((function(e){return Object(w.h)(e)}))).subscribe((function(t){e.fileData=t})))}},{key:"ngOnInit",value:function(){this.formId=this.formService.getUniqueId(this.fileId),this.pathCombiner=new B.a("sections",this.sectionId,"files",this.fileIndex),this.loadFormMetadata()}},{key:"confirmDelete",value:function(e){var t=this;this.modalService.open(e).result.then((function(e){"ok"===e&&(t.processingDelete$.next(!0),t.deleteFile())}))}},{key:"getBitstream",value:function(){return Object.assign(new bt.a,{uuid:this.fileData.uuid})}},{key:"editBitstreamData",value:function(){var e=this.modalService.open(ft,{size:"xl",backdrop:"static"});e.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,e.componentInstance.collectionId=this.collectionId,e.componentInstance.collectionPolicyType=this.collectionPolicyType,e.componentInstance.configMetadataForm=this.configMetadataForm,e.componentInstance.fileData=this.fileData,e.componentInstance.fileId=this.fileId,e.componentInstance.fileIndex=this.fileIndex,e.componentInstance.formId=this.formId,e.componentInstance.sectionId=this.sectionId,e.componentInstance.formMetadata=this.formMetadata,e.componentInstance.pathCombiner=this.pathCombiner,e.componentInstance.submissionId=this.submissionId}},{key:"ngOnDestroy",value:function(){this.unsubscribeAll()}},{key:"unsubscribeAll",value:function(){this.subscriptions.filter((function(e){return Object(w.b)(e)})).forEach((function(e){return e.unsubscribe()}))}},{key:"loadFormMetadata",value:function(){var e=this;this.configMetadataForm.rows.forEach((function(t){t.fields.forEach((function(t){t.selectableMetadata.forEach((function(t){e.formMetadata.push(t.metadata)}))}))}))}},{key:"deleteFile",value:function(){var e=this;this.operationsBuilder.remove(this.pathCombiner.getPath()),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe((function(){e.uploadService.removeUploadedFile(e.submissionId,e.sectionId,e.fileId),e.processingDelete$.next(!1)})))}}]),e}()).\u0275fac=function(e){return new(e||Nt)(c["\u0275\u0275directiveInject"](c.ChangeDetectorRef),c["\u0275\u0275directiveInject"](E.a),c["\u0275\u0275directiveInject"](Ee.a),c["\u0275\u0275directiveInject"](ut.q),c["\u0275\u0275directiveInject"](Ne.a),c["\u0275\u0275directiveInject"](pe.a),c["\u0275\u0275directiveInject"](R.a),c["\u0275\u0275directiveInject"](xe))},Nt.\u0275cmp=c["\u0275\u0275defineComponent"]({type:Nt,selectors:[["ds-submission-upload-section-file"]],viewQuery:function(e,t){var n;1&e&&c["\u0275\u0275viewQuery"](ft,1),2&e&&c["\u0275\u0275queryRefresh"](n=c["\u0275\u0275loadQuery"]())&&(t.fileEditComp=n.first)},inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[c["\u0275\u0275NgOnChangesFeature"]],decls:5,vars:1,consts:[[4,"ngIf"],["content",""],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","click"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","disabled","click"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,t){1&e&&(c["\u0275\u0275template"](0,qt,57,31,"ng-container",0),c["\u0275\u0275text"](1,"\n\n"),c["\u0275\u0275template"](2,Ut,32,12,"ng-template",null,1,c["\u0275\u0275templateRefExtractor"]),c["\u0275\u0275text"](4,"\n")),2&e&&c["\u0275\u0275property"]("ngIf",t.fileData)},directives:[X.p,vt.a,ht.a,Pt],pipes:[$t.a,J.d,X.b],styles:[""]}),Nt);r("THnG");var Qt=r("a318"),Jt=(r("RMpN"),r("3cpT"),r("20cJ"),r("6c/T"),r("8U9A")),Xt=r("UXhX"),Ht=r("8aB6"),Yt=r("O/5o");function Kt(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"span"),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275element"](2,"ds-loading"),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275elementEnd"]())}function zt(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n        ",n.getSelectedCcLicense().name,"\n      ")}}function Zt(e,t){1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementContainerEnd"]()),2&e&&(c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",c["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.change"),"\n        "))}function Wt(e,t){1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementContainerEnd"]()),2&e&&(c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",c["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.select"),"\n        "))}function en(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span"),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275template"](2,Zt,3,3,"ng-container",3),c["\u0275\u0275text"](3,"\n        "),c["\u0275\u0275template"](4,Wt,3,3,"ng-container",3),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",n.storedCcLicenseLink),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",!n.storedCcLicenseLink)}}function tn(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"button",7),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementEnd"]()),2&e&&(c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n        ",c["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.none"),"\n      "))}function nn(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"button",8),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](n);var e=t.$implicit;return c["\u0275\u0275nextContext"]().selectCcLicense(e)})),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n        ",i.name,"\n      ")}}function on(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"div",10),c["\u0275\u0275text"](1,"\n            "),c["\u0275\u0275elementStart"](2,"h5"),c["\u0275\u0275text"](3),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](4,"\n            "),c["\u0275\u0275element"](5,"div",20),c["\u0275\u0275text"](6,"\n          "),c["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate1"]("\n              ",n.label,"\n            "),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("innerHTML",n.description,c["\u0275\u0275sanitizeHtml"])}}function rn(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275text"](0,"\n\n      "),c["\u0275\u0275elementStart"](1,"div"),c["\u0275\u0275text"](2,"\n\n        "),c["\u0275\u0275elementStart"](3,"div",15),c["\u0275\u0275text"](4,"\n          "),c["\u0275\u0275elementStart"](5,"div"),c["\u0275\u0275text"](6,"\n            "),c["\u0275\u0275elementStart"](7,"h4"),c["\u0275\u0275text"](8),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](9,"\n            "),c["\u0275\u0275element"](10,"div",16),c["\u0275\u0275text"](11,"\n          "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](12,"\n          "),c["\u0275\u0275elementStart"](13,"button",17),c["\u0275\u0275listener"]("click",(function(){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"](3).closeInfoModal()})),c["\u0275\u0275text"](14,"\n            "),c["\u0275\u0275elementStart"](15,"span",18),c["\u0275\u0275text"](16,"\xd7"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](17,"\n          "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](18,"\n        "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](19,"\n\n        "),c["\u0275\u0275elementStart"](20,"div",19),c["\u0275\u0275text"](21,"\n          "),c["\u0275\u0275template"](22,on,7,2,"div",9),c["\u0275\u0275text"](23,"\n        "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](24,"\n\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](25,"\n\n    ")}if(2&e){var i=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](8),c["\u0275\u0275textInterpolate1"]("\n              ",i.label,"\n            "),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("innerHTML",i.description,c["\u0275\u0275sanitizeHtml"]),c["\u0275\u0275advance"](12),c["\u0275\u0275property"]("ngForOf",i.enums)}}function sn(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"span"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().ngVar;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",n.label,"\n        ")}}function an(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"span"),c["\u0275\u0275text"](1),c["\u0275\u0275pipe"](2,"translate"),c["\u0275\u0275elementEnd"]()),2&e&&(c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n          ",c["\u0275\u0275pipeBind1"](2,1,"submission.sections.ccLicense.option.select"),"\n        "))}function cn(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0,2),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275template"](2,sn,2,1,"span",3),c["\u0275\u0275text"](3,"\n        "),c["\u0275\u0275template"](4,an,3,3,"span",3),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.ngVar;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",n),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",!n)}}function ln(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"button",8),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](n);var e=t.$implicit,i=c["\u0275\u0275nextContext"](2).$implicit,o=c["\u0275\u0275nextContext"](2);return o.selectOption(o.getSelectedCcLicense(),i,e)})),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n            ",i.label,"\n          ")}}function un(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"ds-select"),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275template"](2,cn,6,2,"ng-container",21),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275elementContainerStart"](4,4),c["\u0275\u0275text"](5,"\n        "),c["\u0275\u0275elementStart"](6,"div",22),c["\u0275\u0275text"](7,"\n          "),c["\u0275\u0275template"](8,ln,2,1,"button",6),c["\u0275\u0275text"](9,"\n        "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](10,"\n      "),c["\u0275\u0275elementContainerEnd"](),c["\u0275\u0275text"](11,"\n    "),c["\u0275\u0275elementEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit,i=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngVar",i.getSelectedOption(i.getSelectedCcLicense(),n)),c["\u0275\u0275advance"](6),c["\u0275\u0275property"]("ngForOf",n.enums)}}function dn(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"div",24),c["\u0275\u0275text"](1,"\n        "),c["\u0275\u0275elementStart"](2,"div",25),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](n);var e=t.$implicit,i=c["\u0275\u0275nextContext"](2).$implicit,o=c["\u0275\u0275nextContext"](2);return o.selectOption(o.getSelectedCcLicense(),i,e)})),c["\u0275\u0275text"](3,"\n          "),c["\u0275\u0275element"](4,"input",26),c["\u0275\u0275text"](5,"\n          "),c["\u0275\u0275elementStart"](6,"span"),c["\u0275\u0275text"](7),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](8,"\n        "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](9,"\n      "),c["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit,o=c["\u0275\u0275nextContext"](2).$implicit,r=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](4),c["\u0275\u0275propertyInterpolate"]("title",i.label),c["\u0275\u0275property"]("checked",r.isSelectedOption(r.getSelectedCcLicense(),o,i)),c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](i.label)}}function pn(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275template"](2,dn,10,3,"div",23),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]().$implicit;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",n.enums)}}function mn(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"div",10),c["\u0275\u0275text"](1,"\n\n    "),c["\u0275\u0275elementStart"](2,"div",11),c["\u0275\u0275text"](3,"\n      "),c["\u0275\u0275elementStart"](4,"div"),c["\u0275\u0275text"](5),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](6,"\n      "),c["\u0275\u0275elementStart"](7,"button",12),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](n);var e=c["\u0275\u0275reference"](14);return c["\u0275\u0275nextContext"](2).openInfoModal(e)})),c["\u0275\u0275text"](8,"\n        "),c["\u0275\u0275element"](9,"i",13),c["\u0275\u0275text"](10,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](11,"\n    "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](12,"\n\n    "),c["\u0275\u0275template"](13,rn,26,3,"ng-template",null,14,c["\u0275\u0275templateRefExtractor"]),c["\u0275\u0275text"](15,"\n\n    "),c["\u0275\u0275template"](16,un,12,2,"ds-select",3),c["\u0275\u0275text"](17,"\n\n    "),c["\u0275\u0275template"](18,pn,4,1,"ng-container",3),c["\u0275\u0275text"](19,"\n\n  "),c["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;c["\u0275\u0275advance"](4),c["\u0275\u0275classMapInterpolate1"]("font-weight-bold ",i.id,""),c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n        ",i.label,"\n      "),c["\u0275\u0275advance"](11),c["\u0275\u0275property"]("ngIf",(null==i.enums?null:i.enums.length)>5),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",(null==i.enums?null:i.enums.length)<=5)}}function fn(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n\n  "),c["\u0275\u0275template"](2,mn,20,6,"div",9),c["\u0275\u0275text"](3,"\n\n"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",n.getSelectedCcLicense().fields)}}function bn(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"div"),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275element"](2,"ds-loading"),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275elementEnd"]())}function vn(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"div",29),c["\u0275\u0275text"](1,"\n      "),c["\u0275\u0275elementStart"](2,"div"),c["\u0275\u0275text"](3),c["\u0275\u0275pipe"](4,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275elementStart"](6,"a",30),c["\u0275\u0275text"](7),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](8,"\n      "),c["\u0275\u0275elementStart"](9,"div",31),c["\u0275\u0275text"](10,"\n        "),c["\u0275\u0275elementStart"](11,"div",25),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](n);var e=c["\u0275\u0275nextContext"](3);return e.setAccepted(!e.accepted)})),c["\u0275\u0275text"](12,"\n          "),c["\u0275\u0275element"](13,"input",32),c["\u0275\u0275text"](14,"\n          "),c["\u0275\u0275elementStart"](15,"span"),c["\u0275\u0275text"](16),c["\u0275\u0275pipe"](17,"translate"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](18,"\n        "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](19,"\n      "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](20,"\n    "),c["\u0275\u0275elementEnd"]()}if(2&e){var i=c["\u0275\u0275nextContext"]().ngVar,o=c["\u0275\u0275nextContext"](2);c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate1"]("\n        ",c["\u0275\u0275pipeBind1"](4,5,"submission.sections.ccLicense.link"),"\n      "),c["\u0275\u0275advance"](3),c["\u0275\u0275propertyInterpolate"]("href",i,c["\u0275\u0275sanitizeUrl"]),c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate1"]("\n        ",i,"\n      "),c["\u0275\u0275advance"](6),c["\u0275\u0275property"]("checked",o.accepted),c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](c["\u0275\u0275pipeBind1"](17,7,"submission.sections.ccLicense.confirmation"))}}function hn(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n    "),c["\u0275\u0275template"](2,bn,4,0,"div",3),c["\u0275\u0275text"](3,"\n    "),c["\u0275\u0275template"](4,vn,21,9,"div",28),c["\u0275\u0275text"](5,"\n  "),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.ngVar;c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",!n),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",n)}}function gn(e,t){if(1&e&&(c["\u0275\u0275elementContainerStart"](0),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275template"](2,hn,6,2,"ng-container",27),c["\u0275\u0275pipe"](3,"async"),c["\u0275\u0275text"](4,"\n"),c["\u0275\u0275elementContainerEnd"]()),2&e){var n=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngVar",c["\u0275\u0275pipeBind1"](3,1,n.getCcLicenseLink$()))}}var yn,Sn,xn,In=((yn=function(e){u(n,e);var t=p(n);function n(e,i,o,r,s,c,l,u){var d;return a(this,n),(d=t.call(this,c,l,u)).modalService=e,d.sectionService=i,d.submissionCcLicensesDataService=o,d.submissionCcLicenseUrlDataService=r,d.operationsBuilder=s,d.injectedCollectionId=c,d.injectedSectionData=l,d.injectedSubmissionId=u,d.isLoading=!0,d.subscriptions=[],d}return l(n,[{key:"storedCcLicenseLink",get:function(){return this.data.uri}},{key:"accepted",get:function(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}},{key:"data",get:function(){return this.sectionData.data}},{key:"selectCcLicense",value:function(e){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===e.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:e.id,fields:{}},uri:void 0}))}},{key:"getSelectedCcLicense",value:function(){var e=this;return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter((function(t){return t.id===e.data.ccLicense.id}))[0]:null}},{key:"selectOption",value:function(e,t,n){var i,o,r;this.isSelectedOption(e,t,n)||this.updateSectionData({ccLicense:{id:e.id,fields:Object.assign({},this.data.ccLicense.fields,(i={},o=t.id,r=n,o in i?Object.defineProperty(i,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[o]=r,i))},accepted:!1})}},{key:"getSelectedOption",value:function(e,t){return this.data.ccLicense.fields[t.id]}},{key:"isSelectedOption",value:function(e,t,n){return this.getSelectedOption(e,t)&&this.getSelectedOption(e,t).id===n.id}},{key:"getCcLicenseLink$",value:function(){var e=this;if(this.storedCcLicenseLink)return Object(re.a)(this.storedCcLicenseLink);if(this.getSelectedCcLicense()&&!this.getSelectedCcLicense().fields.some((function(t){return!e.getSelectedOption(e.getSelectedCcLicense(),t)}))){var t=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(t,new Map(t.fields.map((function(n){return[n,e.getSelectedOption(t,n)]}))))}}},{key:"openInfoModal",value:function(e){this.modalRef=this.modalService.open(e)}},{key:"closeInfoModal",value:function(){this.modalRef.close()}},{key:"getSectionStatus",value:function(){return Object(re.a)(this.accepted)}},{key:"onSectionDestroy",value:function(){this.subscriptions.forEach((function(e){return e.unsubscribe()}))}},{key:"onSectionInit",value:function(){var e=this;this.pathCombiner=new B.a("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,T.a.CcLicense).pipe(Object(O.a)((function(e){return Object(w.e)(e)&&(Object(w.e)(e.data)||Object(w.e)(e.errorsToShow))})),Object(I.a)(),Object(h.a)((function(e){return e.data}))).subscribe((function(t){if(e.data.accepted!==t.accepted){var n=e.pathCombiner.getPath("uri");t.accepted?e.getCcLicenseLink$().pipe(Object(S.a)(1)).subscribe((function(t){e.operationsBuilder.add(n,t.toString(),!1,!0)})):e.data.uri&&e.operationsBuilder.remove(n)}e.sectionData.data=t})),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe(Object(_.i)(),Object(_.o)(),Object(h.a)((function(e){return e.page}))).subscribe((function(t){return e.submissionCcLicenses=t})))}},{key:"setAccepted",value:function(e){this.updateSectionData({accepted:e}),this.updateSectionStatus()}},{key:"updateSectionData",value:function(e){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,e))}}]),n}(k)).\u0275fac=function(e){return new(e||yn)(c["\u0275\u0275directiveInject"](ut.q),c["\u0275\u0275directiveInject"]($.a),c["\u0275\u0275directiveInject"](Jt.a),c["\u0275\u0275directiveInject"](Xt.a),c["\u0275\u0275directiveInject"](Ne.a),c["\u0275\u0275directiveInject"]("collectionIdProvider"),c["\u0275\u0275directiveInject"]("sectionDataProvider"),c["\u0275\u0275directiveInject"]("submissionIdProvider"))},yn.\u0275cmp=c["\u0275\u0275defineComponent"]({type:yn,selectors:[["ds-submission-section-cc-licenses"]],features:[c["\u0275\u0275InheritDefinitionFeature"]],decls:26,vars:8,consts:[[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],["infoModal",""],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",3,"checked"]],template:function(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"div",0),c["\u0275\u0275text"](1,"\n  "),c["\u0275\u0275elementStart"](2,"ds-select",1),c["\u0275\u0275text"](3,"\n\n    "),c["\u0275\u0275elementContainerStart"](4,2),c["\u0275\u0275text"](5,"\n      "),c["\u0275\u0275template"](6,Kt,4,0,"span",3),c["\u0275\u0275text"](7,"\n      "),c["\u0275\u0275template"](8,zt,2,1,"span",3),c["\u0275\u0275text"](9,"\n      "),c["\u0275\u0275template"](10,en,6,2,"span",3),c["\u0275\u0275text"](11,"\n    "),c["\u0275\u0275elementContainerEnd"](),c["\u0275\u0275text"](12,"\n\n    "),c["\u0275\u0275elementContainerStart"](13,4),c["\u0275\u0275text"](14,"\n      "),c["\u0275\u0275template"](15,tn,3,3,"button",5),c["\u0275\u0275text"](16,"\n      "),c["\u0275\u0275template"](17,nn,2,1,"button",6),c["\u0275\u0275text"](18,"\n    "),c["\u0275\u0275elementContainerEnd"](),c["\u0275\u0275text"](19,"\n\n  "),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](20,"\n"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275text"](21,"\n\n"),c["\u0275\u0275template"](22,fn,4,1,"ng-container",3),c["\u0275\u0275text"](23,"\n\n"),c["\u0275\u0275template"](24,gn,5,3,"ng-container",3),c["\u0275\u0275text"](25,"\n")),2&e&&(c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("disabled",!t.submissionCcLicenses),c["\u0275\u0275advance"](4),c["\u0275\u0275property"]("ngIf",!t.submissionCcLicenses),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",t.getSelectedCcLicense()),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",t.submissionCcLicenses&&!t.getSelectedCcLicense()),c["\u0275\u0275advance"](5),c["\u0275\u0275property"]("ngIf",0==(null==t.submissionCcLicenses?null:t.submissionCcLicenses.length)),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",t.submissionCcLicenses),c["\u0275\u0275advance"](5),c["\u0275\u0275property"]("ngIf",t.getSelectedCcLicense()),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",t.getCcLicenseLink$()))},directives:[Ht.a,X.p,X.o,H.a,Yt.a],pipes:[J.d,X.b],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]}),yn=Object(b.b)([Object(L.a)(T.a.CcLicense)],yn)),On=r("N0eT"),jn=r("udvk"),Cn=(r("YoQ9"),r("Ahb/"),r("qK5G"),r("kcqd")),En=((Sn=function(){function e(t){a(this,e),this.store=t}return l(e,[{key:"getAccessesData",value:function(e,t){return this.store.select(Object(Se.d)(e,t)).pipe(Object(O.a)((function(e){return Object(w.h)(e)})),Object(I.a)())}}]),e}()).\u0275fac=function(e){return new(e||Sn)(c["\u0275\u0275inject"](te.i))},Sn.\u0275prov=c["\u0275\u0275defineInjectable"]({token:Sn,factory:Sn.\u0275fac}),Sn),Dn={id:"discoverable",name:"discoverable"},wn={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},kn={id:"accessConditionGroup",group:[]},Fn={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},Bn={id:"accessCondition",groupFactory:null},Mn={grid:{group:"form-row pt-4"}},Ln={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},Tn={element:{host:"col-12",label:"col-form-label name-label"}},Rn={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ke.Q,operator:Ke.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},Vn={element:{label:"col-form-label"},grid:{host:"col-6"}},Pn={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Ke.Q,operator:Ke.R,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},$n={element:{label:"col-form-label"},grid:{host:"col-6"}},An=((xn=function(t){u(i,t);var n=p(i);function i(e,t,o,r,s,c,l,u){var d;return a(this,i),(d=n.call(this,e,t,null,r,s,c,l,u,"submissionaccessoptions")).requestService=e,d.rdbService=t,d.store=o,d.objectCache=r,d.halService=s,d.notificationsService=c,d.http=l,d.comparator=u,d}return l(i,[{key:"findByHref",value:function(t){for(var n,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length,a=new Array(s>3?s-3:0),c=3;c<s;c++)a[c-3]=arguments[c];return(n=e(f(i.prototype),"findByHref",this)).call.apply(n,[this,t,o,r].concat(a))}}]),i}(Ce.a)).\u0275fac=function(e){return new(e||xn)(c["\u0275\u0275inject"](N.a),c["\u0275\u0275inject"](ke.a),c["\u0275\u0275inject"](te.i),c["\u0275\u0275inject"](U.a),c["\u0275\u0275inject"](Ee.a),c["\u0275\u0275inject"](P.a),c["\u0275\u0275inject"](Be.b),c["\u0275\u0275inject"](Fe.a))},xn.\u0275prov=c["\u0275\u0275defineInjectable"]({token:xn,factory:xn.\u0275fac}),xn=Object(b.b)([Object(De.d)(we.a)],xn)),_n=["formRef"];function qn(e,t){if(1&e){var n=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ds-form",1,2),c["\u0275\u0275listener"]("dfChange",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onChange(e)}))("removeArrayItem",(function(e){return c["\u0275\u0275restoreView"](n),c["\u0275\u0275nextContext"]().onRemove(e)})),c["\u0275\u0275elementEnd"]()}if(2&e){var i=c["\u0275\u0275nextContext"]();c["\u0275\u0275property"]("formId",i.formId)("formModel",i.formModel)("displaySubmit",!1)("displayCancel",!1)}}var Un,Nn,Gn=((Un=function(e){u(i,e);var t=p(i);function i(e,n,o,r,s,c,l,u,d,p,m){var f;return a(this,i),(f=t.call(this,void 0,p,m)).sectionService=e,f.formBuilderService=n,f.accessesConfigService=o,f.accessesService=r,f.formOperationsService=s,f.operationsBuilder=c,f.formService=l,f.translate=u,f.operationsService=d,f.injectedSectionData=p,f.injectedSubmissionId=m,f.subs=[],f}return l(i,[{key:"initModelData",value:function(e){var t=this;this.accessesData.accessConditions.forEach((function(n,i){Array.of("name","startDate","endDate").filter((function(e){return n.hasOwnProperty(e)&&Object(w.e)(n[e])})).forEach((function(o){var r=t.formBuilderService.findById(o,e,i);if(r)if(r.type===Ke.g){var s=new Date(n[o]);r.value={year:s.getUTCFullYear(),month:s.getUTCMonth()+1,day:s.getUTCDate()}}else r.value=n[o]}))}))}},{key:"onChange",value:function(e){var t=this;if(e.model.type===Ke.e){var n=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),i=this.formOperationsService.getFieldValueFromChangeEvent(e);this.operationsBuilder.replace(this.pathCombiner.getPath(n),i.value,!0)}else{if(e.model.id===Ln.id){var o=e.control.parent.get("startDate"),r=e.control.parent.get("endDate");null==o||o.markAsUntouched(),null==r||r.markAsUntouched(),null==o||o.setValue(null),null==r||r.setValue(null),e.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe(Object(S.a)(1),Object(O.a)((function(e){return e})),Object(y.a)((function(){return t.formService.getFormData(t.formId)})),Object(S.a)(1)).subscribe((function(e){var n=[];e.accessCondition.map((function(e){return e.accessConditionGroup})).filter((function(e){return Object(w.e)(e)})).forEach((function(e){var i;if(t.availableAccessConditionOptions.filter((function(t){return Object(w.g)(e.name)&&t.name===e.name[0].value})).forEach((function(e){return i=e})),i){var o=Object.assign({},e);if(o.name=t.retrieveValueFromField(e.name),i.hasStartDate){if(e.startDate){var r=t.retrieveValueFromField(e.startDate);o.startDate=Object(lt.a)(r)}}else delete o.startDate;if(i.hasEndDate){if(e.endDate){var s=t.retrieveValueFromField(e.endDate);o.endDate=Object(lt.a)(s)}}else delete o.endDate;n.push(o)}})),t.operationsBuilder.add(t.pathCombiner.getPath("accessConditions"),n,!0)}))}}},{key:"onRemove",value:function(e){var t=this.formOperationsService.getArrayIndexFromEvent(e);this.operationsBuilder.remove(this.pathCombiner.getPath("accessConditions/"+t))}},{key:"onSectionDestroy",value:function(){this.subs.filter((function(e){return Object(w.b)(e)})).forEach((function(e){return e.unsubscribe()}))}},{key:"onSectionInit",value:function(){var e=this;this.pathCombiner=new B.a("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);var t=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe(Object(_.i)(),Object(h.a)((function(e){return e.payload}))),n=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);Object(v.a)([t,n]).subscribe((function(t){var n=o(t,2),i=n[0],r=n[1];e.availableAccessConditionOptions=Object(w.e)(i.accessConditionOptions)?i.accessConditionOptions:[],e.canChangeDiscoverable=!!i.canChangeDiscoverable,e.accessesData=r,e.formModel=e.buildFileEditForm()}))}},{key:"getSectionStatus",value:function(){return Object(re.a)(!0)}},{key:"buildFileEditForm",value:function(){var e=[];if(this.canChangeDiscoverable){var t=Object.assign({},Dn,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});e.push(new Ke.r(t,wn))}var i,o=Object.assign({},Ln),r=Object.assign({},Bn),s=[],a=n(this.availableAccessConditionOptions);try{for(a.s();!(i=a.n()).done;){var c=i.value;s.push({label:c.name,value:c.name})}}catch(f){a.e(f)}finally{a.f()}o.options=s;var l=[],u=[],d=[];this.availableAccessConditionOptions.forEach((function(e){var t=!0===e.hasStartDate,n=!0===e.hasEndDate,i=t||n;t&&l.push({id:"name",value:e.name}),n&&u.push({id:"name",value:e.name}),i&&d.push({id:"name",value:e.name})}));var p={relations:[{match:Ke.Q,operator:Ke.R,when:l}]},m={relations:[{match:Ke.Q,operator:Ke.R,when:u}]};return r.groupFactory=function(){var e=new Ke.N(o,Tn),t=Object.assign({},Rn,p),n=Object.assign({},Pn,m),i=new Ke.t(t,Vn),r=new Ke.t(n,$n),s=Object.assign({},kn);return s.group=[e],l.length>0&&s.group.push(i),u.length>0&&s.group.push(r),[new Ke.D(s,Fn)]},r.initialCount=Object(w.e)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,e.push(new Ke.w(r,Mn)),this.initModelData(e),e}},{key:"retrieveValueFromField",value:function(e){var t=Array.isArray(e)?e[0]:e;return t?t.value:void 0}}]),i}(k)).\u0275fac=function(e){return new(e||Un)(c["\u0275\u0275directiveInject"]($.a),c["\u0275\u0275directiveInject"](C.a),c["\u0275\u0275directiveInject"](An),c["\u0275\u0275directiveInject"](En),c["\u0275\u0275directiveInject"](V.a),c["\u0275\u0275directiveInject"](Ne.a),c["\u0275\u0275directiveInject"](E.a),c["\u0275\u0275directiveInject"](J.e),c["\u0275\u0275directiveInject"](pe.a),c["\u0275\u0275directiveInject"]("sectionDataProvider"),c["\u0275\u0275directiveInject"]("submissionIdProvider"))},Un.\u0275cmp=c["\u0275\u0275defineComponent"]({type:Un,selectors:[["ds-section-accesses"]],viewQuery:function(e,t){var n;1&e&&c["\u0275\u0275viewQuery"](_n,1),2&e&&c["\u0275\u0275queryRefresh"](n=c["\u0275\u0275loadQuery"]())&&(t.formRef=n.first)},features:[c["\u0275\u0275InheritDefinitionFeature"]],decls:2,vars:1,consts:[[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem"],["formRef","formComponent"]],template:function(e,t){1&e&&(c["\u0275\u0275template"](0,qn,2,4,"ds-form",0),c["\u0275\u0275text"](1,"\n")),2&e&&c["\u0275\u0275property"]("ngIf",!!t.formModel)},directives:[X.p,Y.a],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),Un=Object(b.b)([Object(L.a)(T.a.AccessesCondition)],Un)),Qn=r("VYMa"),Jn=[Ue,ee,Ye,In,Gn,ft],Xn=((Nn=function(){function e(){a(this,e)}return l(e,null,[{key:"withEntryComponents",value:function(){return{ngModule:e,providers:Jn.map((function(e){return{provide:e}}))}}}]),e}()).\u0275fac=function(e){return new(e||Nn)},Nn.\u0275mod=c["\u0275\u0275defineNgModule"]({type:Nn}),Nn.\u0275inj=c["\u0275\u0275defineInjector"]({providers:[xe,$.a,Me,An,En],imports:[[X.c,d.a.forRoot(),m.a,te.k.forFeature("submission",ie.a,Qt.d),ne.c.forFeature(ge),On.a.withEntryComponents(),jn.a.withEntryComponents(),Cn.a,ut.b,ut.r]]}),Nn);c["\u0275\u0275setComponentScope"](Ue,[Qn.a,X.p,jt,X.o,Gt],[J.d,X.b])},fBXw:function(e,t,n){"use strict";var i=n("TTdl");t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Object.create({});return e.forEach((function(e){Object(i.a)(e.paths).forEach((function(n){var i={path:n.originalPath,message:e.message};t[n.sectionId]||(t[n.sectionId]=[]),t[n.sectionId].push(i)}))})),t}},kcqd:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n("fXoL"),o=n("ofXK"),r=n("hqmO"),s=n("e+Av"),c=n("NvTF");function l(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-dynamic-form-control-container",1),i["\u0275\u0275listener"]("dfBlur",(function(e){i["\u0275\u0275restoreView"](n);var t=i["\u0275\u0275nextContext"]();return t.onCustomEvent(e,t.blur)}))("dfChange",(function(e){i["\u0275\u0275restoreView"](n);var t=i["\u0275\u0275nextContext"]();return t.onCustomEvent(e,t.change)}))("dfFocus",(function(e){i["\u0275\u0275restoreView"](n);var t=i["\u0275\u0275nextContext"]();return t.onCustomEvent(e,t.focus)}))("ngbEvent",(function(e){i["\u0275\u0275restoreView"](n);var t=i["\u0275\u0275nextContext"]();return t.onCustomEvent(e,t.ngbEvent)})),i["\u0275\u0275elementEnd"]()}if(2&e){var o=t.$implicit,r=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId",r.formId)("group",r.formGroup)("hasErrorMessaging",o.hasErrorMessages)("hidden",o.hidden)("layout",r.formLayout)("model",o)("templates",r.templates)("asBootstrapFormGroup",!0)}}var d,m=((d=function(e){u(n,e);var t=p(n);function n(e,o){var r;return a(this,n),(r=t.call(this,e,o)).blur=new i.EventEmitter,r.change=new i.EventEmitter,r.focus=new i.EventEmitter,r.ngbEvent=new i.EventEmitter,r}return n}(s.x)).\u0275fac=function(e){return new(e||d)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](s.y))},d.\u0275cmp=i["\u0275\u0275defineComponent"]({type:d,selectors:[["ds-dynamic-form"]],contentQueries:function(e,t,n){var o;1&e&&i["\u0275\u0275contentQuery"](n,s.O,0),2&e&&i["\u0275\u0275queryRefresh"](o=i["\u0275\u0275loadQuery"]())&&(t.templates=o)},viewQuery:function(e,t){var n;1&e&&i["\u0275\u0275viewQuery"](c.a,1),2&e&&i["\u0275\u0275queryRefresh"](n=i["\u0275\u0275loadQuery"]())&&(t.components=n)},inputs:{formId:"formId",formGroup:"formGroup",formModel:"formModel",formLayout:"formLayout"},outputs:{blur:"dfBlur",change:"dfChange",focus:"dfFocus",ngbEvent:"ngbEvent"},features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:2,vars:2,consts:[[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,l,1,8,"ds-dynamic-form-control-container",0),i["\u0275\u0275text"](1,"\n")),2&e&&i["\u0275\u0275property"]("ngForOf",t.formModel)("ngForTrackBy",t.trackByFn)},directives:[o.o,c.a],encapsulation:2}),d);n("ZO65"),n("0pnk"),n("sw+l"),n("1Pbu"),n("bPV6"),n("Gu/b"),n("A/iK"),n("KKO+"),n("Ysrn");var f,b=n("tqJZ"),v=n("ZTun"),h=(n("uyTL"),n("Ui2r"),n("8HnP"),n("zVKZ"),n("PCNd")),g=n("sYmb"),y=n("kMeL"),S=(n("yXJd"),n("/Vzl"),n("zGzN"),n("xjoE"),n("n7Wa")),x=n("3Pt+"),I=n("5+WD"),O=((f=function e(){a(this,e)}).\u0275fac=function(e){return new(e||f)},f.\u0275mod=i["\u0275\u0275defineNgModule"]({type:f}),f.\u0275inj=i["\u0275\u0275defineInjector"]({providers:[{provide:s.c,useValue:c.b}],imports:[[o.c,s.I,S.a,y.a,h.a,g.c]]}),f);i["\u0275\u0275setComponentScope"](b.a,[x.NgControlStatusGroup,x.FormGroupDirective,x.FormGroupName,o.m,o.o,c.a],[]),i["\u0275\u0275setComponentScope"](v.a,[x.NgControlStatusGroup,x.FormGroupDirective,x.FormArrayName,o.m,I.c,o.o,I.a,I.b,x.FormGroupName,o.t,c.a],[]),i["\u0275\u0275setComponentScope"](r.a,[x["\u0275angular_packages_forms_forms_ba"],x.NgControlStatusGroup,x.FormGroupDirective,m,s.O,o.p],[g.d,o.b])},m4Gq:function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));var i=n("fXoL"),o=n("LRne"),r=n("pLZG"),s=n("lJxs"),c=n("/uUt"),u=n("eIep"),d=n("J3qs"),p=n("ao5O"),m=n("4GeW"),f=n("Vurf"),b=n("uLZQ"),v=n("J/vq"),h=n("YJD6"),g=n("ofXK"),y=n("wQzj"),S=n("ph1m"),x=n("T/iP"),I=n("Frqi"),O=n("Yfyx"),j=n("yAsG");function C(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",12),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"ds-submission-upload-files",13),i["\u0275\u0275text"](3,"\n            "),i["\u0275\u0275element"](4,"div",14),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("submissionId",n.submissionId)("collectionId",n.collectionId)("uploadFilesOptions",n.uploadFilesOptions)}}function E(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",6),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275template"](2,C,6,3,"div",7),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n\n        "),i["\u0275\u0275elementStart"](5,"div",8),i["\u0275\u0275text"](6,"\n            "),i["\u0275\u0275elementStart"](7,"ds-submission-form-collection",9),i["\u0275\u0275listener"]("collectionChange",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().onCollectionChange(e)})),i["\u0275\u0275text"](8,"\n            "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n        "),i["\u0275\u0275elementStart"](11,"div",10),i["\u0275\u0275text"](12,"\n            "),i["\u0275\u0275elementStart"](13,"ds-submission-form-section-add",11),i["\u0275\u0275text"](14,"\n            "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](16,"\n    "),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](3,6,o.uploadEnabled$)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("currentCollectionId",o.collectionId)("currentDefinition",o.definitionId)("submissionId",o.submissionId),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("collectionId",o.collectionId)("submissionId",o.submissionId)}}function D(e,t){1&e&&i["\u0275\u0275element"](0,"ds-loading",15)}function w(e,t){if(1&e&&(i["\u0275\u0275elementContainerStart"](0),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"ds-submission-section-container",16),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit,o=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("collectionId",o.collectionId)("submissionId",o.submissionId)("sectionData",n)}}function k(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",17),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275element"](2,"ds-submission-form-footer",18),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("submissionId",n.submissionId)}}var F=function(){var e=function(){function e(t,n,i,r,s){a(this,e),this.authService=t,this.changeDetectorRef=n,this.halService=i,this.submissionService=r,this.sectionsService=s,this.loading=Object(o.a)(!0),this.uploadFilesOptions=new p.a,this.subs=[],this.isActive=!0}return l(e,[{key:"ngOnChanges",value:function(e){var t=this;e.collectionId&&this.collectionId&&e.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe(Object(r.a)((function(){return t.isActive})),Object(s.a)((function(e){return e.isLoading})),Object(s.a)((function(e){return e})),Object(c.a)(),Object(u.a)((function(e){return e?Object(o.a)([]):t.getSectionsList()}))),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,m.a.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe(Object(r.a)((function(){return t.isActive})),Object(s.a)((function(e){return e.isLoading})),Object(s.a)((function(e){return e})),Object(c.a)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe(Object(r.a)((function(e){return Object(d.e)(e)})),Object(c.a)()).subscribe((function(e){t.uploadFilesOptions.authToken=t.authService.buildAuthHeader(),t.uploadFilesOptions.url=e.concat("/".concat(t.submissionId)),t.definitionId=t.submissionDefinition.name,t.submissionService.dispatchInit(t.collectionId,t.submissionId,t.selfUrl,t.submissionDefinition,t.sections,t.item,t.submissionErrors),t.changeDetectorRef.detectChanges()}))),this.submissionService.startAutoSave(this.submissionId))}},{key:"ngOnDestroy",value:function(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter((function(e){return Object(d.b)(e)})).forEach((function(e){return e.unsubscribe()}))}},{key:"onCollectionChange",value:function(e){this.collectionId=e.collection.id,this.definitionId!==e.submissionDefinition.name?(this.sections=e.sections,this.submissionDefinition=e.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,e._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}},{key:"isLoading",value:function(){return this.loading}},{key:"getSectionsList",value:function(){return this.submissionService.getSubmissionSections(this.submissionId).pipe(Object(r.a)((function(e){return Object(d.e)(e)})),Object(s.a)((function(e){return e})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](f.a),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](b.a),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](h.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:18,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[3,"currentCollectionId","currentDefinition","submissionId","collectionChange"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,E,17,8,"div",1),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n\n    "),i["\u0275\u0275elementStart"](5,"div",2),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,D,1,0,"ds-loading",3),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275template"](10,w,4,3,"ng-container",4),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275text"](12,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n    "),i["\u0275\u0275template"](14,k,4,1,"div",5),i["\u0275\u0275pipe"](15,"async"),i["\u0275\u0275text"](16,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](17,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](3,4,t.isLoading())),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,6,t.isLoading())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngForOf",i["\u0275\u0275pipeBind1"](11,8,t.submissionSections)),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](15,10,t.isLoading())))},directives:[g.p,g.o,y.a,S.a,x.a,I.a,O.a,j.a],pipes:[g.b],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:hsla(0,0%,100%,.97);padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus.disabled[_ngcontent-%COMP%], .btn-link-focus[_ngcontent-%COMP%]:disabled{color:#6c757d;pointer-events:none}.btn-link-focus.focus[_ngcontent-%COMP%], .btn-link-focus[_ngcontent-%COMP%]:focus{text-decoration:underline}"]}),e}()},ph1m:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n("fXoL"),o=n("lJxs"),r=n("YJD6"),s=n("J/vq"),c=n("14tD"),u=n("1kSV"),d=n("ofXK"),p=n("sYmb");function m(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"button",7),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n      ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections.general.no-sections"),"\n    "))}function f(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",8),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](n);var e=t.$implicit;return i["\u0275\u0275nextContext"]().addSection(e.id)})),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){var o=t.$implicit;i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n      ",i["\u0275\u0275pipeBind1"](2,1,"submission.sections."+o.header),"\n    ")}}var b=function(e){return{"w-100":e}},v=function(){var e=function(){function e(t,n,i){a(this,e),this.sectionService=t,this.submissionService=n,this.windowService=i}return l(e,[{key:"ngOnInit",value:function(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe(Object(o.a)((function(e){return e.length>0})))}},{key:"addSection",value:function(e){this.sectionService.addSection(this.submissionId,e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.a),i["\u0275\u0275directiveInject"](s.a),i["\u0275\u0275directiveInject"](c.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},decls:22,vars:25,consts:[["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["sectionAdd","ngbDropdown"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"disabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0,1),i["\u0275\u0275text"](2,"\n  "),i["\u0275\u0275elementStart"](3,"button",2),i["\u0275\u0275pipe"](4,"async"),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275element"](8,"i",3),i["\u0275\u0275text"](9,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n  "),i["\u0275\u0275elementStart"](11,"div",4),i["\u0275\u0275pipe"](12,"async"),i["\u0275\u0275text"](13,"\n    "),i["\u0275\u0275template"](14,m,3,3,"button",5),i["\u0275\u0275pipe"](15,"async"),i["\u0275\u0275text"](16,"\n    "),i["\u0275\u0275template"](17,f,3,3,"button",6),i["\u0275\u0275pipe"](18,"async"),i["\u0275\u0275text"](19,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](21,"\n")),2&e&&(i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](19,b,t.windowService.isXs())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("disabled",!i["\u0275\u0275pipeBind1"](4,7,t.hasSections$))("ngClass",i["\u0275\u0275pureFunction1"](21,b,i["\u0275\u0275pipeBind1"](5,9,t.windowService.isXs()))),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"]("\n          ",i["\u0275\u0275pipeBind1"](7,11,"submission.sections.general.add-more")," "),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](23,b,i["\u0275\u0275pipeBind1"](12,13,t.windowService.isXs()))),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](15,15,t.hasSections$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngForOf",i["\u0275\u0275pipeBind1"](18,17,t.sectionList$)))},directives:[u.j,d.m,u.o,u.m,d.p,d.o],pipes:[d.b,p.d],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]}),e}()},qK5G:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("fXoL"),o=n("JTKQ");function r(e,t){}var s=function(){var e=function(e){u(i,e);var t=p(i);function i(){return a(this,i),t.apply(this,arguments)}return l(i,[{key:"getComponentName",value:function(){return"SubmissionImportExternalComponent"}},{key:"importThemedComponent",value:function(e){return n("JHLN")("./".concat(e,"/app/submission/import-external/submission-import-external.component"))}},{key:"importUnthemedComponent",value:function(){return Promise.resolve().then(n.bind(null,"RMpN"))}}]),i}(o.a);return e.\u0275fac=function(t){return c(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-themed-submission-import-external"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:3,vars:0,consts:[["vcr",""]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,r,0,0,"ng-template",null,0,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](2,"\n"))},encapsulation:2}),e}(),c=i["\u0275\u0275getInheritedFactory"](s)},wQzj:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n("fXoL"),o=n("2Vo4"),r=n("LRne"),s=n("cBqT"),c=n("lJxs"),u=n("5+tZ"),d=n("J3qs"),p=n("0VLH"),m=n("Oqsf"),f=n("1QIV"),b=n("4GeW"),v=n("DNva"),h=n("BVmw"),g=n("QjZv"),y=n("J/vq"),S=n("YJD6"),x=n("ofXK"),I=n("1kSV"),O=n("sYmb");function j(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275elementStart"](2,"div",3),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementStart"](4,"span",4),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementStart"](9,"div",5),i["\u0275\u0275text"](10,"\n      "),i["\u0275\u0275elementStart"](11,"span",4),i["\u0275\u0275text"](12),i["\u0275\u0275pipe"](13,"async"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n  "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"submission.sections.general.collection")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](13,4,n.selectedCollectionName$))}}function C(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275element"](1,"i",13),i["\u0275\u0275elementEnd"]())}function E(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,n.selectedCollectionName$))}}function D(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",6,7),i["\u0275\u0275listener"]("openChange",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().toggled(e)})),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"div",3),i["\u0275\u0275text"](4,"\n      "),i["\u0275\u0275elementStart"](5,"span",8),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](9,"\n    "),i["\u0275\u0275elementStart"](10,"button",9),i["\u0275\u0275listener"]("blur",(function(){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().onClose()}))("click",(function(){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().onClose()})),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275text"](12,"\n      "),i["\u0275\u0275template"](13,C,2,0,"span",10),i["\u0275\u0275pipe"](14,"async"),i["\u0275\u0275text"](15,"\n      "),i["\u0275\u0275template"](16,E,3,3,"span",10),i["\u0275\u0275pipe"](17,"async"),i["\u0275\u0275text"](18,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n\n    "),i["\u0275\u0275elementStart"](20,"div",11),i["\u0275\u0275text"](21,"\n      "),i["\u0275\u0275elementStart"](22,"ds-collection-dropdown",12),i["\u0275\u0275listener"]("selectionChange",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().onSelect(e)})),i["\u0275\u0275text"](23,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n  "),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"]("\n        ",i["\u0275\u0275pipeBind1"](7,4,"submission.sections.general.collection"),"\n      "),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](11,6,o.processingChange$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](14,8,o.processingChange$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](17,10,o.processingChange$))}}var w=function(){var e=function(){function e(t,n,r,s,c,l){a(this,e),this.cdr=t,this.collectionDataService=n,this.operationsBuilder=r,this.operationsService=s,this.submissionService=c,this.sectionsService=l,this.collectionChange=new i.EventEmitter,this.processingChange$=new o.a(!1),this.subs=[]}return l(e,[{key:"ngOnChanges",value:function(e){Object(d.b)(e.currentCollectionId)&&Object(d.b)(e.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe(Object(s.a)((function(e){return Object(d.e)(e.payload)})),Object(c.a)((function(e){return e.payload.name}))))}},{key:"ngOnInit",value:function(){this.pathCombiner=new p.a("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,b.a.collection)}},{key:"ngOnDestroy",value:function(){this.subs.filter((function(e){return Object(d.b)(e)})).forEach((function(e){return e.unsubscribe()}))}},{key:"onSelect",value:function(e){var t=this;this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),e.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe(Object(u.a)((function(e){return t.submissionService.retrieveSubmission(e[0].id).pipe(Object(f.j)())}))).subscribe((function(n){t.selectedCollectionId=e.collection.id,t.selectedCollectionName$=Object(r.a)(e.collection.name),t.collectionChange.emit(n),t.submissionService.changeSubmissionCollection(t.submissionId,e.collection.id),t.processingChange$.next(!1),t.cdr.detectChanges()})))}},{key:"onClose",value:function(){this.collectionDropdown.reset()}},{key:"toggled",value:function(e){e||this.collectionDropdown.reset()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](h.a),i["\u0275\u0275directiveInject"](g.a),i["\u0275\u0275directiveInject"](y.a),i["\u0275\u0275directiveInject"](S.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form-collection"]],viewQuery:function(e,t){var n;(1&e&&i["\u0275\u0275viewQuery"](m.a,1),2&e)&&(i["\u0275\u0275queryRefresh"](n=i["\u0275\u0275loadQuery"]())&&(t.collectionDropdown=n.first))},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",submissionId:"submissionId"},outputs:{collectionChange:"collectionChange"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:9,vars:6,consts:[["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["collectionControls","ngbDropdown"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"disabled","blur","click"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275template"](2,j,16,6,"div",0),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n  "),i["\u0275\u0275template"](5,D,26,12,"div",1),i["\u0275\u0275pipe"](6,"async"),i["\u0275\u0275text"](7,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n")),2&e&&(i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](3,2,t.available$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](6,4,t.available$)))},directives:[x.p,I.j,I.o,I.m,m.a],pipes:[x.b,O.d],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;left:0!important;-webkit-box-shadow:var(--bs-btn-focus-box-shadow);box-shadow:var(--bs-btn-focus-box-shadow)}"]}),e}()},yAsG:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var i=n("fXoL"),o=n("LRne"),r=n("lJxs"),s=n("drGc"),c=n("J3qs"),u=n("1kSV"),d=n("8nsN"),p=n("J/vq"),m=n("ofXK"),f=n("sYmb");function b(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",13),i["\u0275\u0275listener"]("click",(function(e){i["\u0275\u0275restoreView"](n);var t=i["\u0275\u0275nextContext"](2),o=i["\u0275\u0275reference"](3);return e.preventDefault(),t.confirmDiscard(o)})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275element"](4,"i",14),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"](2);i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](1,2,o.processingSaveStatus)||i["\u0275\u0275pipeBind1"](2,4,o.processingDepositStatus)),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](6,6,"submission.general.discard.submit"),"\n    ")}}function v(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"i",15),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](4,1,"submission.general.info.saved"),"\n    "))}function h(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"i",16),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](4,1,"submission.general.info.pending-changes"),"\n    "))}function g(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",20),i["\u0275\u0275text"](1,"Saving..."),i["\u0275\u0275elementEnd"]()),2&e&&i["\u0275\u0275styleProp"]("width","100%")}function y(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",20),i["\u0275\u0275text"](1,"Depositing..."),i["\u0275\u0275elementEnd"]()),2&e&&i["\u0275\u0275styleProp"]("width","100%")}function S(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",17),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275elementStart"](2,"div",18),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,g,2,2,"div",19),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,y,2,2,"div",19),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){var n=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](5,2,n.processingSaveStatus)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,4,n.processingDepositStatus))}}function x(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",21),i["\u0275\u0275listener"]("click",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"](2).deposit(e)})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"span"),i["\u0275\u0275element"](5,"i",22),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n      "),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"](2);i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](1,2,o.processingSaveStatus)||i["\u0275\u0275pipeBind1"](2,4,o.processingDepositStatus)),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](7,6,"submission.general.deposit"),"")}}function I(e,t){if(1&e){var n=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",3),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275template"](4,b,7,8,"button",4),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n  "),i["\u0275\u0275elementStart"](8,"div",5),i["\u0275\u0275text"](9,"\n    "),i["\u0275\u0275template"](10,v,5,3,"span",6),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275pipe"](12,"async"),i["\u0275\u0275pipe"](13,"async"),i["\u0275\u0275text"](14,"\n    "),i["\u0275\u0275template"](15,h,5,3,"span",6),i["\u0275\u0275pipe"](16,"async"),i["\u0275\u0275pipe"](17,"async"),i["\u0275\u0275pipe"](18,"async"),i["\u0275\u0275text"](19,"\n    "),i["\u0275\u0275template"](20,S,11,6,"div",7),i["\u0275\u0275pipe"](21,"async"),i["\u0275\u0275pipe"](22,"async"),i["\u0275\u0275text"](23,"\n    "),i["\u0275\u0275elementStart"](24,"div",8),i["\u0275\u0275text"](25,"\n      "),i["\u0275\u0275elementStart"](26,"button",9),i["\u0275\u0275listener"]("click",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().save(e)})),i["\u0275\u0275pipe"](27,"async"),i["\u0275\u0275pipe"](28,"async"),i["\u0275\u0275text"](29,"\n        "),i["\u0275\u0275elementStart"](30,"span"),i["\u0275\u0275element"](31,"i",10),i["\u0275\u0275text"](32),i["\u0275\u0275pipe"](33,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](34,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](35,"\n      "),i["\u0275\u0275elementStart"](36,"button",11),i["\u0275\u0275listener"]("click",(function(e){return i["\u0275\u0275restoreView"](n),i["\u0275\u0275nextContext"]().saveLater(e)})),i["\u0275\u0275pipe"](37,"async"),i["\u0275\u0275pipe"](38,"async"),i["\u0275\u0275pipe"](39,"async"),i["\u0275\u0275pipe"](40,"async"),i["\u0275\u0275text"](41,"\n        "),i["\u0275\u0275elementStart"](42,"span"),i["\u0275\u0275element"](43,"i",10),i["\u0275\u0275text"](44),i["\u0275\u0275pipe"](45,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](46,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](47,"\n      "),i["\u0275\u0275template"](48,x,9,8,"button",12),i["\u0275\u0275pipe"](49,"async"),i["\u0275\u0275text"](50,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](51,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](52,"\n"),i["\u0275\u0275elementEnd"]()}if(2&e){var o=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](5,13,o.showDepositAndDiscard)),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](11,15,o.hasUnsavedModification)&&!i["\u0275\u0275pipeBind1"](12,17,o.processingSaveStatus)&&!i["\u0275\u0275pipeBind1"](13,19,o.processingDepositStatus)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](16,21,o.hasUnsavedModification)&&!i["\u0275\u0275pipeBind1"](17,23,o.processingSaveStatus)&&!i["\u0275\u0275pipeBind1"](18,25,o.processingDepositStatus)),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](21,27,o.processingSaveStatus)||i["\u0275\u0275pipeBind1"](22,29,o.processingDepositStatus)),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](27,31,o.processingSaveStatus)||!i["\u0275\u0275pipeBind1"](28,33,o.hasUnsavedModification)),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](33,35,"submission.general.save"),""),i["\u0275\u0275advance"](4),i["\u0275\u0275classProp"]("btn-primary",!i["\u0275\u0275pipeBind1"](37,37,o.showDepositAndDiscard))("btn-secondary",i["\u0275\u0275pipeBind1"](38,39,o.showDepositAndDiscard)),i["\u0275\u0275property"]("disabled",i["\u0275\u0275pipeBind1"](39,41,o.processingSaveStatus)||i["\u0275\u0275pipeBind1"](40,43,o.processingDepositStatus)),i["\u0275\u0275advance"](8),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](45,45,"submission.general.save-later"),""),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](49,47,o.showDepositAndDiscard))}}function O(e,t){1&e&&(i["\u0275\u0275text"](0,"\n  "),i["\u0275\u0275elementStart"](1,"div",23),i["\u0275\u0275text"](2,"\n    "),i["\u0275\u0275elementStart"](3,"h4",24),i["\u0275\u0275text"](4),i["\u0275\u0275pipe"](5,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n    "),i["\u0275\u0275elementStart"](7,"button",25),i["\u0275\u0275listener"]("click",(function(){return(0,t.dismiss)("cancel")})),i["\u0275\u0275text"](8,"\n      "),i["\u0275\u0275elementStart"](9,"span",26),i["\u0275\u0275text"](10,"\xd7"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](12,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementStart"](14,"div",27),i["\u0275\u0275text"](15,"\n    "),i["\u0275\u0275elementStart"](16,"p"),i["\u0275\u0275text"](17),i["\u0275\u0275pipe"](18,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n  "),i["\u0275\u0275elementStart"](21,"div",28),i["\u0275\u0275text"](22,"\n    "),i["\u0275\u0275elementStart"](23,"button",29),i["\u0275\u0275listener"]("click",(function(){return(0,t.close)("cancel")})),i["\u0275\u0275text"](24),i["\u0275\u0275pipe"](25,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](26,"\n    "),i["\u0275\u0275elementStart"](27,"button",30),i["\u0275\u0275listener"]("click",(function(){return(0,t.close)("ok")})),i["\u0275\u0275text"](28),i["\u0275\u0275pipe"](29,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](30,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](31,"\n")),2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](5,4,"submission.general.discard.confirm.title")),i["\u0275\u0275advance"](13),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](18,6,"submission.general.discard.confirm.info")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](25,8,"submission.general.discard.confirm.cancel")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](29,10,"submission.general.discard.confirm.submit")))}var j=function(){var e=function(){function e(t,n,i){a(this,e),this.modalService=t,this.restService=n,this.submissionService=i,this.submissionIsInvalid=Object(o.a)(!0)}return l(e,[{key:"ngOnChanges",value:function(e){Object(c.e)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe(Object(r.a)((function(e){return!1===e}))),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=Object(o.a)(this.submissionService.getSubmissionScope()===s.a.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}},{key:"save",value:function(e){this.submissionService.dispatchSave(this.submissionId,!0)}},{key:"saveLater",value:function(e){this.submissionService.dispatchSaveForLater(this.submissionId)}},{key:"deposit",value:function(e){this.submissionService.dispatchDeposit(this.submissionId)}},{key:"confirmDiscard",value:function(e){var t=this;this.modalService.open(e).result.then((function(e){"ok"===e&&t.submissionService.dispatchDiscard(t.submissionId)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](u.q),i["\u0275\u0275directiveInject"](d.a),i["\u0275\u0275directiveInject"](p.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},features:[i["\u0275\u0275NgOnChangesFeature"]],decls:5,vars:1,consts:[["class","row",4,"ngIf"],["content",""],[1,"row"],[1,"col"],["type","button","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2"],["type","button","id","save",1,"btn","btn-secondary",3,"disabled","click"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"disabled","click"],["type","button","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,I,53,49,"div",0),i["\u0275\u0275text"](1,"\n\n"),i["\u0275\u0275template"](2,O,32,12,"ng-template",null,1,i["\u0275\u0275templateRefExtractor"]),i["\u0275\u0275text"](4,"\n")),2&e&&i["\u0275\u0275property"]("ngIf",!!t.submissionId)},directives:[m.p],pipes:[m.b,f.d],styles:[""]}),e}()}}])}();
//# sourceMappingURL=5-es5.bedd1e7b53419044710b.js.map