(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"6yod":function(e,t,n){"use strict";n.r(t),n.d(t,"EditCollectionPageModule",(function(){return ze}));var i=n("fXoL"),a=n("tfjI"),o=n("Obj/"),r=n("tyNb"),s=n("ofXK"),c=n("sYmb");const l=function(e){return{active:e}},d=function(e){return[e]};function p(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"li",13),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275elementStart"](2,"a",14),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n          "),i["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](5,l,e===n.currentPage))("routerLink",i["\u0275\u0275pureFunction1"](7,d,"./"+e)),i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate1"]("\n              ",i["\u0275\u0275pipeBind1"](4,3,n.type+".edit.tabs."+e+".head"),"\n            ")}}function u(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"a",15),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n              "),i["\u0275\u0275element"](3,"i",16),i["\u0275\u0275text"](4),i["\u0275\u0275pipe"](5,"translate"),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();let t=null;i["\u0275\u0275property"]("routerLink",e.getPageUrl(null==(t=i["\u0275\u0275pipeBind1"](1,2,e.dsoRD$))?null:t.payload)),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](5,4,e.type+".edit.return"),"\n            ")}}let m=(()=>{class e extends a.a{constructor(e,t){super(e,t),this.router=e,this.route=t,this.type="collection"}getPageUrl(e){return Object(o.j)(e.id)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.h),i["\u0275\u0275directiveInject"](r.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-edit-collection"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:47,vars:11,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom"],[1,"btn","btn-danger",3,"routerLink"],[1,"fas","fa-trash"],[1,"pt-2"],[1,"nav","nav-tabs","justify-content-start","mb-2"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"col-12","text-right"],["class","btn btn-outline-secondary",3,"routerLink",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"ngClass","routerLink"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"div",1),i["\u0275\u0275text"](3,"\n    "),i["\u0275\u0275elementStart"](4,"div",2),i["\u0275\u0275text"](5,"\n      "),i["\u0275\u0275elementStart"](6,"div",3),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementStart"](8,"h2"),i["\u0275\u0275text"](9),i["\u0275\u0275pipe"](10,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n        "),i["\u0275\u0275elementStart"](12,"div"),i["\u0275\u0275text"](13,"\n          "),i["\u0275\u0275elementStart"](14,"a",4),i["\u0275\u0275pipe"](15,"async"),i["\u0275\u0275text"](16,"\n            "),i["\u0275\u0275element"](17,"i",5),i["\u0275\u0275text"](18),i["\u0275\u0275pipe"](19,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](20,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](21,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](22,"\n      "),i["\u0275\u0275elementStart"](23,"div",6),i["\u0275\u0275text"](24,"\n        "),i["\u0275\u0275elementStart"](25,"ul",7),i["\u0275\u0275text"](26,"\n          "),i["\u0275\u0275template"](27,p,6,9,"li",8),i["\u0275\u0275text"](28,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](29,"\n        "),i["\u0275\u0275elementStart"](30,"div",9),i["\u0275\u0275text"](31,"\n          "),i["\u0275\u0275elementStart"](32,"div",10),i["\u0275\u0275text"](33,"\n            "),i["\u0275\u0275element"](34,"router-outlet"),i["\u0275\u0275text"](35,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](36,"\n          "),i["\u0275\u0275elementStart"](37,"div",11),i["\u0275\u0275text"](38,"\n            "),i["\u0275\u0275template"](39,u,6,6,"a",12),i["\u0275\u0275text"](40,"\n          "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](41,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](42,"\n      "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](43,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](44,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](45,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](46,"\n")),2&e){let e=null;i["\u0275\u0275advance"](9),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](10,5,t.type+".edit.head")),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("routerLink",("community"===t.type?"/communities/":"/collections/")+(null==(e=i["\u0275\u0275pipeBind1"](15,7,t.dsoRD$))?null:e.payload.uuid)+"/delete"),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind1"](19,9,t.type+".edit.delete"),""),i["\u0275\u0275advance"](9),i["\u0275\u0275property"]("ngForOf",t.pages),i["\u0275\u0275advance"](12),i["\u0275\u0275property"]("ngIf",!t.hideReturnButton)}},directives:[r.k,s.o,r.m,s.p,s.m],pipes:[c.d,s.b],encapsulation:2}),e})();var h=n("PCNd"),b=n("pBGb"),f=n("AqgH"),v=n("ye/0"),S=n("itXk"),x=n("PN+Z"),g=n("1QIV"),y=n("eIep"),I=n("vkgz"),j=n("DNva"),C=n("lP90"),E=n("lI3o"),O=n("mycY"),B=n("X/78"),T=n("O/5o"),w=n("+6qv");function k(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",7),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).addItemTemplate()})),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"i",8),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementStart"](4,"span",9),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementEnd"]()}2&e&&(i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](6,1,"collection.edit.template.add-button"),""))}function R(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",10),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).deleteItemTemplate()})),i["\u0275\u0275text"](1,"\n      "),i["\u0275\u0275element"](2,"i",11),i["\u0275\u0275text"](3,"\n      "),i["\u0275\u0275elementStart"](4,"span",9),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementEnd"]()}2&e&&(i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](6,1,"collection.edit.template.delete-button"),""))}function D(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"button",12),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n      "),i["\u0275\u0275element"](3,"i",13),i["\u0275\u0275text"](4,"\n      "),i["\u0275\u0275elementStart"](5,"span",9),i["\u0275\u0275text"](6),i["\u0275\u0275pipe"](7,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](8,"\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);let t=null;i["\u0275\u0275property"]("routerLink","/collections/"+(null==(t=i["\u0275\u0275pipeBind1"](1,2,e.dsoRD$))?null:t.payload.uuid)+"/itemtemplate"),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](7,4,"collection.edit.template.edit-button"),"")}}function $(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275elementStart"](2,"label"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n  "),i["\u0275\u0275elementStart"](6,"div",3),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275template"](8,k,8,3,"button",4),i["\u0275\u0275text"](9,"\n    "),i["\u0275\u0275template"](10,R,8,3,"button",5),i["\u0275\u0275text"](11,"\n    "),i["\u0275\u0275template"](12,D,9,6,"button",6),i["\u0275\u0275text"](13,"\n  "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n"),i["\u0275\u0275elementEnd"]()),2&e){const e=t.ngVar;i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,4,"collection.edit.template.label")),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",!(null!=e&&e.payload)),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",null==e?null:e.payload),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",null==e?null:e.payload)}}let F=(()=>{class e extends f.a{constructor(e,t,n,i,a,o,r,s){super(e,n,i,a,o),this.collectionDataService=e,this.itemTemplateService=t,this.router=n,this.route=i,this.notificationsService=a,this.translate=o,this.objectCache=r,this.requestService=s,this.frontendURL="/collections/",this.type=v.a.type}ngOnInit(){super.ngOnInit(),this.initTemplateItem()}initTemplateItem(){this.itemTemplateRD$=this.dsoRD$.pipe(Object(g.j)(),Object(y.a)(e=>this.itemTemplateService.findByCollectionID(e.uuid)))}addItemTemplate(){const e=this.dsoRD$.pipe(Object(g.j)()),t=e.pipe(Object(y.a)(e=>this.itemTemplateService.create(new x.a,e.uuid).pipe(Object(g.j)()))),n=e.pipe(Object(y.a)(e=>this.itemTemplateService.getCollectionEndpoint(e.id)));Object(S.a)(e,t,n).subscribe(([e,t,n])=>{this.requestService.setStaleByHrefSubstring(n),this.router.navigate([Object(o.i)(e.uuid)])})}deleteItemTemplate(){const e=this.dsoRD$.pipe(Object(g.j)()),t=e.pipe(Object(y.a)(e=>this.itemTemplateService.findByCollectionID(e.uuid).pipe(Object(g.j)()))),n=e.pipe(Object(y.a)(e=>this.itemTemplateService.getCollectionEndpoint(e.id)));Object(S.a)(e,t,n).pipe(Object(y.a)(([e,t,n])=>this.itemTemplateService.deleteByCollectionID(t,e.uuid).pipe(Object(I.a)(i=>{i&&(this.objectCache.remove(n),this.objectCache.remove(t.self),this.requestService.setStaleByHrefSubstring(t.self),this.requestService.setStaleByHrefSubstring(n),this.requestService.setStaleByHrefSubstring(e.self))})))).subscribe(e=>{e?this.notificationsService.success(null,this.translate.get("collection.edit.template.notifications.delete.success")):this.notificationsService.error(null,this.translate.get("collection.edit.template.notifications.delete.error")),this.initTemplateItem()})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](j.a),i["\u0275\u0275directiveInject"](C.a),i["\u0275\u0275directiveInject"](r.h),i["\u0275\u0275directiveInject"](r.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](c.e),i["\u0275\u0275directiveInject"](O.a),i["\u0275\u0275directiveInject"](B.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-collection-metadata"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:6,vars:6,consts:[["class","container-fluid mb-2",4,"ngVar"],[3,"dso","submitForm","back","finish"],[1,"container-fluid","mb-2"],[1,"button-row"],["class","btn btn-success",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],["class","btn btn-primary",3,"routerLink",4,"ngIf"],[1,"btn","btn-success",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-trash-alt"],[1,"btn","btn-primary",3,"routerLink"],[1,"fas","fa-edit"]],template:function(e,t){if(1&e&&(i["\u0275\u0275template"](0,$,15,6,"div",0),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n"),i["\u0275\u0275elementStart"](3,"ds-collection-form",1),i["\u0275\u0275listener"]("submitForm",(function(e){return t.onSubmit(e)}))("back",(function(){return t.navigateToHomePage()}))("finish",(function(){return t.navigateToHomePage()})),i["\u0275\u0275pipe"](4,"async"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n")),2&e){let e=null;i["\u0275\u0275property"]("ngVar",i["\u0275\u0275pipeBind1"](1,2,t.itemTemplateRD$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("dso",null==(e=i["\u0275\u0275pipeBind1"](4,4,t.dsoRD$))?null:e.payload)}},directives:[T.a,w.a,s.p,r.i],pipes:[s.b,c.d],encapsulation:2}),e})();var M=n("SxV6"),V=n("lJxs"),L=n("0EDX");function N(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"ds-comcol-role",1),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n"),i["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("dso",i["\u0275\u0275pipeBind1"](1,2,n.collection$))("comcolRole",e)}}let H=(()=>{class e{constructor(e){this.route=e}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe(Object(M.a)(),Object(V.a)(e=>e.dso)),this.collection$=this.dsoRD$.pipe(Object(g.i)(),Object(g.o)()),this.comcolRoles$=this.collection$.pipe(Object(V.a)(e=>[{name:"collection-admin",href:e._links.adminGroup.href},{name:"submitters",href:e._links.submittersGroup.href},{name:"item_read",href:e._links.itemReadGroup.href},{name:"bitstream_read",href:e._links.bitstreamReadGroup.href},...e._links.workflowGroups]))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-collection-roles"]],decls:3,vars:3,consts:[[3,"dso","comcolRole",4,"ngFor","ngForOf"],[3,"dso","comcolRole"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,N,3,4,"ds-comcol-role",0),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2,"\n")),2&e&&i["\u0275\u0275property"]("ngForOf",i["\u0275\u0275pipeBind1"](1,1,t.comcolRoles$))},directives:[s.o,L.a],pipes:[s.b],encapsulation:2}),e})();var P=n("daFX"),_=n("e+Av"),q=n("J3qs"),A=n("q7s5"),G=n("IzEk"),U=n("LvDl"),z=n("AytR"),X=n("loKC"),Y=n("pLZG"),K=n("AQcY"),J=n("2Vo4"),Q=n("RZ9z"),Z=n("TtJg"),W=n("NqqP"),ee=n("tk/3"),te=n("PCBh");function ne(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",8),i["\u0275\u0275listener"]("click",(function(){i["\u0275\u0275restoreView"](e);const t=i["\u0275\u0275nextContext"](2).ngVar;return i["\u0275\u0275nextContext"]().testConfiguration(t)})),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275elementStart"](2,"span"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("disabled",!e.isEnabled),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,2,"collection.source.controls.test.submit"))}}function ie(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"button",9),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"span",10),i["\u0275\u0275text"](3,"\n            "),i["\u0275\u0275elementStart"](4,"span"),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275property"]("disabled",!0),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"collection.source.controls.test.running")))}function ae(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",11),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](3).importNow()})),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275elementStart"](2,"span",12),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("disabled",!e.isEnabled),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,2,"collection.source.controls.import.submit"))}}function oe(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"button",13),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"span",10),i["\u0275\u0275text"](3,"\n            "),i["\u0275\u0275elementStart"](4,"span",12),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275property"]("disabled",!0),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"collection.source.controls.import.running")))}function re(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",11),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](3).resetAndReimport()})),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275elementStart"](2,"span",12),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("disabled",!e.isEnabled),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](4,2,"collection.source.controls.reset.submit"),"")}}function se(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"button",13),i["\u0275\u0275text"](1,"\n            "),i["\u0275\u0275element"](2,"span",10),i["\u0275\u0275text"](3,"\n            "),i["\u0275\u0275elementStart"](4,"span",12),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275property"]("disabled",!0),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](6,2,"collection.source.controls.reset.running"),""))}function ce(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275elementStart"](2,"h4"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n        "),i["\u0275\u0275elementStart"](6,"div"),i["\u0275\u0275text"](7,"\n            "),i["\u0275\u0275elementStart"](8,"span",3),i["\u0275\u0275text"](9),i["\u0275\u0275pipe"](10,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](11,"\n            "),i["\u0275\u0275elementStart"](12,"span"),i["\u0275\u0275text"](13),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](14,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](15,"\n        "),i["\u0275\u0275elementStart"](16,"div"),i["\u0275\u0275text"](17,"\n            "),i["\u0275\u0275elementStart"](18,"span",3),i["\u0275\u0275text"](19),i["\u0275\u0275pipe"](20,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](21,"\n            "),i["\u0275\u0275elementStart"](22,"span"),i["\u0275\u0275text"](23),i["\u0275\u0275pipe"](24,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](26,"\n        "),i["\u0275\u0275elementStart"](27,"div"),i["\u0275\u0275text"](28,"\n            "),i["\u0275\u0275elementStart"](29,"span",3),i["\u0275\u0275text"](30),i["\u0275\u0275pipe"](31,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](32,"\n            "),i["\u0275\u0275elementStart"](33,"span"),i["\u0275\u0275text"](34),i["\u0275\u0275pipe"](35,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](36,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](37,"\n        "),i["\u0275\u0275elementStart"](38,"div"),i["\u0275\u0275text"](39,"\n            "),i["\u0275\u0275elementStart"](40,"span",3),i["\u0275\u0275text"](41),i["\u0275\u0275pipe"](42,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](43,"\n            "),i["\u0275\u0275elementStart"](44,"span"),i["\u0275\u0275text"](45),i["\u0275\u0275pipe"](46,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](47,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](48,"\n\n        "),i["\u0275\u0275template"](49,ne,6,4,"button",4),i["\u0275\u0275pipe"](50,"async"),i["\u0275\u0275text"](51,"\n        "),i["\u0275\u0275template"](52,ie,8,4,"button",5),i["\u0275\u0275pipe"](53,"async"),i["\u0275\u0275text"](54,"\n        "),i["\u0275\u0275template"](55,ae,6,4,"button",6),i["\u0275\u0275pipe"](56,"async"),i["\u0275\u0275text"](57,"\n        "),i["\u0275\u0275template"](58,oe,8,4,"button",7),i["\u0275\u0275pipe"](59,"async"),i["\u0275\u0275text"](60,"\n        "),i["\u0275\u0275template"](61,re,6,4,"button",6),i["\u0275\u0275pipe"](62,"async"),i["\u0275\u0275text"](63,"\n        "),i["\u0275\u0275template"](64,se,8,4,"button",7),i["\u0275\u0275pipe"](65,"async"),i["\u0275\u0275text"](66,"\n\n\n    "),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]().ngVar,t=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](4,15,"collection.source.controls.head")),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](10,17,"collection.source.controls.harvest.status")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](null==e?null:e.harvestStatus),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](20,19,"collection.source.controls.harvest.start")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](null!=e&&e.harvestStartTime?null==e?null:e.harvestStartTime:i["\u0275\u0275pipeBind1"](24,21,"collection.source.controls.harvest.no-information")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](31,23,"collection.source.controls.harvest.last")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](null!=e&&e.message?null==e?null:e.message:i["\u0275\u0275pipeBind1"](35,25,"collection.source.controls.harvest.no-information")),i["\u0275\u0275advance"](7),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](42,27,"collection.source.controls.harvest.message")),i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate"](null!=e&&e.lastHarvested?null==e?null:e.lastHarvested:i["\u0275\u0275pipeBind1"](46,29,"collection.source.controls.harvest.no-information")),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](50,31,t.testConfigRunning$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](53,33,t.testConfigRunning$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](56,35,t.importRunning$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](59,37,t.importRunning$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](62,39,t.reImportRunning$)),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](65,41,t.reImportRunning$))}}function le(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275template"](2,ce,67,43,"div",1),i["\u0275\u0275text"](3,"\n"),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e.shouldShow)}}let de=(()=>{class e{constructor(e,t,n,i,a,o,r,s){this.scriptDataService=e,this.processDataService=t,this.requestService=n,this.notificationsService=i,this.collectionService=a,this.translateService=o,this.httpClient=r,this.bitstreamService=s,this.subs=[],this.testConfigRunning$=new J.a(!1),this.importRunning$=new J.a(!1),this.reImportRunning$=new J.a(!1)}ngOnInit(){this.contentSource$=this.collectionService.findByHref(this.collection._links.self.href,!1).pipe(Object(g.d)(),Object(y.a)(e=>this.collectionService.getContentSource(e.uuid,!1)),Object(g.d)())}testConfiguration(e){this.testConfigRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-g",value:null},{name:"-a",value:e.oaiSource},{name:"-i",value:(new Q.a).Serialize(e.oaiSetId)}],[]).pipe(Object(g.g)(),Object(I.a)(e=>{e.hasFailed&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.submit.error")),this.testConfigRunning$.next(!1))}),Object(Y.a)(e=>e.hasSucceeded&&Object(q.b)(e.payload)),Object(y.a)(e=>this.processDataService.findById(e.payload.processId,!1)),Object(g.b)(),Object(Y.a)(e=>!e.isStale&&(e.hasSucceeded||e.hasFailed)),Object(V.a)(e=>e.payload),Object(q.c)()).subscribe(e=>{e.processStatus.toString()!==K.a[K.a.COMPLETED].toString()&&e.processStatus.toString()!==K.a[K.a.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(e._links.self.href)},5e3),e.processStatus.toString()===K.a[K.a.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.failed")),this.testConfigRunning$.next(!1)),e.processStatus.toString()===K.a[K.a.COMPLETED].toString()&&(this.bitstreamService.findByHref(e._links.output.href).pipe(Object(g.j)()).subscribe(e=>{this.httpClient.get(e._links.content.href,{responseType:"text"}).subscribe(e=>{const t=e.replaceAll(new RegExp(".*\\@(.*)","g"),"$1").replaceAll("The script has started","").replaceAll("The script has completed","");this.notificationsService.info(this.translateService.get("collection.source.controls.test.completed"),t)})}),this.testConfigRunning$.next(!1))}))}importNow(){this.importRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-r",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe(Object(g.g)(),Object(I.a)(e=>{e.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.import.submit.error")),this.importRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.import.submit.success"))}),Object(Y.a)(e=>e.hasSucceeded&&Object(q.b)(e.payload)),Object(y.a)(e=>this.processDataService.findById(e.payload.processId,!1)),Object(g.b)(),Object(Y.a)(e=>!e.isStale&&(e.hasSucceeded||e.hasFailed)),Object(V.a)(e=>e.payload),Object(q.c)()).subscribe(e=>{e.processStatus.toString()!==K.a[K.a.COMPLETED].toString()&&e.processStatus.toString()!==K.a[K.a.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(e._links.self.href),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href)},5e3),e.processStatus.toString()===K.a[K.a.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.import.failed")),this.importRunning$.next(!1)),e.processStatus.toString()===K.a[K.a.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.import.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.importRunning$.next(!1))}))}resetAndReimport(){this.reImportRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-o",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe(Object(g.g)(),Object(I.a)(e=>{e.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.submit.error")),this.reImportRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.reset.submit.success"))}),Object(Y.a)(e=>e.hasSucceeded&&Object(q.b)(e.payload)),Object(y.a)(e=>this.processDataService.findById(e.payload.processId,!1)),Object(g.b)(),Object(Y.a)(e=>!e.isStale&&(e.hasSucceeded||e.hasFailed)),Object(V.a)(e=>e.payload),Object(q.c)()).subscribe(e=>{e.processStatus.toString()!==K.a[K.a.COMPLETED].toString()&&e.processStatus.toString()!==K.a[K.a.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(e._links.self.href),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href)},5e3),e.processStatus.toString()===K.a[K.a.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.failed")),this.reImportRunning$.next(!1)),e.processStatus.toString()===K.a[K.a.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.reset.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.reImportRunning$.next(!1))}))}ngOnDestroy(){this.subs.forEach(e=>{Object(q.b)(e)&&e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](Z.c),i["\u0275\u0275directiveInject"](W.a),i["\u0275\u0275directiveInject"](B.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](j.a),i["\u0275\u0275directiveInject"](c.e),i["\u0275\u0275directiveInject"](ee.b),i["\u0275\u0275directiveInject"](te.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-collection-source-controls"]],inputs:{isEnabled:"isEnabled",collection:"collection",shouldShow:"shouldShow"},decls:2,vars:3,consts:[[4,"ngVar"],["class","container-fluid",4,"ngIf"],[1,"container-fluid"],[1,"font-weight-bold"],["class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["class","btn btn-secondary",3,"disabled",4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"disabled",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"btn","btn-secondary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","spinner-button"],[1,"btn","btn-primary",3,"disabled","click"],[1,"d-none","d-sm-inline"],[1,"btn","btn-primary",3,"disabled"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,le,4,1,"div",0),i["\u0275\u0275pipe"](1,"async")),2&e&&i["\u0275\u0275property"]("ngVar",i["\u0275\u0275pipeBind1"](1,1,t.contentSource$))},directives:[T.a,s.p],pipes:[s.b,c.d],styles:[".spinner-button[_ngcontent-%COMP%]{margin-bottom:calc((var(--bs-line-height-base) * 1rem - var(--bs-font-size-base)) / 2)}"]}),e})();var pe=n("Frqi"),ue=n("hqmO"),me=n("3Pt+");function he(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",14),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().discard()})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275element"](2,"i",15),i["\u0275\u0275text"](3,"\n            "),i["\u0275\u0275elementStart"](4,"span",6),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n        "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("disabled",!i["\u0275\u0275pipeBind1"](1,2,e.hasChanges())),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](6,4,"item.edit.metadata.discard-button"),"")}}function be(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",16),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().reinstate()})),i["\u0275\u0275element"](1,"i",17),i["\u0275\u0275text"](2,"\n            "),i["\u0275\u0275elementStart"](3,"span",6),i["\u0275\u0275text"](4),i["\u0275\u0275pipe"](5,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275elementEnd"]()}2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](5,1,"item.edit.metadata.reinstate-button"),""))}function fe(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",18),i["\u0275\u0275text"](1,"\n        "),i["\u0275\u0275elementStart"](2,"input",19),i["\u0275\u0275listener"]("change",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().changeExternalSource()})),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"label",20),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n    "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("checked",(null==e.contentSource?null:e.contentSource.harvestType)!==e.harvestTypeNone),i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](6,2,"collection.edit.tabs.source.external"))}}function ve(e,t){1&e&&(i["\u0275\u0275element"](0,"ds-loading",21),i["\u0275\u0275pipe"](1,"translate")),2&e&&i["\u0275\u0275property"]("message",i["\u0275\u0275pipeBind1"](1,1,"loading.content-source"))}function Se(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"h4"),i["\u0275\u0275text"](1),i["\u0275\u0275pipe"](2,"translate"),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](1),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](2,1,"collection.edit.tabs.source.form.head")))}function xe(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"ds-form",22),i["\u0275\u0275listener"]("dfChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onChange(t)}))("submitForm",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onSubmit()}))("cancel",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onCancel()})),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("formId","collection-source-form-id")("formGroup",e.formGroup)("formModel",e.formModel)("formLayout",e.formLayout)("displaySubmit",!1)("displayCancel",!1)}}function ge(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",14),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).discard()})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275element"](2,"i",15),i["\u0275\u0275text"](3,"\n                    "),i["\u0275\u0275elementStart"](4,"span",6),i["\u0275\u0275text"](5),i["\u0275\u0275pipe"](6,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](7,"\n                "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275property"]("disabled",!i["\u0275\u0275pipeBind1"](1,2,e.hasChanges())),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](6,4,"item.edit.metadata.discard-button"),"")}}function ye(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"button",16),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](2).reinstate()})),i["\u0275\u0275element"](1,"i",17),i["\u0275\u0275text"](2,"\n                    "),i["\u0275\u0275elementStart"](3,"span",6),i["\u0275\u0275text"](4),i["\u0275\u0275pipe"](5,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n                "),i["\u0275\u0275elementEnd"]()}2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](5,1,"item.edit.metadata.reinstate-button"),""))}function Ie(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",23),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275elementStart"](2,"div",10),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275elementStart"](4,"div",24),i["\u0275\u0275text"](5,"\n            "),i["\u0275\u0275elementStart"](6,"div",25),i["\u0275\u0275text"](7,"\n                "),i["\u0275\u0275template"](8,ge,8,6,"button",2),i["\u0275\u0275pipe"](9,"async"),i["\u0275\u0275text"](10,"\n                "),i["\u0275\u0275template"](11,ye,7,3,"button",3),i["\u0275\u0275pipe"](12,"async"),i["\u0275\u0275text"](13,"\n                "),i["\u0275\u0275elementStart"](14,"button",4),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onSubmit()})),i["\u0275\u0275pipe"](15,"async"),i["\u0275\u0275element"](16,"i",5),i["\u0275\u0275text"](17,"\n                    "),i["\u0275\u0275elementStart"](18,"span",6),i["\u0275\u0275text"](19),i["\u0275\u0275pipe"](20,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](21,"\n                "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](22,"\n            "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](23,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](24,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](25,"\n"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](8),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](9,4,e.isReinstatable())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](12,6,e.isReinstatable())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("disabled",!i["\u0275\u0275pipeBind1"](15,8,e.hasChanges())||!e.isValid()||e.initialHarvestType===e.harvestTypeNone&&e.contentSource.harvestType===e.initialHarvestType),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](20,10,"item.edit.metadata.save-button"),"")}}let je=(()=>{class e extends P.a{constructor(e,t,n,i,a,o,r,s,c){super(e,t,a),this.objectUpdatesService=e,this.notificationsService=t,this.location=n,this.formService=i,this.translate=a,this.route=o,this.router=r,this.collectionService=s,this.requestService=c,this.LABEL_KEY_PREFIX="collection.edit.tabs.source.form.",this.ERROR_KEY_PREFIX="collection.edit.tabs.source.form.errors.",this.OPTIONS_KEY_PREFIX="collection.edit.tabs.source.form.options.",this.oaiSourceModel=new _.J({id:"oaiSource",name:"oaiSource",required:!0,validators:{required:null},errorMessages:{required:"You must provide a set id of the target collection."}}),this.oaiSetIdModel=new _.J({id:"oaiSetId",name:"oaiSetId"}),this.metadataConfigIdModel=new _.N({id:"metadataConfigId",name:"metadataConfigId"}),this.harvestTypeModel=new _.M({id:"harvestType",name:"harvestType",options:[{value:A.b.Metadata},{value:A.b.MetadataAndRef},{value:A.b.MetadataAndBitstreams}]}),this.inputModels=[this.oaiSourceModel,this.oaiSetIdModel,this.metadataConfigIdModel,this.harvestTypeModel],this.formModel=[new _.D({id:"oaiSourceContainer",group:[this.oaiSourceModel]}),new _.D({id:"oaiSetContainer",group:[this.oaiSetIdModel,this.metadataConfigIdModel]}),new _.D({id:"harvestTypeContainer",group:[this.harvestTypeModel]})],this.formLayout={oaiSource:{grid:{host:"col-12 d-inline-block"}},oaiSetId:{grid:{host:"col col-sm-6 d-inline-block"}},metadataConfigId:{grid:{host:"col col-sm-6 d-inline-block"}},harvestType:{grid:{host:"col-12",option:"btn-outline-secondary"}},oaiSetContainer:{grid:{host:"row"}},oaiSourceContainer:{grid:{host:"row"}},harvestTypeContainer:{grid:{host:"row"}}},this.harvestTypeNone=A.b.None,this.previouslySelectedHarvestType=A.b.Metadata,this.displayedNotifications=[]}ngOnInit(){this.notificationsPrefix="collection.edit.tabs.source.notifications.",this.discardTimeOut=z.a.collection.edit.undoTimeout,this.url=this.router.url,this.url.indexOf("?")>0&&(this.url=this.url.substr(0,this.url.indexOf("?"))),this.formGroup=this.formService.createFormGroup(this.formModel),this.collectionRD$=this.route.parent.data.pipe(Object(M.a)(),Object(V.a)(e=>e.dso)),this.collectionRD$.pipe(Object(g.i)(),Object(V.a)(e=>e.payload.uuid),Object(y.a)(e=>this.collectionService.getContentSource(e)),Object(g.g)()).subscribe(e=>{this.initializeOriginalContentSource(e.payload)}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}initializeOriginalContentSource(e){this.contentSource=e,this.initialHarvestType=e.harvestType,this.initializeMetadataConfigs();const t=Object(U.cloneDeep)(this.contentSource);this.objectUpdatesService.initialize(this.url,[t],new Date),this.update$=this.objectUpdatesService.getFieldUpdates(this.url,[t]).pipe(Object(V.a)(e=>e[t.uuid])),this.updateSub=this.update$.subscribe(e=>{if(e){const t=e.field;let n;Object(q.b)(this.contentSource)&&Object(q.e)(this.contentSource.metadataConfigs)&&(n=this.contentSource.metadataConfigs[0].id),Object(q.b)(t)&&Object(q.b)(t.metadataConfigId)&&(n=t.metadataConfigId),Object(q.b)(t)&&(this.formGroup.patchValue({oaiSourceContainer:{oaiSource:t.oaiSource},oaiSetContainer:{oaiSetId:t.oaiSetId,metadataConfigId:n},harvestTypeContainer:{harvestType:t.harvestType}}),this.contentSource=Object(U.cloneDeep)(t)),this.contentSource.metadataConfigId=n}})}initializeMetadataConfigs(){this.metadataConfigIdModel.options=this.contentSource.metadataConfigs.map(e=>Object.assign({value:e.id,label:e.label})),this.metadataConfigIdModel.options.length>0&&this.formGroup.patchValue({oaiSetContainer:{metadataConfigId:this.metadataConfigIdModel.options[0].value}})}updateFieldTranslations(){this.inputModels.forEach(e=>{this.updateFieldTranslation(e)})}updateFieldTranslation(e){e.label=this.translate.instant(this.LABEL_KEY_PREFIX+e.id),Object(q.e)(e.validators)&&(e.errorMessages={},Object.keys(e.validators).forEach(t=>{e.errorMessages[t]=this.translate.instant(this.ERROR_KEY_PREFIX+e.id+"."+t)})),e instanceof _.L&&Object(q.e)(e.options)&&e.options.forEach(t=>{Object(q.a)(t.label)&&(t.label=this.translate.instant(this.OPTIONS_KEY_PREFIX+e.id+"."+t.value))})}onChange(e){this.updateContentSourceField(e.model,!0),this.saveFieldUpdate()}onSubmit(){this.collectionRD$.pipe(Object(g.i)(),Object(V.a)(e=>e.payload.uuid),Object(y.a)(e=>this.collectionService.getHarvesterEndpoint(e)),Object(G.a)(1)).subscribe(e=>this.requestService.removeByHrefSubstring(e)),this.requestService.setStaleByHrefSubstring(this.contentSource._links.self.href),this.collectionRD$.pipe(Object(g.i)(),Object(V.a)(e=>e.payload.uuid),Object(y.a)(e=>this.collectionService.updateContentSource(e,this.contentSource)),Object(G.a)(1)).subscribe(e=>{Object(q.b)(e.harvestType)?(this.clearNotifications(),this.initializeOriginalContentSource(e),this.displayedNotifications.push(this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))):this.displayedNotifications.push(e)})}onCancel(){this.location.back()}isValid(){return this.contentSource.harvestType===A.b.None||this.formGroup.valid}changeExternalSource(){this.contentSource.harvestType===A.b.None?this.contentSource.harvestType=this.previouslySelectedHarvestType:(this.previouslySelectedHarvestType=this.contentSource.harvestType,this.contentSource.harvestType=A.b.None),this.updateContentSource(!1)}updateContentSource(e){this.inputModels.forEach(t=>{this.updateContentSourceField(t,e)}),this.saveFieldUpdate()}updateContentSourceField(e,t){Object(q.b)(e.value)&&(e.id!==this.harvestTypeModel.id||t)&&(this.contentSource[e.id]=e.value)}saveFieldUpdate(){this.objectUpdatesService.saveAddFieldUpdate(this.url,Object(U.cloneDeep)(this.contentSource))}clearNotifications(){this.displayedNotifications.forEach(e=>{this.notificationsService.remove(e)}),this.displayedNotifications=[]}ngOnDestroy(){this.updateSub&&this.updateSub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](X.a),i["\u0275\u0275directiveInject"](E.a),i["\u0275\u0275directiveInject"](s.k),i["\u0275\u0275directiveInject"](_.G),i["\u0275\u0275directiveInject"](c.e),i["\u0275\u0275directiveInject"](r.a),i["\u0275\u0275directiveInject"](r.h),i["\u0275\u0275directiveInject"](j.a),i["\u0275\u0275directiveInject"](B.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-collection-source"]],features:[i["\u0275\u0275InheritDefinitionFeature"]],decls:43,vars:27,consts:[[1,"container-fluid"],[1,"d-inline-block","float-right"],["class"," btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],["class","form-check mb-4",4,"ngIf"],[3,"message",4,"ngIf"],[4,"ngIf"],[1,"row"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel",4,"ngIf"],["class","container mt-2",4,"ngIf"],[3,"isEnabled","shouldShow","collection"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"form-check","mb-4"],["type","checkbox","id","externalSourceCheck",1,"form-check-input",3,"checked","change"],["for","externalSourceCheck",1,"form-check-label"],[3,"message"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel"],[1,"container","mt-2"],[1,"col-12"],[1,"d-inline-block","float-right","ml-1"]],template:function(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275elementStart"](2,"div",1),i["\u0275\u0275text"](3,"\n        "),i["\u0275\u0275template"](4,he,8,6,"button",2),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275text"](6,"\n        "),i["\u0275\u0275template"](7,be,7,3,"button",3),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n        "),i["\u0275\u0275elementStart"](10,"button",4),i["\u0275\u0275listener"]("click",(function(){return t.onSubmit()})),i["\u0275\u0275pipe"](11,"async"),i["\u0275\u0275element"](12,"i",5),i["\u0275\u0275text"](13,"\n            "),i["\u0275\u0275elementStart"](14,"span",6),i["\u0275\u0275text"](15),i["\u0275\u0275pipe"](16,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](17,"\n        "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](18,"\n    "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](19,"\n    "),i["\u0275\u0275elementStart"](20,"h4"),i["\u0275\u0275text"](21),i["\u0275\u0275pipe"](22,"translate"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](23,"\n    "),i["\u0275\u0275template"](24,fe,8,4,"div",7),i["\u0275\u0275text"](25,"\n    "),i["\u0275\u0275template"](26,ve,2,3,"ds-loading",8),i["\u0275\u0275text"](27,"\n    "),i["\u0275\u0275template"](28,Se,3,3,"h4",9),i["\u0275\u0275text"](29,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](30,"\n"),i["\u0275\u0275elementStart"](31,"div",10),i["\u0275\u0275text"](32,"\n    "),i["\u0275\u0275template"](33,xe,1,6,"ds-form",11),i["\u0275\u0275text"](34,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](35,"\n"),i["\u0275\u0275template"](36,Ie,26,12,"div",12),i["\u0275\u0275text"](37,"\n"),i["\u0275\u0275elementStart"](38,"ds-collection-source-controls",13),i["\u0275\u0275pipe"](39,"async"),i["\u0275\u0275pipe"](40,"async"),i["\u0275\u0275text"](41,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](42,"\n\n")),2&e){let e=null;i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",!i["\u0275\u0275pipeBind1"](5,13,t.isReinstatable())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",i["\u0275\u0275pipeBind1"](8,15,t.isReinstatable())),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("disabled",!i["\u0275\u0275pipeBind1"](11,17,t.hasChanges())||!t.isValid()||t.initialHarvestType===t.harvestTypeNone&&t.contentSource.harvestType===t.initialHarvestType),i["\u0275\u0275advance"](5),i["\u0275\u0275textInterpolate1"]("\xa0",i["\u0275\u0275pipeBind1"](16,19,"item.edit.metadata.save-button"),""),i["\u0275\u0275advance"](6),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind1"](22,21,"collection.edit.tabs.source.head")),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",t.contentSource),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",!t.contentSource),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.contentSource&&(null==t.contentSource?null:t.contentSource.harvestType)!==t.harvestTypeNone),i["\u0275\u0275advance"](5),i["\u0275\u0275property"]("ngIf",t.formGroup&&t.contentSource&&(null==t.contentSource?null:t.contentSource.harvestType)!==t.harvestTypeNone),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",(null==t.contentSource?null:t.contentSource.harvestType)!==t.harvestTypeNone),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("isEnabled",!i["\u0275\u0275pipeBind1"](39,23,t.hasChanges()))("shouldShow",(null==t.contentSource?null:t.contentSource.harvestType)!==t.harvestTypeNone)("collection",null==(e=i["\u0275\u0275pipeBind1"](40,25,t.collectionRD$))?null:e.payload)}},directives:[s.p,de,pe.a,ue.a,me.NgControlStatusGroup,me.FormGroupDirective],pipes:[s.b,c.d],encapsulation:2}),e})();var Ce=n("C765"),Ee=n("Rgmz");const Oe=function(e){return{collection:e}};let Be=(()=>{class e{constructor(e,t){this.route=e,this.dsoNameService=t}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe(Object(G.a)(1),Object(V.a)(e=>e.dso)),this.collectionName$=this.dsoRD$.pipe(Object(Y.a)(e=>Object(q.b)(e)),Object(V.a)(e=>this.dsoNameService.getName(e.payload)))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.a),i["\u0275\u0275directiveInject"](Ce.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-collection-curate"]],decls:11,vars:11,consts:[[1,"container"],[3,"dsoHandle"]],template:function(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n    "),i["\u0275\u0275elementStart"](2,"h3"),i["\u0275\u0275text"](3),i["\u0275\u0275pipe"](4,"translate"),i["\u0275\u0275pipe"](5,"async"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](6,"\n    "),i["\u0275\u0275element"](7,"ds-curation-form",1),i["\u0275\u0275pipe"](8,"async"),i["\u0275\u0275text"](9,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](10,"\n")),2&e){let e=null;i["\u0275\u0275advance"](3),i["\u0275\u0275textInterpolate"](i["\u0275\u0275pipeBind2"](4,2,"collection.curate.header",i["\u0275\u0275pureFunction1"](9,Oe,i["\u0275\u0275pipeBind1"](5,5,t.collectionName$)))),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("dsoHandle",null==(e=i["\u0275\u0275pipeBind1"](8,7,t.dsoRD$))?null:e.payload.handle)}},directives:[Ee.a],pipes:[c.d,s.b],encapsulation:2}),e})();var Te=n("+Bs4");let we=(()=>{class e{constructor(e){this.route=e}ngOnInit(){this.dsoRD$=this.route.parent.parent.data.pipe(Object(M.a)(),Object(V.a)(e=>e.dso))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](r.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ds-collection-authorizations"]],decls:6,vars:4,consts:[[1,"container"],[3,"resourceType","resourceUUID"]],template:function(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275text"](1,"\n  "),i["\u0275\u0275element"](2,"ds-resource-policies",1),i["\u0275\u0275pipe"](3,"async"),i["\u0275\u0275text"](4,"\n"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275text"](5,"\n")),2&e){let e=null;i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("resourceType","collection")("resourceUUID",null==(e=i["\u0275\u0275pipeBind1"](3,2,t.dsoRD$))||null==e.payload?null:e.payload.id)}},directives:[Te.a],pipes:[s.b],encapsulation:2}),e})();var ke=n("A0IO"),Re=n("n1Qy"),De=n("EEUA"),$e=n("G5zm"),Fe=n("ALMP"),Me=n("rdLr"),Ve=n("LRne"),Le=n("FU+A"),Ne=n("1mcE"),He=n("Vurf");let Pe=(()=>{class e extends Me.a{constructor(e,t,n){super(e,t,n),this.authorizationService=e,this.router=t,this.authService=n}getFeatureID(e,t){return Object(Ve.a)(Le.a.IsCollectionAdmin)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](Ne.a),i["\u0275\u0275inject"](r.h),i["\u0275\u0275inject"](He.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),_e=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({providers:[$e.a,Re.a],imports:[[r.l.forChild([{path:"",resolve:{breadcrumb:ke.a},data:{breadcrumbKey:"collection.edit"},component:m,canActivate:[Pe],children:[{path:"",redirectTo:"metadata",pathMatch:"full"},{path:"metadata",component:F,data:{title:"collection.edit.tabs.metadata.title",hideReturnButton:!0,showBreadcrumbs:!0}},{path:"roles",component:H,data:{title:"collection.edit.tabs.roles.title",showBreadcrumbs:!0}},{path:"source",component:je,data:{title:"collection.edit.tabs.source.title",showBreadcrumbs:!0}},{path:"curate",component:Be,data:{title:"collection.edit.tabs.curate.title",showBreadcrumbs:!0}},{path:"authorizations",data:{showBreadcrumbs:!0},children:[{path:"create",resolve:{resourcePolicyTarget:Re.a},component:De.a,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:$e.a},component:Fe.a,data:{title:"resource-policies.edit.page.title"}},{path:"",component:we,data:{title:"collection.edit.tabs.authorizations.title",showBreadcrumbs:!0}}]},{path:"mapper",component:b.a,data:{title:"collection.edit.tabs.item-mapper.title",hideReturnButton:!0,showBreadcrumbs:!0}}]}])]]}),e})();var qe=n("nVrp"),Ae=n("GFj5"),Ge=n("kcqd"),Ue=n("fY2w");let ze=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({imports:[[s.c,h.a,_e,qe.a,Ae.a,Ge.a,Ue.a]]}),e})()}}]);
//# sourceMappingURL=34-es2015.21b6ad9fae0e8d08adca.js.map